<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LOST: src/io.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LOST
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
   <div id="projectbrief">LOST: Open-source Star Tracker</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('io_8cpp_source.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">io.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="io_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="io_8hpp.html">io.hpp</a>&quot;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160; </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;cairo/cairo.h&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;inttypes.h&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &lt;errno.h&gt;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;assert.h&gt;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;limits.h&gt;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160; </div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;cstring&gt;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;random&gt;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &lt;chrono&gt;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160; </div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="attitude-estimators_8hpp.html">attitude-estimators.hpp</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="attitude-utils_8hpp.html">attitude-utils.hpp</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="databases_8hpp.html">databases.hpp</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="star-id_8hpp.html">star-id.hpp</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="star-utils_8hpp.html">star-utils.hpp</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160; </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespacelost.html">lost</a> {</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="classlost_1_1_user_specified_output_stream.html#a4dcbbf27cfacdc73f038e06532a73301">   33</a></span>&#160;<a class="code" href="classlost_1_1_user_specified_output_stream.html#a4dcbbf27cfacdc73f038e06532a73301">UserSpecifiedOutputStream::UserSpecifiedOutputStream</a>(std::string filePath, <span class="keywordtype">bool</span> isBinary) {</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="keywordflow">if</span> (isBinary &amp;&amp; isatty(fileno(stdout)) &amp;&amp; (filePath == <span class="stringliteral">&quot;stdout&quot;</span> || filePath == <span class="stringliteral">&quot;-&quot;</span>)) {</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;WARNING: output contains binary contents. Not printed to terminal.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        filePath = <span class="stringliteral">&quot;/dev/null&quot;</span>;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    }</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keywordflow">if</span> (filePath == <span class="stringliteral">&quot;stdout&quot;</span> || filePath == <span class="stringliteral">&quot;-&quot;</span>) {</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;        stream = &amp;std::cout;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        isFstream = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        std::fstream *fs = <span class="keyword">new</span> std::fstream();</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        fs-&gt;open(filePath, std::fstream::out);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        stream = fs;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        isFstream = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    }</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;}</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160; </div>
<div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="classlost_1_1_user_specified_output_stream.html#a2d2eae68275a53f1b83be250d09b6730">   50</a></span>&#160;<a class="code" href="classlost_1_1_user_specified_output_stream.html#a2d2eae68275a53f1b83be250d09b6730">UserSpecifiedOutputStream::~UserSpecifiedOutputStream</a>() {</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keywordflow">if</span> (isFstream) {</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        <span class="keyword">delete</span> stream;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    }</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;}</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160; </div>
<div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="namespacelost.html#a2de388cdf7e0c6b9c572903605480568">   57</a></span>&#160;std::vector&lt;CatalogStar&gt; <a class="code" href="namespacelost.html#a2de388cdf7e0c6b9c572903605480568">BscParse</a>(std::string tsvPath) {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    std::vector&lt;CatalogStar&gt; result;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    FILE *file;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordtype">double</span> raj2000, dej2000;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keywordtype">int</span> magnitudeHigh, magnitudeLow, name;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keywordtype">char</span> weird;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    file = fopen(tsvPath.c_str(), <span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordflow">if</span> (file == NULL) {</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        printf(<span class="stringliteral">&quot;Error opening file: %s\n&quot;</span>, strerror(errno));</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        exit(1); <span class="comment">// TODO: do we want any other error handling?</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    }</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160; </div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keywordflow">while</span> (EOF != fscanf(file, <span class="stringliteral">&quot;%lf|%lf|%d|%c|%d.%d&quot;</span>,</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                         &amp;raj2000, &amp;dej2000,</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                         &amp;name, &amp;weird,</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                         &amp;magnitudeHigh, &amp;magnitudeLow)) {</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        result.push_back(<a class="code" href="classlost_1_1_catalog_star.html">CatalogStar</a>(<a class="code" href="namespacelost.html#abf3a90819d379c9a4d0c48f385f52613">DegToRad</a>(raj2000),</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                                     <a class="code" href="namespacelost.html#abf3a90819d379c9a4d0c48f385f52613">DegToRad</a>(dej2000),</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                                     magnitudeHigh*100 + (magnitudeHigh &lt; 0 ? -magnitudeLow : magnitudeLow),</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                                     name));</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    }</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160; </div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    fclose(file);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    assert(result.size() &gt; 9000); <span class="comment">// basic sanity check</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;}</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="preprocessor">#ifndef DEFAULT_BSC_PATH</span></div>
<div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="io_8cpp.html#a1628471efc4a0d438d497c67d641c6c4">   87</a></span>&#160;<span class="preprocessor">#define DEFAULT_BSC_PATH &quot;bright-star-catalog.tsv&quot;</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; </div>
<div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="namespacelost.html#a41f5bb669129790c12bd70e1d641441f">   91</a></span>&#160;<span class="keyword">const</span> <a class="code" href="namespacelost.html#aef1a1d4dd4620ebdc2197877569a44f6">Catalog</a> &amp;<a class="code" href="namespacelost.html#a41f5bb669129790c12bd70e1d641441f">CatalogRead</a>() {</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">bool</span> readYet = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="keyword">static</span> std::vector&lt;CatalogStar&gt; catalog;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160; </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordflow">if</span> (!readYet) {</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        readYet = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        <span class="keywordtype">char</span> *tsvPath = getenv(<span class="stringliteral">&quot;LOST_BSC_PATH&quot;</span>);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        catalog = <a class="code" href="namespacelost.html#a2de388cdf7e0c6b9c572903605480568">BscParse</a>(tsvPath ? tsvPath : <a class="code" href="io_8cpp.html#a1628471efc4a0d438d497c67d641c6c4">DEFAULT_BSC_PATH</a>);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        <span class="comment">// perform essential narrowing</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="comment">// remove all stars with exactly the same position as another, keeping the one with brighter magnitude</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        std::sort(catalog.begin(), catalog.end(), [](<span class="keyword">const</span> <a class="code" href="classlost_1_1_catalog_star.html">CatalogStar</a> &amp;a, <span class="keyword">const</span> <a class="code" href="classlost_1_1_catalog_star.html">CatalogStar</a> &amp;b) {</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            return a.spatial.x &lt; b.spatial.x;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        });</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = catalog.size(); i &gt; 0; i--) {</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            <span class="keywordflow">if</span> ((catalog[i].spatial - catalog[i-1].spatial).Magnitude() &lt; 5e-5) { <span class="comment">// 70 stars removed at this threshold.</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                <span class="keywordflow">if</span> (catalog[i].magnitude &gt; catalog[i-1].magnitude) {</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                    catalog.erase(catalog.begin() + i);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                    catalog.erase(catalog.begin() + i - 1);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                }</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            }</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        }</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    }</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordflow">return</span> catalog;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;}</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160; </div>
<div class="line"><a name="l00119"></a><span class="lineno"><a class="line" href="namespacelost.html#a1c3caf3f02508df448ec6c761a2d764e">  119</a></span>&#160;<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="namespacelost.html#a1c3caf3f02508df448ec6c761a2d764e">SurfaceToGrayscaleImage</a>(cairo_surface_t *cairoSurface) {</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keywordtype">int</span> width, height;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *result;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    uint32_t *cairoImage, pixel;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160; </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">if</span> (cairo_image_surface_get_format(cairoSurface) != CAIRO_FORMAT_ARGB32 &amp;&amp;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        cairo_image_surface_get_format(cairoSurface) != CAIRO_FORMAT_RGB24) {</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        puts(<span class="stringliteral">&quot;Can&#39;t convert weird image formats to grayscale.&quot;</span>);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    }</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160; </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    width  = cairo_image_surface_get_width(cairoSurface);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    height = cairo_image_surface_get_height(cairoSurface);</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    result = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>[width*height];</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    cairoImage = (uint32_t *)cairo_image_surface_get_data(cairoSurface);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160; </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; height * width; i++) {</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        pixel = cairoImage[i];</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <span class="comment">// use &quot;luminosity&quot; method of grayscaling</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        result[i] = round(</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            (pixel&gt;&gt;16 &amp;0xFF) *0.21 +</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            (pixel&gt;&gt;8  &amp;0xFF) *0.71 +</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            (pixel     &amp;0xFF) *0.07);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    }</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; </div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;}</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160; </div>
<div class="line"><a name="l00148"></a><span class="lineno"><a class="line" href="namespacelost.html#af0b05482238f0a180d5906f0e43ac3e2">  148</a></span>&#160;cairo_surface_t *<a class="code" href="namespacelost.html#af0b05482238f0a180d5906f0e43ac3e2">GrayscaleImageToSurface</a>(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *image,</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                                         <span class="keyword">const</span> <span class="keywordtype">int</span> width, <span class="keyword">const</span> <span class="keywordtype">int</span> height) {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">// cairo&#39;s 8-bit type isn&#39;t BW, it&#39;s an alpha channel only, which would look a bit weird lol</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    cairo_surface_t *result = cairo_image_surface_create(CAIRO_FORMAT_RGB24, width, height);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    uint32_t *resultData = (uint32_t *)cairo_image_surface_get_data(result);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="comment">// hopefully unnecessary</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    cairo_surface_flush(result);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">long</span> i = 0; i &lt; width * height; i++) {</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="comment">// equal r, g, and b components</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        resultData[i] = (image[i] &lt;&lt; 16) + (image[i] &lt;&lt; 8) + (image[i]);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    }</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    cairo_surface_mark_dirty(result);</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;}</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160; </div>
<div class="line"><a name="l00170"></a><span class="lineno"><a class="line" href="namespacelost.html#a8298f03c0d1b408401e4200d17305018">  170</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacelost.html#a8298f03c0d1b408401e4200d17305018">SurfacePlot</a>(std::string description,</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                 cairo_surface_t *cairoSurface,</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                 <span class="keyword">const</span> <a class="code" href="namespacelost.html#a4bd359d9c09dbecb81c3a3e536f0b5c5">Stars</a> &amp;stars,</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                 <span class="keyword">const</span> <a class="code" href="namespacelost.html#a288b872531de219e9cfc87beb8d8bada">StarIdentifiers</a> *starIds,</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                 <span class="keyword">const</span> <a class="code" href="namespacelost.html#aef1a1d4dd4620ebdc2197877569a44f6">Catalog</a> *catalog,</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                 <span class="keyword">const</span> <a class="code" href="classlost_1_1_attitude.html">Attitude</a> *attitude,</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                 <span class="keywordtype">double</span> red,</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                 <span class="keywordtype">double</span> green,</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                 <span class="keywordtype">double</span> blue,</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                 <span class="keywordtype">double</span> alpha,</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                 <span class="comment">// if true, don&#39;t use catalog name</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                 <span class="keywordtype">bool</span> rawStarIndexes = <span class="keyword">false</span>) {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    cairo_t *cairoCtx;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    std::string metadata = description + <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160; </div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    cairoCtx = cairo_create(cairoSurface);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    cairo_set_source_rgba(cairoCtx, red, green, blue, alpha);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    cairo_set_line_width(cairoCtx, 1.0);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    cairo_set_antialias(cairoCtx, CAIRO_ANTIALIAS_NONE);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    cairo_font_options_t *cairoFontOptions = cairo_font_options_create();</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    cairo_font_options_set_antialias(cairoFontOptions, CAIRO_ANTIALIAS_NONE);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    cairo_set_font_options(cairoCtx, cairoFontOptions);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    cairo_text_extents_t cairoTextExtents;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    cairo_text_extents(cairoCtx, <span class="stringliteral">&quot;1234567890&quot;</span>, &amp;cairoTextExtents);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordtype">double</span> textHeight = cairoTextExtents.height;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160; </div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classlost_1_1_star.html">Star</a> &amp;centroid : stars) {</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <span class="comment">// plot the box around the star</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="keywordflow">if</span> (centroid.radiusX &gt; 0.0f) {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            <span class="keywordtype">float</span> radiusX = centroid.radiusX;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            <span class="keywordtype">float</span> radiusY = centroid.radiusY &gt; 0.0f ?</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                centroid.radiusY : radiusX;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160; </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            <span class="comment">// Rectangles should be entirely /outside/ the radius of the star, so the star is</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            <span class="comment">// fully visible.</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            cairo_rectangle(cairoCtx,</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                            centroid.position.x - radiusX,</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                            centroid.position.y - radiusY,</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                            radiusX * 2,</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                            radiusY * 2);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            cairo_stroke(cairoCtx);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            cairo_rectangle(cairoCtx,</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                            floor(centroid.position.x),</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                            floor(centroid.position.y),</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                            1, 1);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            cairo_fill(cairoCtx);</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        }</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    }</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160; </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    metadata += std::to_string(stars.size()) + <span class="stringliteral">&quot; centroids   &quot;</span>;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <span class="keywordflow">if</span> (starIds != NULL) {</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        assert(catalog != NULL);</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160; </div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classlost_1_1_star_identifier.html">StarIdentifier</a> &amp;starId : *starIds) {</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="keyword">const</span> <a class="code" href="classlost_1_1_star.html">Star</a> &amp;centroid = stars[starId.starIndex];</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            cairo_move_to(cairoCtx,</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160; </div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                          centroid.<a class="code" href="classlost_1_1_star.html#ad7bcae53e6ad611b8fb436eeb159da98">radiusX</a> &gt; 0.0f</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                          ? centroid.<a class="code" href="classlost_1_1_star.html#a8e9b2320d742fb5324397ac406c859ea">position</a>.<a class="code" href="structlost_1_1_vec2.html#a9a9c151101dbb57060873e8af18927af">x</a> + centroid.<a class="code" href="classlost_1_1_star.html#ad7bcae53e6ad611b8fb436eeb159da98">radiusX</a> + 3</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                          : centroid.<a class="code" href="classlost_1_1_star.html#a8e9b2320d742fb5324397ac406c859ea">position</a>.<a class="code" href="structlost_1_1_vec2.html#a9a9c151101dbb57060873e8af18927af">x</a> + 8,</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160; </div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                          centroid.<a class="code" href="classlost_1_1_star.html#abb1ed64c90d4f6508fdd1e75923175d6">radiusY</a> &gt; 0.0f</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                          ? centroid.<a class="code" href="classlost_1_1_star.html#a8e9b2320d742fb5324397ac406c859ea">position</a>.<a class="code" href="structlost_1_1_vec2.html#a3a23d5b38c5873b4b870ace85fd30d05">y</a> - centroid.<a class="code" href="classlost_1_1_star.html#abb1ed64c90d4f6508fdd1e75923175d6">radiusY</a> + textHeight</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                          : centroid.<a class="code" href="classlost_1_1_star.html#a8e9b2320d742fb5324397ac406c859ea">position</a>.<a class="code" href="structlost_1_1_vec2.html#a3a23d5b38c5873b4b870ace85fd30d05">y</a> + 10);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            <span class="keywordtype">int</span> plotName = rawStarIndexes ? starId.catalogIndex : (*catalog)[starId.catalogIndex].name;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            cairo_show_text(cairoCtx, std::to_string(plotName).c_str());</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        }</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        metadata += std::to_string(starIds-&gt;size()) + <span class="stringliteral">&quot; identified   &quot;</span>;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160; </div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordflow">if</span> (attitude != NULL) {</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <a class="code" href="classlost_1_1_euler_angles.html">EulerAngles</a> spherical = attitude-&gt;<a class="code" href="classlost_1_1_attitude.html#a1af3ee1daabfc256ec56554b260bdbee">ToSpherical</a>();</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        metadata +=</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            <span class="stringliteral">&quot;RA: &quot;</span> + std::to_string(<a class="code" href="namespacelost.html#adc5108f643b7657a835838c7f6411aa7">RadToDeg</a>(spherical.<a class="code" href="classlost_1_1_euler_angles.html#a86cffd1e68a380145e5b684c7d7c2406">ra</a>)) + <span class="stringliteral">&quot;  &quot;</span> +</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            <span class="stringliteral">&quot;DE: &quot;</span> + std::to_string(<a class="code" href="namespacelost.html#adc5108f643b7657a835838c7f6411aa7">RadToDeg</a>(spherical.<a class="code" href="classlost_1_1_euler_angles.html#acce7640ab1aa3431e04cc39037e538fe">de</a>)) + <span class="stringliteral">&quot;  &quot;</span> +</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            <span class="stringliteral">&quot;Roll: &quot;</span> + std::to_string(<a class="code" href="namespacelost.html#adc5108f643b7657a835838c7f6411aa7">RadToDeg</a>(spherical.<a class="code" href="classlost_1_1_euler_angles.html#a224cfa3989b86edc65d0e6e96bc7b3ca">roll</a>)) + <span class="stringliteral">&quot;   &quot;</span>;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    }</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160; </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="comment">// plot metadata</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    cairo_move_to(cairoCtx, 3, 3 + textHeight);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    cairo_show_text(cairoCtx, metadata.c_str());</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160; </div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    cairo_font_options_destroy(cairoFontOptions);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    cairo_destroy(cairoCtx);</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;}</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">// ALGORITHM PROMPTERS</span></div>
<div class="line"><a name="l00260"></a><span class="lineno"><a class="line" href="namespacelost.html#a92e491a9e204a882bc0635b7d943e085">  260</a></span>&#160;<span class="keyword">typedef</span> <a class="code" href="classlost_1_1_centroid_algorithm.html">CentroidAlgorithm</a> *(*CentroidAlgorithmFactory)();</div>
<div class="line"><a name="l00261"></a><span class="lineno"><a class="line" href="namespacelost.html#a106f3da2d75b2af268f5e9abfc7ea681">  261</a></span>&#160;<span class="keyword">typedef</span> <a class="code" href="classlost_1_1_star_id_algorithm.html">StarIdAlgorithm</a> *(*StarIdAlgorithmFactory)();</div>
<div class="line"><a name="l00262"></a><span class="lineno"><a class="line" href="namespacelost.html#a21ee58ad60e736a58c95394ae5f799f4">  262</a></span>&#160;<span class="keyword">typedef</span> <a class="code" href="classlost_1_1_attitude_estimation_algorithm.html">AttitudeEstimationAlgorithm</a> *(*AttitudeEstimationAlgorithmFactory)();</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160; </div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="keyword">typedef</span> <a class="code" href="classlost_1_1_star_id_algorithm.html">StarIdAlgorithm</a> *(*StarIdAlgorithmFactory)();</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160; </div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="keyword">typedef</span> <a class="code" href="classlost_1_1_attitude_estimation_algorithm.html">AttitudeEstimationAlgorithm</a> *(*AttitudeEstimationAlgorithmFactory)();</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; </div>
<div class="line"><a name="l00269"></a><span class="lineno"><a class="line" href="namespacelost.html#a7affa1b0e82efc2065dbd3b1e83326e7">  269</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacelost.html#a7affa1b0e82efc2065dbd3b1e83326e7">BuildPairDistanceKVectorDatabase</a>(<a class="code" href="classlost_1_1_multi_database_builder.html">MultiDatabaseBuilder</a> *builder, <span class="keyword">const</span> <a class="code" href="namespacelost.html#aef1a1d4dd4620ebdc2197877569a44f6">Catalog</a> &amp;catalog, <span class="keywordtype">float</span> minDistance, <span class="keywordtype">float</span> maxDistance, <span class="keywordtype">long</span> numBins) {</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="comment">// TODO: calculating the length of the vector duplicates a lot of the work, slowing down</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <span class="comment">// database generation</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordtype">long</span> length = <a class="code" href="namespacelost.html#afaa7020ad6a01645b45d4da236d4dfcb">SerializeLengthPairDistanceKVector</a>(catalog, minDistance, maxDistance, numBins);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buffer = builder-&gt;<a class="code" href="classlost_1_1_multi_database_builder.html#ad0fd44e30041b65d3d2d61f905d8f63e">AddSubDatabase</a>(<a class="code" href="classlost_1_1_pair_distance_k_vector_database.html#a6d5d477e5e2d9557f0e284e917361a54">PairDistanceKVectorDatabase::kMagicValue</a>, length);</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">if</span> (buffer == NULL) {</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;No room for another database.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    }</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <a class="code" href="namespacelost.html#a8f6c4f99ab47d2c48676901452fb8634">SerializePairDistanceKVector</a>(catalog, minDistance, maxDistance, numBins, buffer);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160; </div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="comment">// TODO: also parse it and print out some stats before returning</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;}</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160; </div>
<div class="line"><a name="l00283"></a><span class="lineno"><a class="line" href="namespacelost.html#aa309f1534940391b0d903f17a4c9be5c">  283</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacelost.html#aa309f1534940391b0d903f17a4c9be5c">GenerateDatabases</a>(<a class="code" href="classlost_1_1_multi_database_builder.html">MultiDatabaseBuilder</a> *builder, <span class="keyword">const</span> <a class="code" href="namespacelost.html#aef1a1d4dd4620ebdc2197877569a44f6">Catalog</a> &amp;catalog, <span class="keyword">const</span> <a class="code" href="classlost_1_1_database_options.html">DatabaseOptions</a> &amp;values) {</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160; </div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keywordflow">if</span> (values.kvector) {</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="keywordtype">float</span> minDistance = <a class="code" href="namespacelost.html#abf3a90819d379c9a4d0c48f385f52613">DegToRad</a>(values.kvectorMinDistance);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <span class="keywordtype">float</span> maxDistance = <a class="code" href="namespacelost.html#abf3a90819d379c9a4d0c48f385f52613">DegToRad</a>(values.kvectorMaxDistance);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        <span class="keywordtype">long</span> numBins = values.kvectorNumDistanceBins;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <a class="code" href="namespacelost.html#a7affa1b0e82efc2065dbd3b1e83326e7">BuildPairDistanceKVectorDatabase</a>(builder, catalog, minDistance, maxDistance, numBins);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;No database builder selected -- no database generated.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        exit(1);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    }</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160; </div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;}</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; </div>
<div class="line"><a name="l00298"></a><span class="lineno"><a class="line" href="namespacelost.html#afd0ad3291fda13bb1bf50fb13906769c">  298</a></span>&#160;std::ostream &amp;<a class="code" href="namespacelost.html#afd0ad3291fda13bb1bf50fb13906769c">operator&lt;&lt;</a>(std::ostream &amp;os, <span class="keyword">const</span> <a class="code" href="classlost_1_1_camera.html">Camera</a> &amp;camera) {</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;camera_focal_length &quot;</span> &lt;&lt; camera.<a class="code" href="classlost_1_1_camera.html#aa7df6f5d7ee2f6c26ecc34bd1e7f2e53">FocalLength</a>() &lt;&lt; std::endl</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;       &lt;&lt; <span class="stringliteral">&quot;camera_fov &quot;</span> &lt;&lt; camera.<a class="code" href="classlost_1_1_camera.html#a3830d04bcd953e27cc133944fb434f64">Fov</a>() &lt;&lt; std::endl</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;       &lt;&lt; <span class="stringliteral">&quot;camera_resolution_x &quot;</span> &lt;&lt; camera.<a class="code" href="classlost_1_1_camera.html#a6a6a4bd2d5daf114108e73126568369d">XResolution</a>() &lt;&lt; std::endl</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;       &lt;&lt; <span class="stringliteral">&quot;camera_resolution_y &quot;</span> &lt;&lt; camera.<a class="code" href="classlost_1_1_camera.html#a75f02f56900338580a9cacc2f9131d70">YResolution</a>() &lt;&lt; std::endl;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="comment">// TODO: principal point</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    <span class="keywordflow">return</span> os;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;}</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160; </div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">// PIPELINE INPUT STUFF</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00313"></a><span class="lineno"><a class="line" href="namespacelost.html#a1187da9a83232a720a84bef1b99c5b58">  313</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="namespacelost.html#a1187da9a83232a720a84bef1b99c5b58">FocalLengthFromOptions</a>(<span class="keyword">const</span> <a class="code" href="classlost_1_1_pipeline_options.html">PipelineOptions</a> &amp;values) {</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keywordflow">if</span> ((values.pixelSize != -1) ^ (values.focalLength != 0)) {</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;ERROR: Exactly one of --pixel-size or --focal-length were set.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        exit(1);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    }</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160; </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="comment">// no surefire way to see if the fov was set on command line, so we just check if it was changed from default.</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="keywordflow">if</span> (values.pixelSize != -1 &amp;&amp; values.fov != 20) {</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;ERROR: Both focal length and FOV were provided. We only need one of the two methods (pixel size + focal length, or fov) to determine fov, please only provide one.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        exit(1);</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    }</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160; </div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="keywordflow">if</span> (values.pixelSize == -1) {</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacelost.html#a5e7d67bec758d4922935c84b8a0f8526">FovToFocalLength</a>(<a class="code" href="namespacelost.html#abf3a90819d379c9a4d0c48f385f52613">DegToRad</a>(values.fov), values.generateXRes);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <span class="keywordflow">return</span> values.focalLength * 1000 / values.pixelSize;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    }</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;}</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160; </div>
<div class="line"><a name="l00334"></a><span class="lineno"><a class="line" href="classlost_1_1_pipeline_input.html#a8707ebe081ca65531341eeb2b9d4ff7b">  334</a></span>&#160;cairo_surface_t *<a class="code" href="classlost_1_1_pipeline_input.html#a8707ebe081ca65531341eeb2b9d4ff7b">PipelineInput::InputImageSurface</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="keyword">const</span> <a class="code" href="classlost_1_1_image.html">Image</a> *inputImage = <a class="code" href="classlost_1_1_pipeline_input.html#a4df52c585005abf1154699cb89570db8">InputImage</a>();</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacelost.html#af0b05482238f0a180d5906f0e43ac3e2">GrayscaleImageToSurface</a>(inputImage-&gt;<a class="code" href="classlost_1_1_image.html#a1cf1464da2a2b11d9983ed1f022da26b">image</a>, inputImage-&gt;<a class="code" href="classlost_1_1_image.html#af450eb35614041beeb2bec120aac739e">width</a>, inputImage-&gt;<a class="code" href="classlost_1_1_image.html#a705ef08de937ac85cf4a5c5e1084475e">height</a>);</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;}</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160; </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">// /**</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">//  * Pipeline input for an image that&#39;s already been identified using Astrometry.net.</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">//  * @todo Not implemented yet.</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">//  */</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">// class AstrometryPipelineInput : public PipelineInput {</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">// public:</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">//     explicit AstrometryPipelineInput(const std::string &amp;path);</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160; </div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">//     const Image *InputImage() const { return &amp;image; };</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">//     const Attitude *InputAttitude() const { return &amp;attitude; };</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">// private:</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment">//     Image image;</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">//     Attitude attitude;</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">// };</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160; </div>
<div class="line"><a name="l00360"></a><span class="lineno"><a class="line" href="classlost_1_1_png_pipeline_input.html#adee57652282fb256ea2deeb737b81afe">  360</a></span>&#160;<a class="code" href="classlost_1_1_png_pipeline_input.html#adee57652282fb256ea2deeb737b81afe">PngPipelineInput::PngPipelineInput</a>(cairo_surface_t *cairoSurface, <a class="code" href="classlost_1_1_camera.html">Camera</a> camera, <span class="keyword">const</span> <a class="code" href="namespacelost.html#aef1a1d4dd4620ebdc2197877569a44f6">Catalog</a> &amp;catalog)</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    : camera(camera), catalog(catalog) {</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160; </div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    image.<a class="code" href="classlost_1_1_image.html#a1cf1464da2a2b11d9983ed1f022da26b">image</a> = <a class="code" href="namespacelost.html#a1c3caf3f02508df448ec6c761a2d764e">SurfaceToGrayscaleImage</a>(cairoSurface);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    image.<a class="code" href="classlost_1_1_image.html#af450eb35614041beeb2bec120aac739e">width</a> = cairo_image_surface_get_width(cairoSurface);</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    image.<a class="code" href="classlost_1_1_image.html#a705ef08de937ac85cf4a5c5e1084475e">height</a> = cairo_image_surface_get_height(cairoSurface);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;}</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160; </div>
<div class="line"><a name="l00368"></a><span class="lineno"><a class="line" href="classlost_1_1_png_pipeline_input.html#a01b8ddf0471b41c2a3d306f49156a0ab">  368</a></span>&#160;<a class="code" href="classlost_1_1_png_pipeline_input.html#a01b8ddf0471b41c2a3d306f49156a0ab">PngPipelineInput::~PngPipelineInput</a>() {</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    <span class="keyword">delete</span>[] image.<a class="code" href="classlost_1_1_image.html#a1cf1464da2a2b11d9983ed1f022da26b">image</a>;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;}</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160; </div>
<div class="line"><a name="l00373"></a><span class="lineno"><a class="line" href="namespacelost.html#a72e465adc8dcb532e46b956261bf93fe">  373</a></span>&#160;<a class="code" href="namespacelost.html#acbd12c57a0797b6b786ebfc87aae0c84">PipelineInputList</a> <a class="code" href="namespacelost.html#a72e465adc8dcb532e46b956261bf93fe">GetPngPipelineInput</a>(<span class="keyword">const</span> <a class="code" href="classlost_1_1_pipeline_options.html">PipelineOptions</a> &amp;values) {</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <span class="comment">// I&#39;m not sure why, but i can&#39;t get an initializer list to work here. Probably something to do</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="comment">// with copying unique ptrs</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <a class="code" href="namespacelost.html#acbd12c57a0797b6b786ebfc87aae0c84">PipelineInputList</a> result;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    cairo_surface_t *cairoSurface = NULL;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    std::string pngPath = values.png;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160; </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    cairoSurface = cairo_image_surface_create_from_png(pngPath.c_str());</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;PNG Read status: &quot;</span> &lt;&lt; cairo_status_to_string(cairo_surface_status(cairoSurface)) &lt;&lt; std::endl;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordflow">if</span> (cairoSurface == NULL || cairo_surface_status(cairoSurface) != CAIRO_STATUS_SUCCESS) {</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        exit(1);</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    }</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160; </div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    <span class="keywordtype">int</span> xResolution = cairo_image_surface_get_width(cairoSurface);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="keywordtype">int</span> yResolution = cairo_image_surface_get_height(cairoSurface);</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    <span class="keywordtype">float</span> focalLengthPixels = <a class="code" href="namespacelost.html#a1187da9a83232a720a84bef1b99c5b58">FocalLengthFromOptions</a>(values);</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <a class="code" href="classlost_1_1_camera.html">Camera</a> cam = <a class="code" href="classlost_1_1_camera.html">Camera</a>(focalLengthPixels, xResolution, yResolution);</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160; </div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    result.push_back(std::unique_ptr&lt;PipelineInput&gt;(<span class="keyword">new</span> <a class="code" href="classlost_1_1_png_pipeline_input.html">PngPipelineInput</a>(cairoSurface, cam, <a class="code" href="namespacelost.html#a41f5bb669129790c12bd70e1d641441f">CatalogRead</a>())));</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    cairo_surface_destroy(cairoSurface);</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;}</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160; </div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">// AstrometryPipelineInput::AstrometryPipelineInput(const std::string &amp;path) {</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment">//     // create from path, TODO</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment">// }</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160; </div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment">// PipelineInputList PromptAstrometryPipelineInput() {</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment">//     // TODO: why does it let us do a reference to an ephemeral return value?</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">//     std::string path = Prompt&lt;std::string&gt;(&quot;Astrometry download directory&quot;);</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment">//     PipelineInputList result;</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">//     result.push_back(std::unique_ptr&lt;PipelineInput&gt;(new AstrometryPipelineInput(path)));</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">//     return result;</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">// }</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160; </div>
<div class="line"><a name="l00409"></a><span class="lineno"><a class="line" href="classlost_1_1_generated_star.html">  409</a></span>&#160;<span class="keyword">class </span><a class="code" href="classlost_1_1_generated_star.html">GeneratedStar</a> : <span class="keyword">public</span> <a class="code" href="classlost_1_1_star.html">Star</a> {</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00411"></a><span class="lineno"><a class="line" href="classlost_1_1_generated_star.html#ad8406a16bdfb31b731d923d67a5afe71">  411</a></span>&#160;    <a class="code" href="classlost_1_1_generated_star.html#ad8406a16bdfb31b731d923d67a5afe71">GeneratedStar</a>(<a class="code" href="classlost_1_1_star.html">Star</a> star, <span class="keywordtype">float</span> <a class="code" href="classlost_1_1_generated_star.html#aadcacbb1bf27616e20db9b86cde2e691">peakBrightness</a>, <a class="code" href="structlost_1_1_vec2.html">Vec2</a> motionBlurDelta)</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        : <a class="code" href="classlost_1_1_star.html">Star</a>(star), <a class="code" href="classlost_1_1_generated_star.html#aadcacbb1bf27616e20db9b86cde2e691">peakBrightness</a>(<a class="code" href="classlost_1_1_generated_star.html#aadcacbb1bf27616e20db9b86cde2e691">peakBrightness</a>), <a class="code" href="classlost_1_1_generated_star.html#a75214eb4d1e17681b3e3a116a88af29a">delta</a>(motionBlurDelta) { };</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160; </div>
<div class="line"><a name="l00415"></a><span class="lineno"><a class="line" href="classlost_1_1_generated_star.html#aadcacbb1bf27616e20db9b86cde2e691">  415</a></span>&#160;    <span class="keywordtype">float</span> <a class="code" href="classlost_1_1_generated_star.html#aadcacbb1bf27616e20db9b86cde2e691">peakBrightness</a>;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160; </div>
<div class="line"><a name="l00418"></a><span class="lineno"><a class="line" href="classlost_1_1_generated_star.html#a75214eb4d1e17681b3e3a116a88af29a">  418</a></span>&#160;    <a class="code" href="structlost_1_1_vec2.html">Vec2</a> <a class="code" href="classlost_1_1_generated_star.html#a75214eb4d1e17681b3e3a116a88af29a">delta</a>;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;};</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160; </div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">// In the equations for pixel brightness both with motion blur enabled and disabled, we don&#39;t need</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">// any constant scaling factor outside the integral because when d0=0, the brightness at the center</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">// will be zero without any scaling. The scaling factor you usually see on a Normal distribution is</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">// so that the Normal distribution integrates to one over the real line, making it a probability</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">// distribution. But we want the /peak/ to be one, not the integral. motion blur enabled</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160; </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="keyword">static</span> <span class="keywordtype">float</span> MotionBlurredPixelBrightness(<span class="keyword">const</span> <a class="code" href="structlost_1_1_vec2.html">Vec2</a> &amp;pixel, <span class="keyword">const</span> <a class="code" href="classlost_1_1_generated_star.html">GeneratedStar</a> &amp;generatedStar,</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                                          <span class="keywordtype">float</span> t, <span class="keywordtype">float</span> stddev) {</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="keyword">const</span> <a class="code" href="structlost_1_1_vec2.html">Vec2</a> &amp;p0 = generatedStar.<a class="code" href="classlost_1_1_star.html#a8e9b2320d742fb5324397ac406c859ea">position</a>;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keyword">const</span> <a class="code" href="structlost_1_1_vec2.html">Vec2</a> &amp;delta = generatedStar.<a class="code" href="classlost_1_1_generated_star.html#a75214eb4d1e17681b3e3a116a88af29a">delta</a>;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keyword">const</span> <a class="code" href="structlost_1_1_vec2.html">Vec2</a> d0 = p0 - pixel;</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="keywordflow">return</span> generatedStar.<a class="code" href="classlost_1_1_generated_star.html#aadcacbb1bf27616e20db9b86cde2e691">peakBrightness</a></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        * stddev*sqrt(M_PI) / (sqrt(2)*delta.<a class="code" href="structlost_1_1_vec2.html#a358e9b88c20e79e262eaa413b41a446e">Magnitude</a>())</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        * exp(pow(d0.<a class="code" href="structlost_1_1_vec2.html#a9a9c151101dbb57060873e8af18927af">x</a>*delta.<a class="code" href="structlost_1_1_vec2.html#a9a9c151101dbb57060873e8af18927af">x</a> + d0.<a class="code" href="structlost_1_1_vec2.html#a3a23d5b38c5873b4b870ace85fd30d05">y</a>*delta.<a class="code" href="structlost_1_1_vec2.html#a3a23d5b38c5873b4b870ace85fd30d05">y</a>, 2) / (2*stddev*stddev*delta.<a class="code" href="structlost_1_1_vec2.html#aff160839bdf98a18db114a9bd7baab72">MagnitudeSq</a>())</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;              - d0.<a class="code" href="structlost_1_1_vec2.html#aff160839bdf98a18db114a9bd7baab72">MagnitudeSq</a>() / (2*stddev*stddev))</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        * erf((t*delta.<a class="code" href="structlost_1_1_vec2.html#aff160839bdf98a18db114a9bd7baab72">MagnitudeSq</a>() + d0.<a class="code" href="structlost_1_1_vec2.html#a9a9c151101dbb57060873e8af18927af">x</a>*delta.<a class="code" href="structlost_1_1_vec2.html#a9a9c151101dbb57060873e8af18927af">x</a> + d0.<a class="code" href="structlost_1_1_vec2.html#a3a23d5b38c5873b4b870ace85fd30d05">y</a>*delta.<a class="code" href="structlost_1_1_vec2.html#a3a23d5b38c5873b4b870ace85fd30d05">y</a>) / (stddev*sqrt(2)*delta.<a class="code" href="structlost_1_1_vec2.html#a358e9b88c20e79e262eaa413b41a446e">Magnitude</a>()));</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;}</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160; </div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="keyword">static</span> <span class="keywordtype">float</span> StaticPixelBrightness(<span class="keyword">const</span> Vec2 &amp;pixel, <span class="keyword">const</span> GeneratedStar &amp;generatedStar,</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                                   <span class="keywordtype">float</span> t, <span class="keywordtype">float</span> stddev) {</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keyword">const</span> Vec2 d0 = generatedStar.position - pixel;</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keywordflow">return</span> generatedStar.peakBrightness * t * exp(-d0.MagnitudeSq() / (2 * stddev * stddev));</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;}</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160; </div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="keyword">static</span> <span class="keywordtype">float</span> CentroidImagingProbability(<span class="keywordtype">float</span> mag, <span class="keywordtype">float</span> cutoffMag) {</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keywordtype">float</span> brightness = <a class="code" href="namespacelost.html#a90ef8f69cd7b77ba05701f833fdaa320">MagToBrightness</a>(mag);</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="keywordtype">float</span> cutoffBrightness = <a class="code" href="namespacelost.html#a90ef8f69cd7b77ba05701f833fdaa320">MagToBrightness</a>(cutoffMag);</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordtype">float</span> stddev = cutoffBrightness/5.0;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="comment">// CDF of Normal distribution with given mean and stddev</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keywordflow">return</span> 1 - (0.5 * (1 + erf((cutoffBrightness-brightness)/(stddev*sqrt(2.0)))));</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;}</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160; </div>
<div class="line"><a name="l00473"></a><span class="lineno"><a class="line" href="namespacelost.html#a9b3311f3ebda1282ad7bf650de30cf45">  473</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespacelost.html#a9b3311f3ebda1282ad7bf650de30cf45">kMaxBrightness</a> = 255;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160; </div>
<div class="line"><a name="l00479"></a><span class="lineno"><a class="line" href="classlost_1_1_generated_pipeline_input.html#a1b473186f7c725b5e59dcfe95be1f686">  479</a></span>&#160;<a class="code" href="classlost_1_1_generated_pipeline_input.html#a1b473186f7c725b5e59dcfe95be1f686">GeneratedPipelineInput::GeneratedPipelineInput</a>(<span class="keyword">const</span> <a class="code" href="namespacelost.html#aef1a1d4dd4620ebdc2197877569a44f6">Catalog</a> &amp;catalog,</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                                               <a class="code" href="classlost_1_1_attitude.html">Attitude</a> attitude,</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                                               <a class="code" href="classlost_1_1_camera.html">Camera</a> camera,</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                                               std::default_random_engine *rng,</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160; </div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                                               <span class="keywordtype">bool</span> centroidsOnly,</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                                               <span class="keywordtype">float</span> zeroMagTotalPhotons,</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                                               <span class="keywordtype">float</span> starSpreadStdDev,</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                                               <span class="keywordtype">float</span> saturationPhotons,</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                                               <span class="keywordtype">float</span> darkCurrent,</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                                               <span class="keywordtype">float</span> readNoiseStdDev,</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                                               <a class="code" href="classlost_1_1_attitude.html">Attitude</a> motionBlurDirection, <span class="comment">// applied on top of the attitude</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                                               <span class="keywordtype">float</span> exposureTime, <span class="comment">// zero for no motion blur</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                                               <span class="keywordtype">float</span> readoutTime, <span class="comment">// zero for no rolling shutter</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                                               <span class="keywordtype">bool</span> shotNoise,</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                                               <span class="keywordtype">int</span> oversampling,</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                                               <span class="keywordtype">int</span> numFalseStars,</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                                               <span class="keywordtype">int</span> falseStarMinMagnitude,</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                                               <span class="keywordtype">int</span> falseStarMaxMagnitude,</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                                               <span class="keywordtype">int</span> cutoffMag,</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                                               <span class="keywordtype">float</span> perturbationStddev)</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    : camera(camera), attitude(attitude), catalog(catalog) {</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160; </div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    assert(falseStarMaxMagnitude &lt;= falseStarMinMagnitude);</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    assert(perturbationStddev &gt;= 0.0);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160; </div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    image.<a class="code" href="classlost_1_1_image.html#af450eb35614041beeb2bec120aac739e">width</a> = camera.<a class="code" href="classlost_1_1_camera.html#a6a6a4bd2d5daf114108e73126568369d">XResolution</a>();</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    image.<a class="code" href="classlost_1_1_image.html#a705ef08de937ac85cf4a5c5e1084475e">height</a> = camera.<a class="code" href="classlost_1_1_camera.html#a75f02f56900338580a9cacc2f9131d70">YResolution</a>();</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <span class="comment">// number of true photons each pixel receives.</span></div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160; </div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    assert(oversampling &gt;= 1);</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="keywordtype">int</span> oversamplingPerAxis = ceil(sqrt(oversampling));</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordflow">if</span> (oversamplingPerAxis*oversamplingPerAxis != oversampling) {</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;WARNING: oversampling was not a perfect square. Rounding up to &quot;</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                  &lt;&lt; oversamplingPerAxis*oversamplingPerAxis &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    }</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    assert(exposureTime &gt; 0);</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <span class="keywordtype">bool</span> motionBlurEnabled = abs(motionBlurDirection.<a class="code" href="classlost_1_1_attitude.html#adc1b3ee1876cf2212603eaa902dce055">GetQuaternion</a>().<a class="code" href="classlost_1_1_quaternion.html#a819b0f409e60886138c0fae47c21e250">Angle</a>()) &gt; 0.001;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <a class="code" href="classlost_1_1_quaternion.html">Quaternion</a> motionBlurDirectionQ = motionBlurDirection.<a class="code" href="classlost_1_1_attitude.html#adc1b3ee1876cf2212603eaa902dce055">GetQuaternion</a>();</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="comment">// attitude at the middle of exposure time</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <a class="code" href="classlost_1_1_quaternion.html">Quaternion</a> currentAttitude = attitude.<a class="code" href="classlost_1_1_attitude.html#adc1b3ee1876cf2212603eaa902dce055">GetQuaternion</a>();</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="comment">// attitude 1 time unit after middle of exposure</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <a class="code" href="classlost_1_1_quaternion.html">Quaternion</a> futureAttitude = motionBlurDirectionQ*currentAttitude;</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    std::vector&lt;GeneratedStar&gt; generatedStars;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160; </div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="comment">// a star with 1 photon has peak density 1/(2pi sigma^2), because 2d gaussian formula. Then just</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <span class="comment">// multiply up proportionally!</span></div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    <span class="keywordtype">float</span> zeroMagPeakPhotonDensity = zeroMagTotalPhotons / (2*M_PI * starSpreadStdDev*starSpreadStdDev);</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160; </div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="comment">// TODO: Is it 100% correct to just copy the standard deviation in both dimensions?</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    std::normal_distribution&lt;float&gt; perturbation1DDistribution(0.0, perturbationStddev);</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160; </div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    <a class="code" href="namespacelost.html#aef1a1d4dd4620ebdc2197877569a44f6">Catalog</a> catalogWithFalse = catalog;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160; </div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    std::uniform_real_distribution&lt;float&gt; uniformDistribution(0.0, 1.0);</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    std::uniform_int_distribution&lt;int&gt; magnitudeDistribution(falseStarMaxMagnitude, falseStarMinMagnitude);</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numFalseStars; i++) {</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        <span class="keywordtype">float</span> ra = uniformDistribution(*rng) * 2*M_PI;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        <span class="comment">// to be uniform around sphere. Borel-Kolmogorov paradox is calling</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        <span class="keywordtype">float</span> de = asin(uniformDistribution(*rng)*2 - 1);</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        <span class="keywordtype">float</span> magnitude = magnitudeDistribution(*rng);</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160; </div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        catalogWithFalse.push_back(<a class="code" href="classlost_1_1_catalog_star.html">CatalogStar</a>(ra, de, magnitude, -1));</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    }</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160; </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; (int)catalogWithFalse.size(); i++) {</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        <span class="keywordtype">bool</span> isTrueStar = i &lt; (int)catalog.size();</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160; </div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        <span class="keyword">const</span> <a class="code" href="classlost_1_1_catalog_star.html">CatalogStar</a> &amp;catalogStar = catalogWithFalse[i];</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        <a class="code" href="classlost_1_1_vec3.html">Vec3</a> rotated = attitude.<a class="code" href="classlost_1_1_attitude.html#a4c7ac3eb32e2e6dc8c576c9ad7134aaf">Rotate</a>(catalogWithFalse[i].spatial);</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        <span class="keywordflow">if</span> (rotated.<a class="code" href="classlost_1_1_vec3.html#a97adb523973ae539a5d8963d78569618">x</a> &lt;= 0) {</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        }</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        <a class="code" href="structlost_1_1_vec2.html">Vec2</a> camCoords = camera.<a class="code" href="classlost_1_1_camera.html#a2282f819be792d84f3168032a9cf457b">SpatialToCamera</a>(rotated);</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160; </div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <span class="keywordflow">if</span> (camera.<a class="code" href="classlost_1_1_camera.html#a4d940919d1247edd431de7643473f538">InSensor</a>(camCoords)) {</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            <a class="code" href="classlost_1_1_vec3.html">Vec3</a> futureSpatial = futureAttitude.<a class="code" href="classlost_1_1_quaternion.html#a570198dc9f0669cb34d715fbf9e62578">Rotate</a>(catalogWithFalse[i].spatial);</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            <a class="code" href="structlost_1_1_vec2.html">Vec2</a> delta = camera.<a class="code" href="classlost_1_1_camera.html#a2282f819be792d84f3168032a9cf457b">SpatialToCamera</a>(futureSpatial) - camCoords;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;            <span class="keywordflow">if</span> (!motionBlurEnabled) {</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                delta = {0, 0}; <span class="comment">// avoid floating point funny business</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            }</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;            <span class="comment">// radiant intensity, in photons per time unit per pixel, at the center of the star.</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;            <span class="keywordtype">float</span> peakBrightnessPerTime = zeroMagPeakPhotonDensity * <a class="code" href="namespacelost.html#a90ef8f69cd7b77ba05701f833fdaa320">MagToBrightness</a>(catalogStar.<a class="code" href="classlost_1_1_catalog_star.html#aac362b166dd1a5cfe95e33a7e2d18e3a">magnitude</a>);</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            <span class="keywordtype">float</span> interestingThreshold = 0.05; <span class="comment">// we don&#39;t need to check pixels that are expected to</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                                               <span class="comment">// receive this many photons or fewer.</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;            <span class="comment">// inverse of the function defining the Gaussian distribution: Find out how far from the</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            <span class="comment">// mean we&#39;ll have to go until the number of photons is less than interestingThreshold</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;            <span class="keywordtype">float</span> radius = ceil(sqrt(-log(interestingThreshold/peakBrightnessPerTime/exposureTime)*2*M_PI*starSpreadStdDev*starSpreadStdDev));</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;            <a class="code" href="classlost_1_1_star.html">Star</a> star = <a class="code" href="classlost_1_1_star.html">Star</a>(camCoords.<a class="code" href="structlost_1_1_vec2.html#a9a9c151101dbb57060873e8af18927af">x</a>, camCoords.<a class="code" href="structlost_1_1_vec2.html#a3a23d5b38c5873b4b870ace85fd30d05">y</a>,</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                             radius, radius,</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                             <span class="comment">// important to invert magnitude here, so that centroid magnitude becomes larger for brighter stars.</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                             <span class="comment">// It&#39;s possible to make it so that the magnitude is always positive too, but allowing weirder magnitudes helps keep star-id algos honest about their assumptions on magnitude.</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                             <span class="comment">// we don&#39;t use its magnitude anywhere else in generation; peakBrightness was already calculated.</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                             -catalogStar.<a class="code" href="classlost_1_1_catalog_star.html#aac362b166dd1a5cfe95e33a7e2d18e3a">magnitude</a>);</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;            generatedStars.push_back(<a class="code" href="classlost_1_1_generated_star.html">GeneratedStar</a>(star, peakBrightnessPerTime, delta));</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160; </div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;            <span class="comment">// Now add the star to the input and expected lists.</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            <span class="comment">// We do actually want to add false stars as well, because:</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            <span class="comment">// a) A centroider isn&#39;t any worse because it picks up a false star that looks exactly like a normal star, so why should we exclude them from compare-centroids?</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            <span class="comment">// b) We want to feed false stars into star-ids to evaluate their false-star resilience without running centroiding.</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160; </div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;            <span class="comment">// Add all stars to expected, cause that&#39;s how we roll</span></div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            expectedStars.push_back(star);</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            <span class="comment">// and provide expected identifications for all of them</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            <span class="keywordflow">if</span> (isTrueStar) {</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                expectedStarIds.push_back(<a class="code" href="classlost_1_1_star_identifier.html">StarIdentifier</a>(expectedStars.size()-1, i));</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;            }</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160; </div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;            <span class="comment">// for input, though, add perturbation and stuff.</span></div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;            <a class="code" href="classlost_1_1_star.html">Star</a> inputStar = star;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            <span class="keywordflow">if</span> (perturbationStddev &gt; 0.0) {</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                <span class="comment">// clamp to within 2 standard deviations for some reason:</span></div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                inputStar.<a class="code" href="classlost_1_1_star.html#a8e9b2320d742fb5324397ac406c859ea">position</a>.<a class="code" href="structlost_1_1_vec2.html#a9a9c151101dbb57060873e8af18927af">x</a> += std::max(std::min(perturbation1DDistribution(*rng), 2*perturbationStddev), -2*perturbationStddev);</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                inputStar.<a class="code" href="classlost_1_1_star.html#a8e9b2320d742fb5324397ac406c859ea">position</a>.<a class="code" href="structlost_1_1_vec2.html#a3a23d5b38c5873b4b870ace85fd30d05">y</a> += std::max(std::min(perturbation1DDistribution(*rng), 2*perturbationStddev), -2*perturbationStddev);</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;            }</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;            <span class="comment">// If it got perturbed outside of the sensor, don&#39;t add it.</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            <span class="keywordflow">if</span> (camera.<a class="code" href="classlost_1_1_camera.html#a4d940919d1247edd431de7643473f538">InSensor</a>(inputStar.<a class="code" href="classlost_1_1_star.html#a8e9b2320d742fb5324397ac406c859ea">position</a>)</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                <span class="comment">// and also don&#39;t add it if it&#39;s too dim.</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                &amp;&amp; (cutoffMag &gt;= 10000 <span class="comment">// but always add the star if the cutoff is very high</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                    || !isTrueStar <span class="comment">// and always add the false stars</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                    || std::bernoulli_distribution(CentroidImagingProbability(catalogStar.<a class="code" href="classlost_1_1_catalog_star.html#aac362b166dd1a5cfe95e33a7e2d18e3a">magnitude</a>, cutoffMag))(*rng))) {</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                inputStars.push_back(inputStar);</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                <span class="keywordflow">if</span> (isTrueStar) {</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                    inputStarIds.push_back(<a class="code" href="classlost_1_1_star_identifier.html">StarIdentifier</a>(inputStars.size()-1, i));</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                }</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;            }</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        }</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    }</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160; </div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="keywordflow">if</span> (centroidsOnly) {</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        <span class="comment">// we&#39;re outta here</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    }</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160; </div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    std::vector&lt;float&gt; photonsBuffer(image.<a class="code" href="classlost_1_1_image.html#af450eb35614041beeb2bec120aac739e">width</a>*image.<a class="code" href="classlost_1_1_image.html#a705ef08de937ac85cf4a5c5e1084475e">height</a>, 0);</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160; </div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classlost_1_1_generated_star.html">GeneratedStar</a> &amp;star : generatedStars) {</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        <span class="comment">// delta will be exactly (0,0) when motion blur disabled</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        <a class="code" href="structlost_1_1_vec2.html">Vec2</a> earliestPosition = star.position - star.delta*(exposureTime/2.0 + readoutTime/2.0);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;        <a class="code" href="structlost_1_1_vec2.html">Vec2</a> latestPosition = star.position + star.delta*(exposureTime/2.0 + readoutTime/2.0);</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        <span class="keywordtype">int</span> xMin = std::max(0, (<span class="keywordtype">int</span>)std::min(earliestPosition.<a class="code" href="structlost_1_1_vec2.html#a9a9c151101dbb57060873e8af18927af">x</a> - star.radiusX, latestPosition.<a class="code" href="structlost_1_1_vec2.html#a9a9c151101dbb57060873e8af18927af">x</a> - star.radiusX));</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        <span class="keywordtype">int</span> xMax = std::min(image.<a class="code" href="classlost_1_1_image.html#af450eb35614041beeb2bec120aac739e">width</a>-1, (<span class="keywordtype">int</span>)std::max(earliestPosition.<a class="code" href="structlost_1_1_vec2.html#a9a9c151101dbb57060873e8af18927af">x</a> + star.radiusX, latestPosition.<a class="code" href="structlost_1_1_vec2.html#a9a9c151101dbb57060873e8af18927af">x</a> + star.radiusX));</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;        <span class="keywordtype">int</span> yMin = std::max(0, (<span class="keywordtype">int</span>)std::min(earliestPosition.<a class="code" href="structlost_1_1_vec2.html#a3a23d5b38c5873b4b870ace85fd30d05">y</a> - star.radiusX, latestPosition.<a class="code" href="structlost_1_1_vec2.html#a3a23d5b38c5873b4b870ace85fd30d05">y</a> - star.radiusX));</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        <span class="keywordtype">int</span> yMax = std::min(image.<a class="code" href="classlost_1_1_image.html#a705ef08de937ac85cf4a5c5e1084475e">height</a>-1, (<span class="keywordtype">int</span>)std::max(earliestPosition.<a class="code" href="structlost_1_1_vec2.html#a3a23d5b38c5873b4b870ace85fd30d05">y</a> + star.radiusX, latestPosition.<a class="code" href="structlost_1_1_vec2.html#a3a23d5b38c5873b4b870ace85fd30d05">y</a> + star.radiusX));</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160; </div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        <span class="comment">// peak brightness is measured in photons per time unit per pixel, so if oversampling, we</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;        <span class="comment">// need to convert units to photons per time unit per sample</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        <span class="keywordtype">float</span> oversamplingBrightnessFactor = oversamplingPerAxis*oversamplingPerAxis;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160; </div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        <span class="comment">// the star.x and star.y refer to the pixel whose top left corner the star should appear at</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        <span class="comment">// (and fractional amounts are relative to the corner). When we color a pixel, we ideally</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <span class="comment">// would integrate the intensity of the star over that pixel, but we can make do by sampling</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        <span class="comment">// the intensity of the star at the /center/ of the pixel, ie, star.x+.5 and star.y+.5</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> xPixel = xMin; xPixel &lt;= xMax; xPixel++) {</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> yPixel = yMin; yPixel &lt;= yMax; yPixel++) {</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                <span class="comment">// offset of beginning &amp; end of readout compared to beginning &amp; end of readout for</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                <span class="comment">// center row</span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                <span class="keywordtype">float</span> readoutOffset = readoutTime * (yPixel - image.<a class="code" href="classlost_1_1_image.html#a705ef08de937ac85cf4a5c5e1084475e">height</a>/2.0) / image.<a class="code" href="classlost_1_1_image.html#a705ef08de937ac85cf4a5c5e1084475e">height</a>;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                <span class="keywordtype">float</span> tStart = -exposureTime/2.0 + readoutOffset;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                <span class="keywordtype">float</span> tEnd = exposureTime/2.0 + readoutOffset;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160; </div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                <span class="comment">// loop through all samples in the current pixel</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                for (<span class="keywordtype">int</span> xSample = 0; xSample &lt; oversamplingPerAxis; xSample++) {</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ySample = 0; ySample &lt; oversamplingPerAxis; ySample++) {</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                        <span class="keywordtype">float</span> x = xPixel + (xSample+0.5)/oversamplingPerAxis;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                        <span class="keywordtype">float</span> y = yPixel + (ySample+0.5)/oversamplingPerAxis;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160; </div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                        <span class="keywordtype">float</span> curPhotons;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                        <span class="keywordflow">if</span> (motionBlurEnabled) {</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                            curPhotons =</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                                (MotionBlurredPixelBrightness({x, y}, star, tEnd, starSpreadStdDev)</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                                 - MotionBlurredPixelBrightness({x, y}, star, tStart, starSpreadStdDev))</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                                / oversamplingBrightnessFactor;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                            curPhotons = StaticPixelBrightness({x, y}, star, exposureTime, starSpreadStdDev)</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;                                / oversamplingBrightnessFactor;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                        }</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160; </div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                        assert(0.0 &lt;= curPhotons);</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160; </div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                        photonsBuffer[xPixel + yPixel*image.<a class="code" href="classlost_1_1_image.html#af450eb35614041beeb2bec120aac739e">width</a>] += curPhotons;</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                    }</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                }</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;            }</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        }</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    }</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160; </div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    std::normal_distribution&lt;float&gt; readNoiseDist(0.0, readNoiseStdDev);</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160; </div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    <span class="comment">// convert from photon counts to observed pixel brightnesses, applying noise and such.</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    imageData = std::vector&lt;unsigned char&gt;(image.<a class="code" href="classlost_1_1_image.html#af450eb35614041beeb2bec120aac739e">width</a>*image.<a class="code" href="classlost_1_1_image.html#a705ef08de937ac85cf4a5c5e1084475e">height</a>);</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    image.<a class="code" href="classlost_1_1_image.html#a1cf1464da2a2b11d9983ed1f022da26b">image</a> = imageData.data();</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; image.<a class="code" href="classlost_1_1_image.html#af450eb35614041beeb2bec120aac739e">width</a> * image.<a class="code" href="classlost_1_1_image.html#a705ef08de937ac85cf4a5c5e1084475e">height</a>; i++) {</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        <span class="keywordtype">float</span> curBrightness = 0;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160; </div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;        <span class="comment">// dark current (Constant)</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        curBrightness += darkCurrent;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160; </div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        <span class="comment">// read noise (Gaussian)</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        curBrightness += readNoiseDist(*rng);</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160; </div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        <span class="comment">// shot noise (Poisson), and quantize</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        <span class="keywordtype">long</span> quantizedPhotons;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        <span class="keywordflow">if</span> (shotNoise) {</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;            <span class="comment">// with GNU libstdc++, it keeps sampling from the distribution until it&#39;s within the min-max</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;            <span class="comment">// range. This is problematic if the mean is far above the max long value, because then it</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;            <span class="comment">// might have to sample many many times (and furthermore, the results won&#39;t be useful</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;            <span class="comment">// anyway)</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;            <span class="keywordtype">float</span> photons = photonsBuffer[i];</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;            <span class="keywordflow">if</span> (photons &gt; (<span class="keywordtype">float</span>)LONG_MAX - 3.0*sqrt(LONG_MAX)) {</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                std::cout &lt;&lt; <span class="stringliteral">&quot;ERROR: One of the pixels had too many photons. Generated image would not be physically accurate, exiting.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                exit(1);</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            }</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            std::poisson_distribution&lt;long&gt; shotNoiseDist(photonsBuffer[i]);</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            quantizedPhotons = shotNoiseDist(*rng);</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;            quantizedPhotons = round(photonsBuffer[i]);</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        }</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        curBrightness += quantizedPhotons / saturationPhotons;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160; </div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        <span class="comment">// std::clamp not introduced until C++17, so we avoid it.</span></div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        <span class="keywordtype">float</span> clampedBrightness = std::max(std::min(curBrightness, (<span class="keywordtype">float</span>)1.0), (<span class="keywordtype">float</span>)0.0);</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        imageData[i] = floor(clampedBrightness * <a class="code" href="namespacelost.html#a9b3311f3ebda1282ad7bf650de30cf45">kMaxBrightness</a>); <span class="comment">// TODO: off-by-one, 256?</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;    }</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;}</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160; </div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="keyword">static</span> <a class="code" href="classlost_1_1_attitude.html">Attitude</a> RandomAttitude(std::default_random_engine* pReng) {</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    std::uniform_real_distribution&lt;float&gt; randomAngleDistribution(0, 1);</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160; </div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="comment">// normally the ranges of the Ra and Dec are:</span></div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="comment">// Dec: [-90 deg, 90 deg] --&gt; [-pi/2 rad, pi/2 rad], where negative means south</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="comment">// of the celestial equator and positive means north</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="comment">// Ra: [0 deg, 360 deg] --&gt; [0 rad, 2pi rad ]</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="comment">// Roll: [0 rad, 2 pi rad]</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160; </div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="keywordtype">float</span> randomRa = 2 *  M_PI * randomAngleDistribution(*pReng);</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="keywordtype">float</span> randomDec = (M_PI / 2) - acos(1 - 2 * randomAngleDistribution(*pReng)); <span class="comment">//acos returns a float in range [0, pi]</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    <span class="keywordtype">float</span> randomRoll = 2 *  M_PI * randomAngleDistribution(*pReng);</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160; </div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    <a class="code" href="classlost_1_1_attitude.html">Attitude</a> randAttitude = <a class="code" href="classlost_1_1_attitude.html">Attitude</a>(<a class="code" href="namespacelost.html#a7057fa740aebe1cbd43f3bafafff4ac1">SphericalToQuaternion</a>(randomRa, randomDec, randomRoll));</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160; </div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <span class="keywordflow">return</span> randAttitude;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;}</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160; </div>
<div class="line"><a name="l00728"></a><span class="lineno"><a class="line" href="namespacelost.html#aec3a2012bf028c749ba53a46a50ad172">  728</a></span>&#160;<a class="code" href="namespacelost.html#acbd12c57a0797b6b786ebfc87aae0c84">PipelineInputList</a> <a class="code" href="namespacelost.html#aec3a2012bf028c749ba53a46a50ad172">GetGeneratedPipelineInput</a>(<span class="keyword">const</span> <a class="code" href="classlost_1_1_pipeline_options.html">PipelineOptions</a> &amp;values) {</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="comment">// TODO: prompt for attitude, imagewidth, etc and then construct a GeneratedPipelineInput</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160; </div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="keywordtype">int</span> seed;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160; </div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="comment">// time based seed if option specified</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    <span class="keywordflow">if</span> (values.timeSeed) {</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        seed = time(0);</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        seed = values.generateSeed;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    }</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160; </div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160; </div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    std::default_random_engine rng(seed);</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160; </div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    <span class="comment">// TODO: allow random angle generation?</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    <a class="code" href="classlost_1_1_attitude.html">Attitude</a> attitude = <a class="code" href="classlost_1_1_attitude.html">Attitude</a>(<a class="code" href="namespacelost.html#a7057fa740aebe1cbd43f3bafafff4ac1">SphericalToQuaternion</a>(<a class="code" href="namespacelost.html#abf3a90819d379c9a4d0c48f385f52613">DegToRad</a>(values.generateRa),</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                                                       <a class="code" href="namespacelost.html#abf3a90819d379c9a4d0c48f385f52613">DegToRad</a>(values.generateDe),</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                                                       <a class="code" href="namespacelost.html#abf3a90819d379c9a4d0c48f385f52613">DegToRad</a>(values.generateRoll)));</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160; </div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <a class="code" href="classlost_1_1_attitude.html">Attitude</a> motionBlurDirection = <a class="code" href="classlost_1_1_attitude.html">Attitude</a>(<a class="code" href="namespacelost.html#a7057fa740aebe1cbd43f3bafafff4ac1">SphericalToQuaternion</a>(<a class="code" href="namespacelost.html#abf3a90819d379c9a4d0c48f385f52613">DegToRad</a>(values.generateBlurRa),</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                                                                  <a class="code" href="namespacelost.html#abf3a90819d379c9a4d0c48f385f52613">DegToRad</a>(values.generateBlurDe),</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                                                                  <a class="code" href="namespacelost.html#abf3a90819d379c9a4d0c48f385f52613">DegToRad</a>(values.generateBlurRoll)));</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <a class="code" href="namespacelost.html#acbd12c57a0797b6b786ebfc87aae0c84">PipelineInputList</a> result;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160; </div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <span class="keywordtype">float</span> focalLength = <a class="code" href="namespacelost.html#a1187da9a83232a720a84bef1b99c5b58">FocalLengthFromOptions</a>(values);</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160; </div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160; </div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160; </div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; values.generate; i++) {</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160; </div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160; </div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        <a class="code" href="classlost_1_1_attitude.html">Attitude</a> inputAttitude;</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <span class="keywordflow">if</span> (values.generateRandomAttitudes) {</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            inputAttitude = RandomAttitude(&amp;rng);</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;            inputAttitude = attitude;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        }</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160; </div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        <a class="code" href="classlost_1_1_generated_pipeline_input.html">GeneratedPipelineInput</a> *curr = <span class="keyword">new</span> <a class="code" href="classlost_1_1_generated_pipeline_input.html">GeneratedPipelineInput</a>(</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                <a class="code" href="namespacelost.html#a41f5bb669129790c12bd70e1d641441f">CatalogRead</a>(),</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                inputAttitude,</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                <a class="code" href="classlost_1_1_camera.html">Camera</a>(focalLength, values.generateXRes, values.generateYRes),</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                &amp;rng,</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160; </div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                values.generateCentroidsOnly,</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;                values.generateZeroMagPhotons,</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;                values.generateSpreadStdDev,</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;                values.generateSaturationPhotons,</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;                values.generateDarkCurrent,</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                values.generateReadNoiseStdDev,</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;                motionBlurDirection,</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;                values.generateExposure,</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;                values.generateReadoutTime,</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                values.generateShotNoise,</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;                values.generateOversampling,</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                values.generateNumFalseStars,</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                (values.generateFalseMinMag * 100),</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;                (values.generateFalseMaxMag * 100),</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;                (values.generateCutoffMag * 100),</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                values.generatePerturbationStddev);</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160; </div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;            result.push_back(std::unique_ptr&lt;PipelineInput&gt;(curr));</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160; </div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160; </div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    }</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160; </div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160; </div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160; </div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;}</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160; </div>
<div class="line"><a name="l00800"></a><span class="lineno"><a class="line" href="namespacelost.html#a5552f98af725481dee70b9b39e12e064">  800</a></span>&#160;<span class="keyword">typedef</span> <a class="code" href="namespacelost.html#acbd12c57a0797b6b786ebfc87aae0c84">PipelineInputList</a> (*<a class="code" href="namespacelost.html#a5552f98af725481dee70b9b39e12e064">PipelineInputFactory</a>)();</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160; </div>
<div class="line"><a name="l00803"></a><span class="lineno"><a class="line" href="namespacelost.html#ad01d904e4a6bf5aed4a1b8f97f1416c5">  803</a></span>&#160;<a class="code" href="namespacelost.html#acbd12c57a0797b6b786ebfc87aae0c84">PipelineInputList</a> <a class="code" href="namespacelost.html#ad01d904e4a6bf5aed4a1b8f97f1416c5">GetPipelineInput</a>(<span class="keyword">const</span> <a class="code" href="classlost_1_1_pipeline_options.html">PipelineOptions</a> &amp;values) {</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160; </div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    <span class="keywordflow">if</span> (values.png != <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacelost.html#a72e465adc8dcb532e46b956261bf93fe">GetPngPipelineInput</a>(values);</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacelost.html#aec3a2012bf028c749ba53a46a50ad172">GetGeneratedPipelineInput</a>(values);</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    }</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;}</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160; </div>
<div class="line"><a name="l00816"></a><span class="lineno"><a class="line" href="classlost_1_1_pipeline.html#a3a135d2c7d1ab3ed8a05006fe5c7daa8">  816</a></span>&#160;<a class="code" href="classlost_1_1_pipeline.html#ab99f650efd24207ed56ae9d52399cff2">Pipeline::Pipeline</a>(<a class="code" href="classlost_1_1_centroid_algorithm.html">CentroidAlgorithm</a> *centroidAlgorithm,</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                   <a class="code" href="classlost_1_1_star_id_algorithm.html">StarIdAlgorithm</a> *starIdAlgorithm,</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                   <a class="code" href="classlost_1_1_attitude_estimation_algorithm.html">AttitudeEstimationAlgorithm</a> *attitudeEstimationAlgorithm,</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *database)</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    : <a class="code" href="classlost_1_1_pipeline.html">Pipeline</a>() {</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="keywordflow">if</span> (centroidAlgorithm) {</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;        this-&gt;centroidAlgorithm = std::unique_ptr&lt;CentroidAlgorithm&gt;(centroidAlgorithm);</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    }</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    <span class="keywordflow">if</span> (starIdAlgorithm) {</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        this-&gt;starIdAlgorithm = std::unique_ptr&lt;StarIdAlgorithm&gt;(starIdAlgorithm);</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    }</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="keywordflow">if</span> (attitudeEstimationAlgorithm) {</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        this-&gt;attitudeEstimationAlgorithm = std::unique_ptr&lt;AttitudeEstimationAlgorithm&gt;(attitudeEstimationAlgorithm);</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    }</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <span class="keywordflow">if</span> (database) {</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        this-&gt;database = std::unique_ptr&lt;unsigned char[]&gt;(database);</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    }</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;}</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160; </div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160; </div>
<div class="line"><a name="l00837"></a><span class="lineno"><a class="line" href="classlost_1_1_pipeline.html#a680908f5f23f826f938acd07074775cb">  837</a></span>&#160;<a class="code" href="classlost_1_1_pipeline.html">Pipeline</a> <a class="code" href="namespacelost.html#ad4bb00e632a9200a8e42f620e460dd60">SetPipeline</a>(<span class="keyword">const</span> <a class="code" href="classlost_1_1_pipeline_options.html">PipelineOptions</a> &amp;values) {</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <a class="code" href="classlost_1_1_pipeline.html">Pipeline</a> result;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160; </div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <span class="comment">// TODO: more flexible or sth</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    <span class="comment">// TODO: don&#39;t allow setting star-id until database is set, and perhaps limit the star-id</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    <span class="comment">// choices to those compatible with the database?</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160; </div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    <span class="comment">// centroid algorithm stage</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;    <span class="keywordflow">if</span> (values.centroidAlgo == <span class="stringliteral">&quot;dummy&quot;</span>) {</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        result.centroidAlgorithm = std::unique_ptr&lt;CentroidAlgorithm&gt;(<span class="keyword">new</span> <a class="code" href="classlost_1_1_dummy_centroid_algorithm.html">DummyCentroidAlgorithm</a>(values.centroidDummyNumStars));</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (values.centroidAlgo == <span class="stringliteral">&quot;cog&quot;</span>) {</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        result.centroidAlgorithm = std::unique_ptr&lt;CentroidAlgorithm&gt;(<span class="keyword">new</span> <a class="code" href="classlost_1_1_center_of_gravity_algorithm.html">CenterOfGravityAlgorithm</a>());</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (values.centroidAlgo == <span class="stringliteral">&quot;iwcog&quot;</span>) {</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        result.centroidAlgorithm = std::unique_ptr&lt;CentroidAlgorithm&gt;(<span class="keyword">new</span> <a class="code" href="classlost_1_1_iterative_weighted_center_of_gravity_algorithm.html">IterativeWeightedCenterOfGravityAlgorithm</a>());</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (values.centroidAlgo != <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;Illegal centroid algorithm.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        exit(1);</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    }</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160; </div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <span class="comment">// centroid magnitude filter stage</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <span class="keywordflow">if</span> (values.centroidMagFilter &gt; 0) result.centroidMinMagnitude = values.centroidMagFilter;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="keywordflow">if</span> (values.centroidFilterBrightest &gt; 0) result.centroidMinStars = values.centroidFilterBrightest;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160; </div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <span class="comment">// database stage</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="keywordflow">if</span> (values.databasePath != <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        std::fstream fs;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        fs.open(values.databasePath, std::fstream::in | std::fstream::binary);</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        fs.seekg(0, fs.end);</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        <span class="keywordtype">long</span> length = fs.tellg();</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        fs.seekg(0, fs.beg);</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;Reading &quot;</span> &lt;&lt; length &lt;&lt; <span class="stringliteral">&quot; bytes of database&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        result.database = std::unique_ptr&lt;unsigned char[]&gt;(<span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>[length]);</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        fs.read((<span class="keywordtype">char</span> *)result.database.get(), length);</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;Done&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    }</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160; </div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="keywordflow">if</span> (values.idAlgo == <span class="stringliteral">&quot;dummy&quot;</span>) {</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        result.starIdAlgorithm = std::unique_ptr&lt;StarIdAlgorithm&gt;(<span class="keyword">new</span> <a class="code" href="classlost_1_1_dummy_star_id_algorithm.html">DummyStarIdAlgorithm</a>());</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (values.idAlgo == <span class="stringliteral">&quot;gv&quot;</span>) {</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;        result.starIdAlgorithm = std::unique_ptr&lt;StarIdAlgorithm&gt;(<span class="keyword">new</span> <a class="code" href="classlost_1_1_geometric_voting_star_id_algorithm.html">GeometricVotingStarIdAlgorithm</a>(<a class="code" href="namespacelost.html#abf3a90819d379c9a4d0c48f385f52613">DegToRad</a>(values.angularTolerance)));</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (values.idAlgo == <span class="stringliteral">&quot;py&quot;</span>) {</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;        result.starIdAlgorithm = std::unique_ptr&lt;StarIdAlgorithm&gt;(<span class="keyword">new</span> <a class="code" href="classlost_1_1_pyramid_star_id_algorithm.html">PyramidStarIdAlgorithm</a>(<a class="code" href="namespacelost.html#abf3a90819d379c9a4d0c48f385f52613">DegToRad</a>(values.angularTolerance), values.estimatedNumFalseStars, values.maxMismatchProb, 1000));</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (values.idAlgo != <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;Illegal id algorithm.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;        exit(1);</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    }</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160; </div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="keywordflow">if</span> (values.attitudeAlgo == <span class="stringliteral">&quot;dqm&quot;</span>) {</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        result.attitudeEstimationAlgorithm = std::unique_ptr&lt;AttitudeEstimationAlgorithm&gt;(<span class="keyword">new</span> <a class="code" href="classlost_1_1_davenport_q_algorithm.html">DavenportQAlgorithm</a>());</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (values.attitudeAlgo == <span class="stringliteral">&quot;triad&quot;</span>) {</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        result.attitudeEstimationAlgorithm = std::unique_ptr&lt;AttitudeEstimationAlgorithm&gt;(<span class="keyword">new</span> <a class="code" href="classlost_1_1_triad_algorithm.html">TriadAlgorithm</a>());</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (values.attitudeAlgo == <span class="stringliteral">&quot;quest&quot;</span>) {</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        result.attitudeEstimationAlgorithm = std::unique_ptr&lt;AttitudeEstimationAlgorithm&gt;(<span class="keyword">new</span> <a class="code" href="classlost_1_1_quest_algorithm.html">QuestAlgorithm</a>());</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (values.attitudeAlgo != <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        std::cout &lt;&lt; <span class="stringliteral">&quot;Illegal attitude algorithm.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        exit(1);</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    }</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160; </div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;}</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160; </div>
<div class="line"><a name="l00903"></a><span class="lineno"><a class="line" href="classlost_1_1_pipeline.html#aea0fe125836ac0c6906886ad320f5210">  903</a></span>&#160;<a class="code" href="structlost_1_1_pipeline_output.html">PipelineOutput</a> <a class="code" href="classlost_1_1_pipeline.html#aea0fe125836ac0c6906886ad320f5210">Pipeline::Go</a>(<span class="keyword">const</span> <a class="code" href="classlost_1_1_pipeline_input.html">PipelineInput</a> &amp;input) {</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <span class="comment">// Start executing the pipeline at the first stage that has both input and an algorithm. From</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    <span class="comment">// there, execute each successive stage of the pipeline using the output of the last stage</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    <span class="comment">// (human centipede) until there are no more stages set.</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    <a class="code" href="structlost_1_1_pipeline_output.html">PipelineOutput</a> result;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160; </div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    <span class="keyword">const</span> <a class="code" href="classlost_1_1_image.html">Image</a> *inputImage = input.<a class="code" href="classlost_1_1_pipeline_input.html#a4df52c585005abf1154699cb89570db8">InputImage</a>();</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacelost.html#a4bd359d9c09dbecb81c3a3e536f0b5c5">Stars</a> *inputStars = input.<a class="code" href="classlost_1_1_pipeline_input.html#aa6c9969bb4118ddf877a1000636f6486">InputStars</a>();</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacelost.html#a288b872531de219e9cfc87beb8d8bada">StarIdentifiers</a> *inputStarIds = input.<a class="code" href="classlost_1_1_pipeline_input.html#a3942b6fcacd994b5d9f841a770d895bc">InputStarIds</a>();</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160; </div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    <span class="comment">// if database is provided, that&#39;s where we get catalog from.</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <span class="keywordflow">if</span> (database) {</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        <a class="code" href="classlost_1_1_multi_database.html">MultiDatabase</a> multiDatabase(database.get());</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *catalogBuffer = multiDatabase.<a class="code" href="classlost_1_1_multi_database.html#ad013d7640b19cb78268c9be5f6c64544">SubDatabasePointer</a>(<a class="code" href="namespacelost.html#a280b11c878f729f878b2968037ccbc3d">kCatalogMagicValue</a>);</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        <span class="keywordflow">if</span> (catalogBuffer != NULL) {</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;            result.<a class="code" href="structlost_1_1_pipeline_output.html#a18bcd3f7aa001bd26cbc67a2ae3ffcca">catalog</a> = <a class="code" href="namespacelost.html#af4b650ecb61d27c188477fc9fbf4c886">DeserializeCatalog</a>(multiDatabase.<a class="code" href="classlost_1_1_multi_database.html#ad013d7640b19cb78268c9be5f6c64544">SubDatabasePointer</a>(<a class="code" href="namespacelost.html#a280b11c878f729f878b2968037ccbc3d">kCatalogMagicValue</a>), NULL, NULL);</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;            std::cerr &lt;&lt; <span class="stringliteral">&quot;WARNING: That database does not include a catalog. Proceeding with the full catalog.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;            result.<a class="code" href="structlost_1_1_pipeline_output.html#a18bcd3f7aa001bd26cbc67a2ae3ffcca">catalog</a> = input.<a class="code" href="classlost_1_1_pipeline_input.html#a31278ee2b910cf3e8af25f71aefcf295">GetCatalog</a>();</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        }</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;        result.<a class="code" href="structlost_1_1_pipeline_output.html#a18bcd3f7aa001bd26cbc67a2ae3ffcca">catalog</a> = input.<a class="code" href="classlost_1_1_pipeline_input.html#a31278ee2b910cf3e8af25f71aefcf295">GetCatalog</a>();</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    }</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160; </div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    <span class="keywordflow">if</span> (centroidAlgorithm &amp;&amp; inputImage) {</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160; </div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        <span class="comment">// run centroiding, keeping track of the time it takes</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;        std::chrono::time_point&lt;std::chrono::steady_clock&gt; start = std::chrono::steady_clock::now();</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160; </div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        <span class="comment">// TODO: we should probably modify Go to just take an image argument</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;        <a class="code" href="namespacelost.html#a4bd359d9c09dbecb81c3a3e536f0b5c5">Stars</a> unfilteredStars = centroidAlgorithm-&gt;Go(inputImage-&gt;<a class="code" href="classlost_1_1_image.html#a1cf1464da2a2b11d9983ed1f022da26b">image</a>, inputImage-&gt;<a class="code" href="classlost_1_1_image.html#af450eb35614041beeb2bec120aac739e">width</a>, inputImage-&gt;<a class="code" href="classlost_1_1_image.html#a705ef08de937ac85cf4a5c5e1084475e">height</a>);</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160; </div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        std::chrono::time_point&lt;std::chrono::steady_clock&gt; end = std::chrono::steady_clock::now();</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;        result.<a class="code" href="structlost_1_1_pipeline_output.html#ab299485c94c8d2f5c4094869fadd8a62">centroidingTimeNs</a> = std::chrono::duration_cast&lt;std::chrono::nanoseconds&gt;(end - start).count();</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160; </div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        <span class="comment">// MAGNITUDE FILTERING</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        <span class="keywordtype">int</span> minMagnitude = centroidMinMagnitude;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        <span class="keywordflow">if</span> (centroidMinStars &gt; 0</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;            <span class="comment">// don&#39;t need to filter if we don&#39;t even have that many stars</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;            &amp;&amp; centroidMinStars &lt; (<span class="keywordtype">int</span>)unfilteredStars.size()) {</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160; </div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;            <a class="code" href="namespacelost.html#a4bd359d9c09dbecb81c3a3e536f0b5c5">Stars</a> magSortedStars = unfilteredStars;</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;            <span class="comment">// sort descending</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;            std::sort(magSortedStars.begin(), magSortedStars.end(), [](<span class="keyword">const</span> <a class="code" href="classlost_1_1_star.html">Star</a> &amp;a, <span class="keyword">const</span> <a class="code" href="classlost_1_1_star.html">Star</a> &amp;b) { return a.magnitude &gt; b.magnitude; });</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;            minMagnitude = std::max(minMagnitude, magSortedStars[centroidMinStars - 1].magnitude);</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;        }</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        <span class="comment">// determine the minimum magnitude according to sorted stars</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        <a class="code" href="namespacelost.html#a4bd359d9c09dbecb81c3a3e536f0b5c5">Stars</a> *filteredStars = <span class="keyword">new</span> std::vector&lt;Star&gt;();</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classlost_1_1_star.html">Star</a> &amp;star : unfilteredStars) {</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;            assert(star.magnitude &gt;= 0); <span class="comment">// catalog stars can have negative magnitude, but by our</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;                                         <span class="comment">// conventions, centroids shouldn&#39;t.</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;            <span class="keywordflow">if</span> (star.magnitude &gt;= minMagnitude) {</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                filteredStars-&gt;push_back(star);</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;            }</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        }</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;        result.<a class="code" href="structlost_1_1_pipeline_output.html#a7743f8496f64299c8af36ac0ec080699">stars</a> = std::unique_ptr&lt;Stars&gt;(filteredStars);</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;        inputStars = filteredStars;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160; </div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;        <span class="comment">// any starid set up to this point needs to be discarded, because it&#39;s based on input</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        <span class="comment">// centroids instead of our new centroids.</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;        inputStarIds = NULL;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;        result.<a class="code" href="structlost_1_1_pipeline_output.html#af5fb349aaee63e4e932069bc01743042">starIds</a> = NULL;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (centroidAlgorithm) {</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;ERROR: Centroid algorithm specified, but no input image to run it on.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;        exit(1);</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    }</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160; </div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <span class="keywordflow">if</span> (starIdAlgorithm &amp;&amp; database &amp;&amp; inputStars &amp;&amp; input.<a class="code" href="classlost_1_1_pipeline_input.html#af88962a236353e511724a699dab7a785">InputCamera</a>()) {</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        <span class="comment">// TODO: don&#39;t copy the vector!</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        std::chrono::time_point&lt;std::chrono::steady_clock&gt; start = std::chrono::steady_clock::now();</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160; </div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;        result.<a class="code" href="structlost_1_1_pipeline_output.html#af5fb349aaee63e4e932069bc01743042">starIds</a> = std::unique_ptr&lt;StarIdentifiers&gt;(<span class="keyword">new</span> std::vector&lt;StarIdentifier&gt;(</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;            starIdAlgorithm-&gt;Go(database.get(), *inputStars, result.<a class="code" href="structlost_1_1_pipeline_output.html#a18bcd3f7aa001bd26cbc67a2ae3ffcca">catalog</a>, *input.<a class="code" href="classlost_1_1_pipeline_input.html#af88962a236353e511724a699dab7a785">InputCamera</a>())));</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160; </div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;        std::chrono::time_point&lt;std::chrono::steady_clock&gt; end = std::chrono::steady_clock::now();</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;        result.<a class="code" href="structlost_1_1_pipeline_output.html#ab56fb6e6eafedf6134659395be542305">starIdTimeNs</a> = std::chrono::duration_cast&lt;std::chrono::nanoseconds&gt;(end - start).count();</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160; </div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        inputStarIds = result.<a class="code" href="structlost_1_1_pipeline_output.html#af5fb349aaee63e4e932069bc01743042">starIds</a>.get();</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (starIdAlgorithm) {</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;ERROR: Star ID algorithm specified but cannot run because database, centroids, or camera are missing.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;        exit(1);</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;    }</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160; </div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;    <span class="keywordflow">if</span> (attitudeEstimationAlgorithm &amp;&amp; inputStarIds &amp;&amp; input.<a class="code" href="classlost_1_1_pipeline_input.html#af88962a236353e511724a699dab7a785">InputCamera</a>()) {</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        assert(inputStars); <span class="comment">// ensure that starIds doesn&#39;t exist without stars</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;        std::chrono::time_point&lt;std::chrono::steady_clock&gt; start = std::chrono::steady_clock::now();</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160; </div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        result.<a class="code" href="structlost_1_1_pipeline_output.html#ad2be75247ab893fb920ece9f2eb800f8">attitude</a> = std::unique_ptr&lt;Attitude&gt;(</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;            <span class="keyword">new</span> <a class="code" href="classlost_1_1_attitude.html">Attitude</a>(attitudeEstimationAlgorithm-&gt;Go(*input.<a class="code" href="classlost_1_1_pipeline_input.html#af88962a236353e511724a699dab7a785">InputCamera</a>(), *inputStars, result.<a class="code" href="structlost_1_1_pipeline_output.html#a18bcd3f7aa001bd26cbc67a2ae3ffcca">catalog</a>, *inputStarIds)));</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160; </div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;        std::chrono::time_point&lt;std::chrono::steady_clock&gt; end = std::chrono::steady_clock::now();</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;        result.<a class="code" href="structlost_1_1_pipeline_output.html#a49482206ef9a4c6baacb708433168010">attitudeEstimationTimeNs</a> = std::chrono::duration_cast&lt;std::chrono::nanoseconds&gt;(end - start).count();</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (attitudeEstimationAlgorithm) {</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;ERROR: Attitude estimation algorithm set, but either star IDs or camera are missing. One reason this can happen: Setting a centroid algorithm and attitude algorithm, but no star-id algorithm -- that can&#39;t work because the input star-ids won&#39;t properly correspond to the output centroids!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        exit(1);</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    }</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160; </div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;}</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160; </div>
<div class="line"><a name="l01004"></a><span class="lineno"><a class="line" href="classlost_1_1_pipeline.html#a880d560ff40f68a2bbdc2cacc943e09d"> 1004</a></span>&#160;std::vector&lt;PipelineOutput&gt; <a class="code" href="classlost_1_1_pipeline.html#aea0fe125836ac0c6906886ad320f5210">Pipeline::Go</a>(<span class="keyword">const</span> <a class="code" href="namespacelost.html#acbd12c57a0797b6b786ebfc87aae0c84">PipelineInputList</a> &amp;inputs) {</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    std::vector&lt;PipelineOutput&gt; result;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160; </div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160; </div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> std::unique_ptr&lt;PipelineInput&gt; &amp;input : inputs) {</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        result.push_back(<a class="code" href="classlost_1_1_pipeline.html#aea0fe125836ac0c6906886ad320f5210">Go</a>(*input));</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    }</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160; </div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;}</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160; </div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="comment">// COMPARISON //</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01023"></a><span class="lineno"><a class="line" href="classlost_1_1_centroid_comparison.html"> 1023</a></span>&#160;<span class="keyword">class </span><a class="code" href="classlost_1_1_centroid_comparison.html">CentroidComparison</a> {</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l01025"></a><span class="lineno"><a class="line" href="classlost_1_1_centroid_comparison.html#ad46cc5ba0521e788511aac2bbdc2569d"> 1025</a></span>&#160;    <a class="code" href="classlost_1_1_centroid_comparison.html#ad46cc5ba0521e788511aac2bbdc2569d">CentroidComparison</a>() : <a class="code" href="classlost_1_1_centroid_comparison.html#ac1e005780ebb245a3baafde37654aafa">meanError</a>(0.0), <a class="code" href="classlost_1_1_centroid_comparison.html#a69b42b7776ce7d288d15bf0ab1fceb55">numCorrectCentroids</a>(0), <a class="code" href="classlost_1_1_centroid_comparison.html#a4105577ec96bf66b9a5003dcde18d557">numExtraCentroids</a>(0) { }</div>
<div class="line"><a name="l01030"></a><span class="lineno"><a class="line" href="classlost_1_1_centroid_comparison.html#ac1e005780ebb245a3baafde37654aafa"> 1030</a></span>&#160;    <span class="keywordtype">float</span> <a class="code" href="classlost_1_1_centroid_comparison.html#ac1e005780ebb245a3baafde37654aafa">meanError</a>;</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160; </div>
<div class="line"><a name="l01035"></a><span class="lineno"><a class="line" href="classlost_1_1_centroid_comparison.html#a69b42b7776ce7d288d15bf0ab1fceb55"> 1035</a></span>&#160;    <span class="keywordtype">float</span> <a class="code" href="classlost_1_1_centroid_comparison.html#a69b42b7776ce7d288d15bf0ab1fceb55">numCorrectCentroids</a>;</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160; </div>
<div class="line"><a name="l01041"></a><span class="lineno"><a class="line" href="classlost_1_1_centroid_comparison.html#a4105577ec96bf66b9a5003dcde18d557"> 1041</a></span>&#160;    <span class="keywordtype">float</span> <a class="code" href="classlost_1_1_centroid_comparison.html#a4105577ec96bf66b9a5003dcde18d557">numExtraCentroids</a>;</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160; </div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    <span class="comment">// We no longer have a num missing because often generated stars have too low of a signal-to-noise ratio and the centroid algo won&#39;t pick them up.</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;};</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160; </div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="keyword">static</span> std::multimap&lt;int, int&gt; FindClosestCentroids(<span class="keywordtype">float</span> threshold,</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;                                                    <span class="keyword">const</span> <a class="code" href="namespacelost.html#a4bd359d9c09dbecb81c3a3e536f0b5c5">Stars</a> &amp;one,</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                                                    <span class="keyword">const</span> <a class="code" href="namespacelost.html#a4bd359d9c09dbecb81c3a3e536f0b5c5">Stars</a> &amp;two) {</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    std::multimap&lt;int, int&gt; result;</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160; </div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; (int)one.size(); i++) {</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        std::vector&lt;std::pair&lt;float, int&gt;&gt; closest;</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; (int)two.size(); k++) {</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;            <span class="keywordtype">float</span> currDistance = (one[i].position - two[k].position).Magnitude();</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;            <span class="keywordflow">if</span> (currDistance &lt;= threshold) {</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;                closest.emplace_back(currDistance, k);</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;            }</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;        }</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;        std::sort(closest.begin(), closest.end());</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">const</span> std::pair&lt;float, int&gt; &amp;pair : closest) {</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;            result.emplace(i, pair.second);</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;        }</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    }</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160; </div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;}</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160; </div>
<div class="line"><a name="l01077"></a><span class="lineno"><a class="line" href="namespacelost.html#afd017fba4090829c28c431509c4cfc1c"> 1077</a></span>&#160;<a class="code" href="classlost_1_1_centroid_comparison.html">CentroidComparison</a> <a class="code" href="namespacelost.html#afd017fba4090829c28c431509c4cfc1c">CentroidsCompare</a>(<span class="keywordtype">float</span> threshold,</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;                                    <span class="keyword">const</span> <a class="code" href="namespacelost.html#a4bd359d9c09dbecb81c3a3e536f0b5c5">Stars</a> &amp;expected,</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;                                    <span class="keyword">const</span> <a class="code" href="namespacelost.html#a4bd359d9c09dbecb81c3a3e536f0b5c5">Stars</a> &amp;actual) {</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160; </div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    <span class="comment">// TODO: Somehow penalize when multiple centroids correspond to the same expected star (i.e.,</span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    <span class="comment">// one star turned into multiple centroids). That should probably be considered an extra</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <span class="comment">// centroid, but rn it isn&#39;t.</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160; </div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    <a class="code" href="classlost_1_1_centroid_comparison.html">CentroidComparison</a> result;</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    <span class="comment">// maps from indexes in each list to the closest centroid from other list</span></div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    std::multimap&lt;int, int&gt; actualToExpected = FindClosestCentroids(threshold, actual, expected);</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160; </div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; (int)actualToExpected.size(); i++) {</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        <span class="keyword">auto</span> closest = actualToExpected.find(i);</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;        <span class="keywordflow">if</span> (closest == actualToExpected.end()) {</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;            result.<a class="code" href="classlost_1_1_centroid_comparison.html#a4105577ec96bf66b9a5003dcde18d557">numExtraCentroids</a>++;</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;            result.<a class="code" href="classlost_1_1_centroid_comparison.html#ac1e005780ebb245a3baafde37654aafa">meanError</a> += (actual[i].position - expected[closest-&gt;second].position).Magnitude();</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;            result.<a class="code" href="classlost_1_1_centroid_comparison.html#a69b42b7776ce7d288d15bf0ab1fceb55">numCorrectCentroids</a>++;</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;        }</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    }</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    result.<a class="code" href="classlost_1_1_centroid_comparison.html#ac1e005780ebb245a3baafde37654aafa">meanError</a> /= result.<a class="code" href="classlost_1_1_centroid_comparison.html#a69b42b7776ce7d288d15bf0ab1fceb55">numCorrectCentroids</a>;</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160; </div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;}</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160; </div>
<div class="line"><a name="l01103"></a><span class="lineno"><a class="line" href="namespacelost.html#a0fe01051c958fa8ced02e772aefdc991"> 1103</a></span>&#160;<a class="code" href="classlost_1_1_centroid_comparison.html">CentroidComparison</a> <a class="code" href="namespacelost.html#a0fe01051c958fa8ced02e772aefdc991">CentroidComparisonsCombine</a>(std::vector&lt;CentroidComparison&gt; comparisons) {</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    assert(comparisons.size() &gt; 0);</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160; </div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    <a class="code" href="classlost_1_1_centroid_comparison.html">CentroidComparison</a> result;</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160; </div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classlost_1_1_centroid_comparison.html">CentroidComparison</a> &amp;comparison : comparisons) {</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;        result.<a class="code" href="classlost_1_1_centroid_comparison.html#ac1e005780ebb245a3baafde37654aafa">meanError</a> += comparison.meanError;</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;        result.<a class="code" href="classlost_1_1_centroid_comparison.html#a69b42b7776ce7d288d15bf0ab1fceb55">numCorrectCentroids</a> += comparison.numCorrectCentroids;</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        result.<a class="code" href="classlost_1_1_centroid_comparison.html#a4105577ec96bf66b9a5003dcde18d557">numExtraCentroids</a> += comparison.numExtraCentroids;</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    }</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160; </div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    result.<a class="code" href="classlost_1_1_centroid_comparison.html#ac1e005780ebb245a3baafde37654aafa">meanError</a> /= comparisons.size();</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    result.<a class="code" href="classlost_1_1_centroid_comparison.html#a4105577ec96bf66b9a5003dcde18d557">numExtraCentroids</a> /= comparisons.size();</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    result.<a class="code" href="classlost_1_1_centroid_comparison.html#a69b42b7776ce7d288d15bf0ab1fceb55">numCorrectCentroids</a> /= comparisons.size();</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160; </div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;}</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160; </div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="comment">// (documentation in hpp)</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"><a class="line" href="namespacelost.html#ab6f75e99dbde3eede31e0b3a7c56878e"> 1122</a></span>&#160;<a class="code" href="structlost_1_1_star_id_comparison.html">StarIdComparison</a> <a class="code" href="namespacelost.html#ab6f75e99dbde3eede31e0b3a7c56878e">StarIdsCompare</a>(<span class="keyword">const</span> <a class="code" href="namespacelost.html#a288b872531de219e9cfc87beb8d8bada">StarIdentifiers</a> &amp;expected, <span class="keyword">const</span> <a class="code" href="namespacelost.html#a288b872531de219e9cfc87beb8d8bada">StarIdentifiers</a> &amp;actual,</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;                                <span class="comment">// use these to map indices to names for the respective lists of StarIdentifiers</span></div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;                                <span class="keyword">const</span> <a class="code" href="namespacelost.html#aef1a1d4dd4620ebdc2197877569a44f6">Catalog</a> &amp;expectedCatalog, <span class="keyword">const</span> <a class="code" href="namespacelost.html#aef1a1d4dd4620ebdc2197877569a44f6">Catalog</a> &amp;actualCatalog,</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;                                <span class="keywordtype">float</span> centroidThreshold,</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;                                <span class="keyword">const</span> <a class="code" href="namespacelost.html#a4bd359d9c09dbecb81c3a3e536f0b5c5">Stars</a> &amp;expectedStars, <span class="keyword">const</span> <a class="code" href="namespacelost.html#a4bd359d9c09dbecb81c3a3e536f0b5c5">Stars</a> &amp;inputStars) {</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160; </div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    <a class="code" href="structlost_1_1_star_id_comparison.html">StarIdComparison</a> result = {</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;        0, <span class="comment">// correct</span></div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;        0, <span class="comment">// incorrect</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;        0, <span class="comment">// total</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    };</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160; </div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    <span class="comment">// EXPECTED STAR IDS</span></div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160; </div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    <span class="comment">// map from expected star indices to expected catalog indices (basically flattening the expected star-ids)</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    std::vector&lt;int&gt; expectedCatalogIndices(expectedStars.size(), -1);</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classlost_1_1_star_identifier.html">StarIdentifier</a> &amp;starId : expected) {</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;        assert(0 &lt;= starId.starIndex &amp;&amp; starId.starIndex &lt;= (<span class="keywordtype">int</span>)expectedStars.size());</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;        assert(0 &lt;= starId.catalogIndex &amp;&amp; starId.catalogIndex &lt;= (<span class="keywordtype">int</span>)expectedCatalog.size());</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;        expectedCatalogIndices[starId.starIndex] = starId.catalogIndex;</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    }</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160; </div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    <span class="comment">// FIND NEAREST CENTROIDS</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160; </div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    std::multimap&lt;int, int&gt; inputToExpectedCentroids = FindClosestCentroids(centroidThreshold, inputStars, expectedStars);</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    <span class="comment">// std::multimap&lt;int, int&gt; expectedToInputCentroids = FindClosestCentroids(centroidThreshold, expectedStars, inputStars);</span></div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160; </div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;    <span class="comment">// COMPUTE TOTAL</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    <span class="comment">// Count the number of expected stars with at least one input star near them</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; (int)inputStars.size(); i++) {</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;        <span class="comment">// make sure there&#39;s at least one expected star near this input star which has an identification</span></div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;        <span class="keyword">auto</span> closestRange = inputToExpectedCentroids.equal_range(i);</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;        <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = closestRange.first; it != closestRange.second; it++) {</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;            <span class="keywordflow">if</span> (expectedCatalogIndices[it-&gt;second] != -1) {</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;                found = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;            }</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;        }</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;        <span class="keywordflow">if</span> (found) {</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;            result.<a class="code" href="structlost_1_1_star_id_comparison.html#a8534ab9d04bf422ea323c1e65008dc10">numTotal</a>++;</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;        }</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    }</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160; </div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    <span class="comment">// COMPUTE CORRECT AND INCORRECT</span></div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160; </div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    std::vector&lt;bool&gt; identifiedInputCentroids(inputStars.size(), <span class="keyword">false</span>);</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="classlost_1_1_star_identifier.html">StarIdentifier</a> &amp;starId : actual) {</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;        <span class="comment">// as later, there shouldn&#39;t be duplicate starIndex. This indicates a bug in the star-id algorithm, not comparison code.</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;        assert(!identifiedInputCentroids[starId.starIndex]);</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;        identifiedInputCentroids[starId.starIndex] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;        assert(0 &lt;= starId.starIndex &amp;&amp; starId.starIndex &lt;= (<span class="keywordtype">int</span>)inputStars.size());</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;        assert(0 &lt;= starId.catalogIndex &amp;&amp; starId.catalogIndex &lt;= (<span class="keywordtype">int</span>)actualCatalog.size());</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160; </div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;        <span class="comment">// Check that there&#39;s at least one expected centroid in range which agrees with your identification.</span></div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;        <span class="keyword">auto</span> expectedCentroidsInRange = inputToExpectedCentroids.equal_range(starId.starIndex);</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;        <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;        <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = expectedCentroidsInRange.first; it != expectedCentroidsInRange.second; it++) {</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;            <span class="keywordtype">int</span> expectedCatalogIndex = expectedCatalogIndices[it-&gt;second];</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;            <span class="keywordflow">if</span> (expectedCatalogIndex != -1</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;                &amp;&amp; expectedCatalog[expectedCatalogIndex].name == actualCatalog[starId.catalogIndex].name) {</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160; </div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;                result.<a class="code" href="structlost_1_1_star_id_comparison.html#a188f3594728b5cf2ebf8a74c2e6ba01d">numCorrect</a>++;</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;                found = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;            }</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;        }</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160; </div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;        <span class="comment">// Either there&#39;s no expected centroid in range, or none of them agree with the identification.</span></div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;        <span class="keywordflow">if</span> (!found) {</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;            result.<a class="code" href="structlost_1_1_star_id_comparison.html#aba82ab6b00ac56a4536f9ac204639567">numIncorrect</a>++;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;        }</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    }</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160; </div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;}</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160; </div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="comment">// PIPELINE OUTPUT //</span></div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01203"></a><span class="lineno"><a class="line" href="namespacelost.html#ab001adf3b7887c7b7a72d308893c48b2"> 1203</a></span>&#160;<span class="keyword">typedef</span> void (*<a class="code" href="namespacelost.html#ab001adf3b7887c7b7a72d308893c48b2">PipelineComparator</a>)(std::ostream &amp;os,</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;                                   <span class="keyword">const</span> <a class="code" href="namespacelost.html#acbd12c57a0797b6b786ebfc87aae0c84">PipelineInputList</a> &amp;,</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;                                   <span class="keyword">const</span> std::vector&lt;PipelineOutput&gt; &amp;,</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;                                   <span class="keyword">const</span> <a class="code" href="classlost_1_1_pipeline_options.html">PipelineOptions</a> &amp;);</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160; </div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;<span class="keyword">static</span> cairo_status_t OstreamPlotter(<span class="keywordtype">void</span> *closure, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *data, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> length) {</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;    std::ostream *os = (std::ostream *)closure;</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    os-&gt;write((<span class="keyword">const</span> <span class="keywordtype">char</span> *)data, length);</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    <span class="keywordflow">return</span> CAIRO_STATUS_SUCCESS;</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;}</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160; </div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> PipelineComparatorPlotRawInput(std::ostream &amp;os,</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;                                    <span class="keyword">const</span> <a class="code" href="namespacelost.html#acbd12c57a0797b6b786ebfc87aae0c84">PipelineInputList</a> &amp;expected,</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;                                    <span class="keyword">const</span> std::vector&lt;PipelineOutput&gt; &amp;,</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;                                    <span class="keyword">const</span> PipelineOptions &amp;) {</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160; </div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    cairo_surface_t *cairoSurface = expected[0]-&gt;InputImageSurface();</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    cairo_surface_write_to_png_stream(cairoSurface, OstreamPlotter, &amp;os);</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    cairo_surface_destroy(cairoSurface);</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;}</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160; </div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;<span class="comment">// TODO: should probably use Expected methods, not Input methods, because future PipelineInputs could add noise to the result of the Input methods.</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> PipelineComparatorPlotInput(std::ostream &amp;os,</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;                                 <span class="keyword">const</span> <a class="code" href="namespacelost.html#acbd12c57a0797b6b786ebfc87aae0c84">PipelineInputList</a> &amp;expected,</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;                                 <span class="keyword">const</span> std::vector&lt;PipelineOutput&gt; &amp;,</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;                                 <span class="keyword">const</span> PipelineOptions &amp;) {</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;    cairo_surface_t *cairoSurface = expected[0]-&gt;InputImageSurface();</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;    assert(expected[0]-&gt;InputStars() != NULL);</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;    <a class="code" href="namespacelost.html#a8298f03c0d1b408401e4200d17305018">SurfacePlot</a>(<span class="stringliteral">&quot;pipeline input&quot;</span>,</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;                cairoSurface,</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;                *expected[0]-&gt;InputStars(),</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;                expected[0]-&gt;InputStarIds(),</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;                &amp;expected[0]-&gt;GetCatalog(),</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;                expected[0]-&gt;InputAttitude(),</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;                <span class="comment">// green</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;                0.0, 1.0, 0.0, 0.6);</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    cairo_surface_write_to_png_stream(cairoSurface, OstreamPlotter, &amp;os);</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;    cairo_surface_destroy(cairoSurface);</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;}</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160; </div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> PipelineComparatorPlotExpected(std::ostream &amp;os,</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;                                    <span class="keyword">const</span> <a class="code" href="namespacelost.html#acbd12c57a0797b6b786ebfc87aae0c84">PipelineInputList</a> &amp;expected,</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;                                    <span class="keyword">const</span> std::vector&lt;PipelineOutput&gt; &amp;,</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;                                    <span class="keyword">const</span> PipelineOptions &amp;) {</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    cairo_surface_t *cairoSurface = expected[0]-&gt;InputImageSurface();</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    assert(expected[0]-&gt;ExpectedStars() != NULL);</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    <a class="code" href="namespacelost.html#a8298f03c0d1b408401e4200d17305018">SurfacePlot</a>(<span class="stringliteral">&quot;expected output&quot;</span>,</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;                cairoSurface,</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;                *expected[0]-&gt;ExpectedStars(),</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;                expected[0]-&gt;ExpectedStarIds(),</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;                &amp;expected[0]-&gt;GetCatalog(),</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;                expected[0]-&gt;ExpectedAttitude(),</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;                <span class="comment">// blu</span></div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;                0.2, 0.5, 1.0, 0.7);</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    cairo_surface_write_to_png_stream(cairoSurface, OstreamPlotter, &amp;os);</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;    cairo_surface_destroy(cairoSurface);</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;}</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160; </div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> PipelineComparatorCentroids(std::ostream &amp;os,</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;                                 <span class="keyword">const</span> <a class="code" href="namespacelost.html#acbd12c57a0797b6b786ebfc87aae0c84">PipelineInputList</a> &amp;expected,</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;                                 <span class="keyword">const</span> std::vector&lt;PipelineOutput&gt; &amp;actual,</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;                                 <span class="keyword">const</span> PipelineOptions &amp;values) {</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    <span class="keywordtype">int</span> size = (int)expected.size();</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160; </div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;    <span class="keywordtype">float</span> threshold = values.centroidCompareThreshold;</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160; </div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    std::vector&lt;CentroidComparison&gt; comparisons;</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size; i++) {</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;        comparisons.push_back(<a class="code" href="namespacelost.html#afd017fba4090829c28c431509c4cfc1c">CentroidsCompare</a>(threshold,</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;                                               *(expected[i]-&gt;ExpectedStars()),</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;                                               *(actual[i].stars)));</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;    }</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160; </div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    CentroidComparison result = <a class="code" href="namespacelost.html#a0fe01051c958fa8ced02e772aefdc991">CentroidComparisonsCombine</a>(comparisons);</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;centroids_num_correct &quot;</span> &lt;&lt; result.numCorrectCentroids &lt;&lt; std::endl</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;       &lt;&lt; <span class="stringliteral">&quot;centroids_num_extra &quot;</span> &lt;&lt; result.numExtraCentroids &lt;&lt; std::endl</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;       &lt;&lt; <span class="stringliteral">&quot;centroids_mean_error &quot;</span> &lt;&lt; result.meanError &lt;&lt; std::endl;</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;}</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160; </div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> PrintCentroids(<span class="keyword">const</span> std::string &amp;prefix,</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;                           std::ostream &amp;os,</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;                           <span class="keyword">const</span> <a class="code" href="namespacelost.html#aef1a1d4dd4620ebdc2197877569a44f6">Catalog</a> &amp;catalog,</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;                           <span class="keyword">const</span> std::vector&lt;Stars&gt; &amp;starses,</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;                           <span class="comment">// May be NULL. Should be the only the first starId, because we don&#39;t have any reasonable aggregative action to perform.</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;                           <span class="keyword">const</span> <a class="code" href="namespacelost.html#a288b872531de219e9cfc87beb8d8bada">StarIdentifiers</a> *starIds) {</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    assert(starses.size() &gt; 0);</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    <span class="keywordtype">float</span> avgNumStars = 0;</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="namespacelost.html#a4bd359d9c09dbecb81c3a3e536f0b5c5">Stars</a> &amp;stars : starses) {</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;        avgNumStars += stars.size();</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    }</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    avgNumStars /= starses.size();</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160; </div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;num_&quot;</span> &lt;&lt; prefix &lt;&lt; <span class="stringliteral">&quot;_centroids &quot;</span> &lt;&lt; avgNumStars &lt;&lt; std::endl;</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    <span class="keywordflow">if</span> (starses.size() == 1) {</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacelost.html#a4bd359d9c09dbecb81c3a3e536f0b5c5">Stars</a> &amp;stars = starses[0];</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; (int)stars.size(); i++) {</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;            os &lt;&lt; prefix &lt;&lt; <span class="stringliteral">&quot;_centroid_&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;_x &quot;</span> &lt;&lt; stars[i].position.x &lt;&lt; std::endl;</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;            os &lt;&lt; prefix &lt;&lt; <span class="stringliteral">&quot;_centroid_&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;_y &quot;</span> &lt;&lt; stars[i].position.y &lt;&lt; std::endl;</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;            <span class="keywordflow">if</span> (starIds) {</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;                <span class="keywordflow">for</span> (<span class="keyword">const</span> StarIdentifier &amp;starId : *starIds) {</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;                    <span class="keywordflow">if</span> (starId.starIndex == i) {</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;                        os &lt;&lt; prefix &lt;&lt; <span class="stringliteral">&quot;_centroid_&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;_id &quot;</span> &lt;&lt; catalog[starId.catalogIndex].name &lt;&lt; std::endl;</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;                    }</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;                }</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;            }</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;        }</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    }</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;}</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160; </div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> PipelineComparatorPrintExpectedCentroids(std::ostream &amp;os,</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;                                                     <span class="keyword">const</span> <a class="code" href="namespacelost.html#acbd12c57a0797b6b786ebfc87aae0c84">PipelineInputList</a> &amp;expected,</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;                                                     <span class="keyword">const</span> std::vector&lt;PipelineOutput&gt; &amp;, <span class="comment">// actual</span></div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;                                                     <span class="keyword">const</span> PipelineOptions &amp;) {</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    assert(expected.size() &gt; 0);</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    assert(expected[0]-&gt;ExpectedStars());</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160; </div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    std::vector&lt;Stars&gt; expectedStarses;</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;input : expected) {</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;        expectedStarses.push_back(*input-&gt;ExpectedStars());</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    }</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    PrintCentroids(<span class="stringliteral">&quot;expected&quot;</span>,</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;                   os,</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;                   expected[0]-&gt;GetCatalog(),</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;                   expectedStarses,</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;                   expected[0]-&gt;ExpectedStarIds());</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;}</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160; </div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> PipelineComparatorPrintInputCentroids(std::ostream &amp;os,</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;                                                  <span class="keyword">const</span> <a class="code" href="namespacelost.html#acbd12c57a0797b6b786ebfc87aae0c84">PipelineInputList</a> &amp;expected,</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;                                                  <span class="keyword">const</span> std::vector&lt;PipelineOutput&gt; &amp;, <span class="comment">// actual</span></div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;                                                  <span class="keyword">const</span> PipelineOptions &amp;) {</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    assert(expected.size() &gt; 0);</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;    assert(expected[0]-&gt;InputStars());</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160; </div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    std::vector&lt;Stars&gt; inputStarses;</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;input : expected) {</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;        inputStarses.push_back(*input-&gt;InputStars());</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    }</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    PrintCentroids(<span class="stringliteral">&quot;input&quot;</span>,</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;                   os,</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;                   expected[0]-&gt;GetCatalog(),</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;                   inputStarses,</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;                   expected[0]-&gt;InputStarIds());</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;}</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160; </div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> PipelineComparatorPrintActualCentroids(std::ostream &amp;os,</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;                                                   <span class="keyword">const</span> <a class="code" href="namespacelost.html#acbd12c57a0797b6b786ebfc87aae0c84">PipelineInputList</a> &amp;, <span class="comment">// expected</span></div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;                                                   <span class="keyword">const</span> std::vector&lt;PipelineOutput&gt; &amp;actual,</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;                                                   <span class="keyword">const</span> PipelineOptions &amp;) {</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;    assert(actual.size() == 1);</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    assert(actual[0].stars);</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160; </div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    std::vector&lt;Stars&gt; actualStarses;</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span> &amp;output : actual) {</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;        actualStarses.push_back(*output.stars);</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    }</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    PrintCentroids(<span class="stringliteral">&quot;actual&quot;</span>,</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;                   os,</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;                   actual[0].catalog,</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;                   actualStarses,</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;                   actual[0].starIds.get());</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;}</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160; </div>
<div class="line"><a name="l01373"></a><span class="lineno"><a class="line" href="namespacelost.html#a69cfc1189a8f18fb6e6a6d400a8a1311"> 1373</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacelost.html#a69cfc1189a8f18fb6e6a6d400a8a1311">PipelineComparatorPlotCentroidIndices</a>(std::ostream &amp;os,</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;                                           <span class="keyword">const</span> <a class="code" href="namespacelost.html#acbd12c57a0797b6b786ebfc87aae0c84">PipelineInputList</a> &amp;expected,</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;                                           <span class="keyword">const</span> std::vector&lt;PipelineOutput&gt; &amp;actual,</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;                                           <span class="keyword">const</span> <a class="code" href="classlost_1_1_pipeline_options.html">PipelineOptions</a> &amp;) {</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    <span class="keyword">const</span> <a class="code" href="namespacelost.html#a4bd359d9c09dbecb81c3a3e536f0b5c5">Stars</a> &amp;stars = actual[0].stars ? *actual[0].stars : *expected[0]-&gt;InputStars();</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    <a class="code" href="namespacelost.html#a288b872531de219e9cfc87beb8d8bada">StarIdentifiers</a> identifiers;</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; (int)stars.size(); i++) {</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;        identifiers.push_back(<a class="code" href="classlost_1_1_star_identifier.html">StarIdentifier</a>(i, i));</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;    }</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    cairo_surface_t *cairoSurface = expected[0]-&gt;InputImageSurface();</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    <a class="code" href="namespacelost.html#a8298f03c0d1b408401e4200d17305018">SurfacePlot</a>(<span class="stringliteral">&quot;centroid indices (input)&quot;</span>,</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;                cairoSurface,</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;                stars,</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;                &amp;identifiers,</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;                &amp;actual[0].catalog,</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;                NULL,</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;                <span class="comment">// orange</span></div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;                1.0, 0.5, 0.0, 0.5,</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;                <span class="comment">// don&#39;t resolve names</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;                <span class="keyword">true</span>);</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    cairo_surface_write_to_png_stream(cairoSurface, OstreamPlotter, &amp;os);</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    cairo_surface_destroy(cairoSurface);</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;}</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160; </div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> PipelineComparatorPlotOutput(std::ostream &amp;os,</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;                                         <span class="keyword">const</span> <a class="code" href="namespacelost.html#acbd12c57a0797b6b786ebfc87aae0c84">PipelineInputList</a> &amp;expected,</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;                                         <span class="keyword">const</span> std::vector&lt;PipelineOutput&gt; &amp;actual,</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;                                         <span class="keyword">const</span> PipelineOptions &amp;) {</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    <span class="comment">// don&#39;t need to worry about mutating the surface; InputImageSurface returns a fresh one</span></div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    cairo_surface_t *cairoSurface = expected[0]-&gt;InputImageSurface();</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    <a class="code" href="namespacelost.html#a8298f03c0d1b408401e4200d17305018">SurfacePlot</a>(<span class="stringliteral">&quot;pipeline output&quot;</span>,</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;                cairoSurface,</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;                actual[0].stars ? *actual[0].stars : *expected[0]-&gt;InputStars(),</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;                actual[0].starIds.get(),</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;                &amp;actual[0].catalog,</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;                actual[0].attitude.get(),</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;                <span class="comment">// red</span></div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;                1.0, 0.0, 0.0, 0.5);</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    cairo_surface_write_to_png_stream(cairoSurface, OstreamPlotter, &amp;os);</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    cairo_surface_destroy(cairoSurface);</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;}</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160; </div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> PipelineComparatorStarIds(std::ostream &amp;os,</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;                                      <span class="keyword">const</span> <a class="code" href="namespacelost.html#acbd12c57a0797b6b786ebfc87aae0c84">PipelineInputList</a> &amp;expected,</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;                                      <span class="keyword">const</span> std::vector&lt;PipelineOutput&gt; &amp;actual,</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;                                      <span class="keyword">const</span> PipelineOptions &amp;values) {</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <span class="keywordtype">int</span> numImagesCorrect = 0;</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    <span class="keywordtype">int</span> numImagesIncorrect = 0;</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;    <span class="keywordtype">int</span> numImagesTotal = expected.size();</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; numImagesTotal; i++) {</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;        <span class="comment">// since the actual star IDs exist, it must have gotten input from somewhere!</span></div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;        <span class="comment">// TODO: overhaul: It seems that in these comparators there should be a more fundamental way to figure out the input that was actually sent to a stage.</span></div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;        <span class="comment">// I.e., instead of having expected and actual arguments, have some sort of PipelineRunSummary object, where the InputStars method looks at actual, then input.</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;        assert(actual[i].stars.get() || expected[i]-&gt;InputStars());</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160; </div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;        <span class="keyword">const</span> <a class="code" href="namespacelost.html#a4bd359d9c09dbecb81c3a3e536f0b5c5">Stars</a> &amp;inputStars = actual[i].stars.get()</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;            ? *actual[i].stars.get()</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;            : *expected[i]-&gt;InputStars();</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;        StarIdComparison comparison =</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;            <a class="code" href="namespacelost.html#ab6f75e99dbde3eede31e0b3a7c56878e">StarIdsCompare</a>(*expected[i]-&gt;ExpectedStarIds(), *actual[i].starIds,</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;                           expected[i]-&gt;GetCatalog(), actual[i].catalog,</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;                           values.centroidCompareThreshold, *expected[i]-&gt;ExpectedStars(), inputStars);</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160; </div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;        <span class="keywordflow">if</span> (numImagesTotal == 1) {</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;            os &lt;&lt; <span class="stringliteral">&quot;starid_num_correct &quot;</span> &lt;&lt; comparison.numCorrect &lt;&lt; std::endl;</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;            os &lt;&lt; <span class="stringliteral">&quot;starid_num_incorrect &quot;</span> &lt;&lt; comparison.numIncorrect &lt;&lt; std::endl;</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;            os &lt;&lt; <span class="stringliteral">&quot;starid_num_total &quot;</span> &lt;&lt; comparison.numTotal &lt;&lt; std::endl;</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;        }</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160; </div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;        <span class="keywordflow">if</span> (comparison.numCorrect &gt; 0 &amp;&amp; comparison.numIncorrect == 0) {</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;            numImagesCorrect++;</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;        }</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;        <span class="keywordflow">if</span> (comparison.numIncorrect &gt; 0) {</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;            numImagesIncorrect++;</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;        }</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    }</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160; </div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    <span class="comment">// A &quot;correct&quot; image is one where at least two stars are correctly id&#39;d and none are incorrectly id&#39;d</span></div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;starid_num_images_correct &quot;</span> &lt;&lt; numImagesCorrect &lt;&lt; std::endl;</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;starid_num_images_incorrect &quot;</span> &lt;&lt; numImagesIncorrect &lt;&lt; std::endl;</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;}</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160; </div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> PipelineComparatorPrintAttitude(std::ostream &amp;os,</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;                                            <span class="keyword">const</span> <a class="code" href="namespacelost.html#acbd12c57a0797b6b786ebfc87aae0c84">PipelineInputList</a> &amp;,</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;                                            <span class="keyword">const</span> std::vector&lt;PipelineOutput&gt; &amp;actual,</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;                                            <span class="keyword">const</span> PipelineOptions &amp;) {</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    assert(actual.size() == 1);</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    assert(actual[0].attitude);</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160; </div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    <span class="comment">// os &lt;&lt; &quot;attitude_real &quot; &lt;&lt; actual[0].attitude-&gt;real &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;    <span class="comment">// os &lt;&lt; &quot;attitude_i &quot; &lt;&lt; actual[0].attitude-&gt;i &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;    <span class="comment">// os &lt;&lt; &quot;attitude_j &quot; &lt;&lt; actual[0].attitude-&gt;j &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;    <span class="comment">// os &lt;&lt; &quot;attitude_k &quot; &lt;&lt; actual[0].attitude-&gt;k &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    EulerAngles spherical = actual[0].attitude-&gt;ToSpherical();</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;attitude_ra &quot;</span> &lt;&lt; <a class="code" href="namespacelost.html#adc5108f643b7657a835838c7f6411aa7">RadToDeg</a>(spherical.ra) &lt;&lt; std::endl;</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;attitude_de &quot;</span> &lt;&lt; <a class="code" href="namespacelost.html#adc5108f643b7657a835838c7f6411aa7">RadToDeg</a>(spherical.de) &lt;&lt; std::endl;</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;attitude_roll &quot;</span> &lt;&lt; <a class="code" href="namespacelost.html#adc5108f643b7657a835838c7f6411aa7">RadToDeg</a>(spherical.roll) &lt;&lt; std::endl;</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;}</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160; </div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> PipelineComparatorAttitude(std::ostream &amp;os,</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;                                       <span class="keyword">const</span> <a class="code" href="namespacelost.html#acbd12c57a0797b6b786ebfc87aae0c84">PipelineInputList</a> &amp;expected,</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;                                       <span class="keyword">const</span> std::vector&lt;PipelineOutput&gt; &amp;actual,</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;                                       <span class="keyword">const</span> PipelineOptions &amp;values) {</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160; </div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;    <span class="comment">// TODO: use Wahba loss function (maybe average per star) instead of just angle. Also break</span></div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;    <span class="comment">// apart roll error from boresight error. This is just quick and dirty for testing</span></div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160; </div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    <span class="keywordtype">float</span> angleThreshold = <a class="code" href="namespacelost.html#abf3a90819d379c9a4d0c48f385f52613">DegToRad</a>(values.attitudeCompareThreshold);</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160; </div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    <span class="keywordtype">float</span> attitudeErrorSum = 0.0f;</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    <span class="keywordtype">int</span> numCorrect = 0;</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160; </div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; (int)expected.size(); i++) {</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;        Quaternion expectedQuaternion = expected[i]-&gt;ExpectedAttitude()-&gt;GetQuaternion();</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;        Quaternion actualQuaternion = actual[i].attitude-&gt;GetQuaternion();</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;        <span class="keywordtype">float</span> attitudeError = (expectedQuaternion * actualQuaternion.Conjugate()).<a class="code" href="namespacelost.html#a6b951e30f05e0a748e6c906697002093">Angle</a>();</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;        assert(attitudeError &gt;= 0);</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160; </div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;        attitudeErrorSum += attitudeError;</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;        <span class="keywordflow">if</span> (attitudeError &lt;= angleThreshold) {</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;            numCorrect++;</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;        }</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    }</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160; </div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    <span class="keywordtype">float</span> attitudeErrorMean = attitudeErrorSum / expected.size();</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    <span class="keywordtype">float</span> fractionCorrect = (float)numCorrect / expected.size();</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160; </div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;attitude_error_mean &quot;</span> &lt;&lt; attitudeErrorMean &lt;&lt; std::endl;</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;attitude_num_correct &quot;</span> &lt;&lt; numCorrect &lt;&lt; std::endl;</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    os &lt;&lt; <span class="stringliteral">&quot;attitude_fraction_correct &quot;</span> &lt;&lt; fractionCorrect &lt;&lt; std::endl;</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;}</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160; </div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> PrintTimeStats(std::ostream &amp;os, <span class="keyword">const</span> std::string &amp;prefix, <span class="keyword">const</span> std::vector&lt;long&gt; &amp;times) {</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    assert(times.size() &gt; 0);</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160; </div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;    <span class="comment">// print average, min, max, and 95% max</span></div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;    <span class="keywordtype">long</span> sum = 0;</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    <span class="keywordtype">long</span> min = LONG_MAX;</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;    <span class="keywordtype">long</span> max = 0;</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; (int)times.size(); i++) {</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;        assert(times[i] &gt; 0);</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;        sum += times[i];</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;        min = std::min(min, times[i]);</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;        max = std::max(max, times[i]);</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    }</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;    <span class="keywordtype">long</span> average = sum / times.size();</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;    std::vector&lt;long&gt; sortedTimes = times;</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;    std::sort(sortedTimes.begin(), sortedTimes.end());</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    <span class="comment">// what really is the 95th percentile? Being conservative, we want to pick a value that at least</span></div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;    <span class="comment">// 95% of the times are less than. This means: (1) finding the number of times, (2) Finding</span></div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;    <span class="comment">// Math.ceil(0.95 * numTimes), and (3) subtracting 1 to get the index.</span></div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;    <span class="keywordtype">int</span> ninetyFiveIndex = (int)std::ceil(0.95 * times.size()) - 1;</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    assert(ninetyFiveIndex &gt;= 0);</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    <span class="keywordtype">long</span> ninetyFifthPercentile = sortedTimes[ninetyFiveIndex];</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160; </div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;    os &lt;&lt; prefix &lt;&lt; <span class="stringliteral">&quot;_average_ns &quot;</span> &lt;&lt; average &lt;&lt; std::endl;</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;    os &lt;&lt; prefix &lt;&lt; <span class="stringliteral">&quot;_min_ns &quot;</span> &lt;&lt; min &lt;&lt; std::endl;</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    os &lt;&lt; prefix &lt;&lt; <span class="stringliteral">&quot;_max_ns &quot;</span> &lt;&lt; max &lt;&lt; std::endl;</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;    os &lt;&lt; prefix &lt;&lt; <span class="stringliteral">&quot;_95%_ns &quot;</span> &lt;&lt; ninetyFifthPercentile &lt;&lt; std::endl;</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;}</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160; </div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> PipelineComparatorPrintSpeed(std::ostream &amp;os,</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;                                    <span class="keyword">const</span> <a class="code" href="namespacelost.html#acbd12c57a0797b6b786ebfc87aae0c84">PipelineInputList</a> &amp;,</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;                                    <span class="keyword">const</span> std::vector&lt;PipelineOutput&gt; &amp;actual,</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;                                    <span class="keyword">const</span> PipelineOptions &amp;) {</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;    std::vector&lt;long&gt; centroidingTimes;</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;    std::vector&lt;long&gt; starIdTimes;</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    std::vector&lt;long&gt; attitudeTimes;</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    std::vector&lt;long&gt; totalTimes;</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; (int)actual.size(); i++) {</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;        <span class="keywordtype">long</span> totalTime = 0;</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;        <span class="keywordflow">if</span> (actual[i].centroidingTimeNs &gt; 0) {</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;            centroidingTimes.push_back(actual[i].centroidingTimeNs);</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;            totalTime += actual[i].centroidingTimeNs;</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;        }</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;        <span class="keywordflow">if</span> (actual[i].starIdTimeNs &gt; 0) {</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;            starIdTimes.push_back(actual[i].starIdTimeNs);</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;            totalTime += actual[i].starIdTimeNs;</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;        }</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;        <span class="keywordflow">if</span> (actual[i].attitudeEstimationTimeNs &gt; 0) {</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;            attitudeTimes.push_back(actual[i].attitudeEstimationTimeNs);</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;            totalTime += actual[i].attitudeEstimationTimeNs;</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;        }</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;        totalTimes.push_back(totalTime);</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;    }</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    <span class="keywordflow">if</span> (centroidingTimes.size() &gt; 0) {</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;        PrintTimeStats(os, <span class="stringliteral">&quot;centroiding&quot;</span>, centroidingTimes);</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    }</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    <span class="keywordflow">if</span> (starIdTimes.size() &gt; 0) {</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;        PrintTimeStats(os, <span class="stringliteral">&quot;starid&quot;</span>, starIdTimes);</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    }</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    <span class="keywordflow">if</span> (attitudeTimes.size() &gt; 0) {</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;        PrintTimeStats(os, <span class="stringliteral">&quot;attitude&quot;</span>, attitudeTimes);</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;    }</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    PrintTimeStats(os, <span class="stringliteral">&quot;total&quot;</span>, totalTimes);</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;}</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160; </div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;<span class="comment">// TODO: add these debug comparators back in!</span></div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;<span class="comment">// void PipelineComparatorPrintPairDistance(std::ostream &amp;os,</span></div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;<span class="comment">//                                          const PipelineInputList &amp;expected,</span></div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;<span class="comment">//                                          const std::vector&lt;PipelineOutput&gt; &amp;actual) {</span></div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;<span class="comment">//     int index1 = Prompt&lt;int&gt;(&quot;Index of first star&quot;);</span></div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;<span class="comment">//     int index2 = Prompt&lt;int&gt;(&quot;Index of second star&quot;);</span></div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160; </div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;<span class="comment">//     const Camera &amp;camera = *expected[0]-&gt;InputCamera();</span></div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;<span class="comment">//     const Stars &amp;stars = *actual[0].stars;</span></div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160; </div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;<span class="comment">//     assert(index1 &gt;= 0 &amp;&amp; index2 &gt;= 0 &amp;&amp; index1 &lt; (int)stars.size() &amp;&amp; index2 &lt; (int)stars.size());</span></div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;<span class="comment">//     os &lt;&lt; &quot;pair_distance &quot; &lt;&lt; Angle(camera.CameraToSpatial(stars[index1].position),</span></div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;<span class="comment">//                                     camera.CameraToSpatial(stars[index2].position))</span></div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;<span class="comment">//        &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;<span class="comment">// }</span></div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160; </div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;<span class="comment">// void PipelineComparatorPrintPyramidDistances(std::ostream &amp;os,</span></div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;<span class="comment">//                                              const PipelineInputList &amp;expected,</span></div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;<span class="comment">//                                              const std::vector&lt;PipelineOutput&gt; &amp;actual) {</span></div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;<span class="comment">//     int index1 = Prompt&lt;int&gt;(&quot;Catalog name/index of first star&quot;);</span></div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;<span class="comment">//     int index2 = Prompt&lt;int&gt;(&quot;Catalog name/index of second star&quot;);</span></div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;<span class="comment">//     int index3 = Prompt&lt;int&gt;(&quot;Catalog name/index of third star&quot;);</span></div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;<span class="comment">//     int index4 = Prompt&lt;int&gt;(&quot;Catalog name/index of four star&quot;);</span></div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160; </div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;<span class="comment">//     const Camera &amp;camera = *expected[0]-&gt;InputCamera();</span></div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;<span class="comment">//     const Stars &amp;stars = *actual[0].stars;</span></div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160; </div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;<span class="comment">//     Vec3 spatial1 = camera.CameraToSpatial(stars[index1].position);</span></div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;<span class="comment">//     Vec3 spatial2 = camera.CameraToSpatial(stars[index2].position);</span></div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;<span class="comment">//     Vec3 spatial3 = camera.CameraToSpatial(stars[index3].position);</span></div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;<span class="comment">//     Vec3 spatial4 = camera.CameraToSpatial(stars[index4].position);</span></div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160; </div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;<span class="comment">//     std::cout &lt;&lt; &quot;pair_distance_12 &quot; &lt;&lt; Angle(spatial1, spatial2) &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;<span class="comment">//     std::cout &lt;&lt; &quot;pair_distance_13 &quot; &lt;&lt; Angle(spatial1, spatial3) &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;<span class="comment">//     std::cout &lt;&lt; &quot;pair_distance_14 &quot; &lt;&lt; Angle(spatial1, spatial4) &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;<span class="comment">//     std::cout &lt;&lt; &quot;pair_distance_23 &quot; &lt;&lt; Angle(spatial2, spatial3) &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;<span class="comment">//     std::cout &lt;&lt; &quot;pair_distance_24 &quot; &lt;&lt; Angle(spatial2, spatial4) &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;<span class="comment">//     std::cout &lt;&lt; &quot;pair_distance_34 &quot; &lt;&lt; Angle(spatial3, spatial4) &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;<span class="comment">// }</span></div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160; </div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;<span class="comment">// void PipelineComparatorPrintTripleAngle(std::ostream &amp;os,</span></div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;<span class="comment">//                                         const PipelineInputList &amp;expected,</span></div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;<span class="comment">//                                         const std::vector&lt;PipelineOutput&gt; &amp;actual) {</span></div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;<span class="comment">//     int index1 = Prompt&lt;int&gt;(&quot;Index of first star&quot;);</span></div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;<span class="comment">//     int index2 = Prompt&lt;int&gt;(&quot;Index of second star&quot;);</span></div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;<span class="comment">//     int index3 = Prompt&lt;int&gt;(&quot;Index of third star&quot;);</span></div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160; </div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;<span class="comment">//     const Camera &amp;camera = *expected[0]-&gt;InputCamera();</span></div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;<span class="comment">//     const Stars &amp;stars = *actual[0].stars;</span></div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160; </div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="comment">//     assert(index1 &gt;= 0 &amp;&amp; index1 &lt; (int)stars.size());</span></div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="comment">//     assert(index2 &gt;= 0 &amp;&amp; index2 &lt; (int)stars.size());</span></div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;<span class="comment">//     assert(index3 &gt;= 0 &amp;&amp; index3 &lt; (int)stars.size());</span></div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160; </div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;<span class="comment">//     // TODO, when merging with nondimensional branch</span></div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;<span class="comment">// }</span></div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160; </div>
<div class="line"><a name="l01636"></a><span class="lineno"><a class="line" href="namespacelost.html#ad2caa7f022ed5c5dba03ab479414dafc"> 1636</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacelost.html#ad2caa7f022ed5c5dba03ab479414dafc">PipelineComparison</a>(<span class="keyword">const</span> <a class="code" href="namespacelost.html#acbd12c57a0797b6b786ebfc87aae0c84">PipelineInputList</a> &amp;expected,</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;                        <span class="keyword">const</span> std::vector&lt;PipelineOutput&gt; &amp;actual,</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;                        <span class="keyword">const</span> <a class="code" href="classlost_1_1_pipeline_options.html">PipelineOptions</a> &amp;values) {</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;    <span class="keywordflow">if</span> (actual.size() == 0) {</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;ERROR: No output! Did you specify any input images? Try --png or --generate.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;        exit(1);</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;    }</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160; </div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;    assert(expected.size() == actual.size() &amp;&amp; expected.size() &gt; 0);</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160; </div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;    <span class="comment">// TODO: Remove the asserts and print out more reasonable error messages.</span></div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160; </div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;<span class="preprocessor">#define LOST_PIPELINE_COMPARE(precondition, errmsg, comparator, path, isBinary) do { \</span></div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;<span class="preprocessor">        if (precondition) {                                             \</span></div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;<span class="preprocessor">            UserSpecifiedOutputStream pos(path, isBinary);              \</span></div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;<span class="preprocessor">            comparator(pos.Stream(), expected, actual, values);         \</span></div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;<span class="preprocessor">        } else {                                                        \</span></div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;<span class="preprocessor">            std::cerr &lt;&lt; &quot;ERROR: Comparator not applicable: &quot;</span> &lt;&lt; errmsg &lt;&lt; std::endl; \</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;            exit(1);                                                    \</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;        }                                                               \</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;    } while (0)</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160; </div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;    <span class="keywordflow">if</span> (values.plotRawInput != <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;        <a class="code" href="io_8cpp.html#aa20cea40f78380bdd173e9636fe1f442">LOST_PIPELINE_COMPARE</a>(expected[0]-&gt;InputImage() &amp;&amp; expected.size() == 1,</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;                              <span class="stringliteral">&quot;--plot-raw-input requires exactly 1 input image, but &quot;</span> + std::to_string(expected.size()) + <span class="stringliteral">&quot; many were provided.&quot;</span>,</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;                              PipelineComparatorPlotRawInput, values.plotRawInput, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;    }</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160; </div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;    <span class="keywordflow">if</span> (values.plotInput != <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;        <a class="code" href="io_8cpp.html#aa20cea40f78380bdd173e9636fe1f442">LOST_PIPELINE_COMPARE</a>(expected[0]-&gt;InputImage() &amp;&amp; expected.size() == 1 &amp;&amp; expected[0]-&gt;InputStars(),</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;                              <span class="stringliteral">&quot;--plot-input requires exactly 1 input image, and for centroids to be available on that input image. &quot;</span> + std::to_string(expected.size()) + <span class="stringliteral">&quot; many input images were provided.&quot;</span>,</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;                              PipelineComparatorPlotInput, values.plotInput, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;    }</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;    <span class="keywordflow">if</span> (values.plotExpected != <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;        <a class="code" href="io_8cpp.html#aa20cea40f78380bdd173e9636fe1f442">LOST_PIPELINE_COMPARE</a>(expected[0]-&gt;InputImage() &amp;&amp; expected.size() == 1 &amp;&amp; expected[0]-&gt;ExpectedStars(),</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;                              <span class="stringliteral">&quot;--plot-expected-input requires exactly 1 input image, and for expected centroids to be available on that input image. &quot;</span> + std::to_string(expected.size()) + <span class="stringliteral">&quot; many input images were provided.&quot;</span>,</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;                              PipelineComparatorPlotExpected, values.plotExpected, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;    }</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;    <span class="keywordflow">if</span> (values.plotOutput != <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;        <a class="code" href="io_8cpp.html#aa20cea40f78380bdd173e9636fe1f442">LOST_PIPELINE_COMPARE</a>(actual.size() == 1 &amp;&amp; (actual[0].stars || actual[0].starIds),</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;                              <span class="stringliteral">&quot;--plot-output requires exactly 1 output image, and for either centroids or star IDs to be available on that output image. &quot;</span> + std::to_string(actual.size()) + <span class="stringliteral">&quot; many output images were provided.&quot;</span>,</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;                              PipelineComparatorPlotOutput, values.plotOutput, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;    }</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;    <span class="keywordflow">if</span> (values.printExpectedCentroids != <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;        <a class="code" href="io_8cpp.html#aa20cea40f78380bdd173e9636fe1f442">LOST_PIPELINE_COMPARE</a>(expected[0]-&gt;ExpectedStars(),</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;                              <span class="stringliteral">&quot;--print-expected-centroids requires at least 1 input with expected centroids. &quot;</span> + std::to_string(expected.size()) + <span class="stringliteral">&quot; many input images were provided.&quot;</span>,</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;                              PipelineComparatorPrintExpectedCentroids, values.printExpectedCentroids, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;    }</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;    <span class="keywordflow">if</span> (values.printInputCentroids != <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;        <a class="code" href="io_8cpp.html#aa20cea40f78380bdd173e9636fe1f442">LOST_PIPELINE_COMPARE</a>(expected[0]-&gt;InputStars(),</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;                              <span class="stringliteral">&quot;--print-input-centroids requires at least 1 input with centroids. &quot;</span> + std::to_string(expected.size()) + <span class="stringliteral">&quot; many input images were provided.&quot;</span>,</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;                              PipelineComparatorPrintInputCentroids, values.printInputCentroids, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;    }</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;    <span class="keywordflow">if</span> (values.printActualCentroids != <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;        <a class="code" href="io_8cpp.html#aa20cea40f78380bdd173e9636fe1f442">LOST_PIPELINE_COMPARE</a>(actual[0].stars,</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;                              <span class="stringliteral">&quot;--print-actual-centroids requires at least 1 output image, and for centroids to be available on the output images. &quot;</span> + std::to_string(actual.size()) + <span class="stringliteral">&quot; many output images were provided.&quot;</span>,</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;                              PipelineComparatorPrintActualCentroids, values.printActualCentroids, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;    }</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;    <span class="keywordflow">if</span> (values.plotCentroidIndices != <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;        <a class="code" href="io_8cpp.html#aa20cea40f78380bdd173e9636fe1f442">LOST_PIPELINE_COMPARE</a>(expected.size() == 1 &amp;&amp; expected[0]-&gt;InputImage(),</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;                              <span class="stringliteral">&quot;--plot-centroid-indices requires exactly 1 input with image. &quot;</span> + std::to_string(expected.size()) + <span class="stringliteral">&quot; many inputs were provided.&quot;</span>,</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;                              <a class="code" href="namespacelost.html#a69cfc1189a8f18fb6e6a6d400a8a1311">PipelineComparatorPlotCentroidIndices</a>, values.plotCentroidIndices, <span class="keyword">true</span>);</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;    }</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;    <span class="keywordflow">if</span> (values.compareCentroids != <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;        <a class="code" href="io_8cpp.html#aa20cea40f78380bdd173e9636fe1f442">LOST_PIPELINE_COMPARE</a>(actual[0].stars &amp;&amp; expected[0]-&gt;ExpectedStars() &amp;&amp; values.centroidCompareThreshold,</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;                              <span class="stringliteral">&quot;--compare-centroids requires at least 1 output image, and for expected centroids to be available on the input image. &quot;</span> + std::to_string(actual.size()) + <span class="stringliteral">&quot; many output images were provided.&quot;</span>,</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;                              PipelineComparatorCentroids, values.compareCentroids, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;    }</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;    <span class="keywordflow">if</span> (values.compareStarIds != <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;        <a class="code" href="io_8cpp.html#aa20cea40f78380bdd173e9636fe1f442">LOST_PIPELINE_COMPARE</a>(expected[0]-&gt;ExpectedStarIds() &amp;&amp; actual[0].starIds &amp;&amp; expected[0]-&gt;ExpectedStars(),</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;                              <span class="stringliteral">&quot;--compare-star-ids requires at least 1 output image, and for expected star IDs and centroids to be available on the input image. &quot;</span> + std::to_string(actual.size()) + <span class="stringliteral">&quot; many output images were provided.&quot;</span>,</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;                              PipelineComparatorStarIds, values.compareStarIds, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;    }</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    <span class="keywordflow">if</span> (values.printAttitude != <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;        <a class="code" href="io_8cpp.html#aa20cea40f78380bdd173e9636fe1f442">LOST_PIPELINE_COMPARE</a>(actual[0].attitude &amp;&amp; actual.size() == 1,</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;                              <span class="stringliteral">&quot;--print-attitude requires exactly 1 output image, and for attitude to be available on that output image. &quot;</span> + std::to_string(actual.size()) + <span class="stringliteral">&quot; many output images were provided.&quot;</span>,</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;                              PipelineComparatorPrintAttitude, values.printAttitude, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    }</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;    <span class="keywordflow">if</span> (values.compareAttitudes != <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;        <a class="code" href="io_8cpp.html#aa20cea40f78380bdd173e9636fe1f442">LOST_PIPELINE_COMPARE</a>(actual[0].attitude &amp;&amp; expected[0]-&gt;ExpectedAttitude() &amp;&amp; values.attitudeCompareThreshold,</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;                              <span class="stringliteral">&quot;--compare-attitudes requires at least 1 output image, and for expected attitude to be available on the input image. &quot;</span> + std::to_string(actual.size()) + <span class="stringliteral">&quot; many output images were provided.&quot;</span>,</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;                              PipelineComparatorAttitude, values.compareAttitudes, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;    }</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    <span class="keywordflow">if</span> (values.printSpeed != <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;        <a class="code" href="io_8cpp.html#aa20cea40f78380bdd173e9636fe1f442">LOST_PIPELINE_COMPARE</a>(actual.size() &gt; 0,</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;                              <span class="comment">// I don&#39;t think this should ever actually happen??</span></div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;                              <span class="stringliteral">&quot;--print-speed requires at least 1 output image. &quot;</span> + std::to_string(actual.size()) + <span class="stringliteral">&quot; many output images were provided.&quot;</span>,</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;                              PipelineComparatorPrintSpeed, values.printSpeed, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;    }</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160; </div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;<span class="preprocessor">#undef LOST_PIPELINE_COMPARE</span></div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;}</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160; </div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;<span class="comment">// TODO: Add CLI options for all the inspectors!</span></div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160; </div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;<span class="comment">// typedef void (*CatalogInspector)(const Catalog &amp;);</span></div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160; </div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;<span class="comment">// static std::vector&lt;const CatalogStar *&gt; PromptCatalogStars(const Catalog &amp;catalog, int howMany) {</span></div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;<span class="comment">//     std::vector&lt;const CatalogStar *&gt; result;</span></div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;<span class="comment">//     for (int i = 0; i &lt; howMany; i++) {</span></div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;<span class="comment">//         int name = Prompt&lt;int&gt;(&quot;Catalog name of &quot; + std::to_string(i) + &quot;-th star&quot;);</span></div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;<span class="comment">//         const CatalogStar *star = findNamedStar(catalog, name);</span></div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;<span class="comment">//         if (star == NULL) {</span></div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;<span class="comment">//             std::cerr &lt;&lt; &quot;Star not found!&quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;<span class="comment">//             exit(1);</span></div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;<span class="comment">//         }</span></div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;<span class="comment">//         result.push_back(star);</span></div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;<span class="comment">//     }</span></div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;<span class="comment">//     return result;</span></div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;<span class="comment">// }</span></div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160; </div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;<span class="comment">// void InspectPairDistance(const Catalog &amp;catalog) {</span></div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;<span class="comment">//     auto stars = PromptCatalogStars(catalog, 2);</span></div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160; </div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;<span class="comment">//     // TODO: not cout, prompt for an ostream in inspect and pass argument</span></div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;<span class="comment">//     std::cout &lt;&lt; Angle(stars[0]-&gt;spatial, stars[1]-&gt;spatial) &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;<span class="comment">// }</span></div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160; </div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;<span class="comment">// void InspectPyramidDistances(const Catalog &amp;catalog) {</span></div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;<span class="comment">//     auto stars = PromptCatalogStars(catalog, 4);</span></div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160; </div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;<span class="comment">//     std::cout &lt;&lt; &quot;pair_distance_01 &quot; &lt;&lt; Angle(stars[0]-&gt;spatial, stars[1]-&gt;spatial) &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;<span class="comment">//     std::cout &lt;&lt; &quot;pair_distance_02 &quot; &lt;&lt; Angle(stars[0]-&gt;spatial, stars[2]-&gt;spatial) &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;<span class="comment">//     std::cout &lt;&lt; &quot;pair_distance_03 &quot; &lt;&lt; Angle(stars[0]-&gt;spatial, stars[3]-&gt;spatial) &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;<span class="comment">//     std::cout &lt;&lt; &quot;pair_distance_12 &quot; &lt;&lt; Angle(stars[1]-&gt;spatial, stars[2]-&gt;spatial) &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;<span class="comment">//     std::cout &lt;&lt; &quot;pair_distance_13 &quot; &lt;&lt; Angle(stars[1]-&gt;spatial, stars[3]-&gt;spatial) &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;<span class="comment">//     std::cout &lt;&lt; &quot;pair_distance_23 &quot; &lt;&lt; Angle(stars[2]-&gt;spatial, stars[3]-&gt;spatial) &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;<span class="comment">// }</span></div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160; </div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;<span class="comment">// void InspectTripleAngle(const Catalog &amp;catalog) {</span></div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;<span class="comment">//     auto stars = PromptCatalogStars(catalog, 3);</span></div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160; </div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;<span class="comment">//     // TODO</span></div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;<span class="comment">// }</span></div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160; </div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;<span class="comment">// void InspectFindStar(const Catalog &amp;catalog) {</span></div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;<span class="comment">//     std::string raStr = PromptLine(&quot;Right Ascension&quot;);</span></div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160; </div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;<span class="comment">//     float raRadians;</span></div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160; </div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;<span class="comment">//     int raHours, raMinutes;</span></div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;<span class="comment">//     float raSeconds;</span></div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;<span class="comment">//     int raFormatTime = sscanf(raStr.c_str(), &quot;%dh %dm %fs&quot;, &amp;raHours, &amp;raMinutes, &amp;raSeconds);</span></div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160; </div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;<span class="comment">//     float raDeg;</span></div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;<span class="comment">//     int raFormatDeg = sscanf(raStr.c_str(), &quot;%f&quot;, &amp;raDeg);</span></div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160; </div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;<span class="comment">//     if (raFormatTime == 3) {</span></div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;<span class="comment">//         raRadians = (raHours * 2*M_PI/24) + (raMinutes * 2*M_PI/24/60) + (raSeconds * 2*M_PI/24/60/60);</span></div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;<span class="comment">//     } else if (raFormatDeg == 1) {</span></div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;<span class="comment">//         raRadians = DegToRad(raFormatDeg);</span></div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;<span class="comment">//     } else {</span></div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;<span class="comment">//         std::cerr &lt;&lt; &quot;Invalid right ascension format. Do \&quot;09h 38m 29.8754s\&quot; or a number of degrees.&quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;<span class="comment">//         exit(1);</span></div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;<span class="comment">//     }</span></div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160; </div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;<span class="comment">//     std::string deStr = PromptLine(&quot;Declination&quot;);</span></div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160; </div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;<span class="comment">//     float deRadians;</span></div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160; </div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;<span class="comment">//     int deDegPart, deMinPart;</span></div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;<span class="comment">//     float deSecPart;</span></div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;<span class="comment">//     char dummy[8];</span></div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;<span class="comment">//     int deFormatParts = sscanf(deStr.c_str(), &quot;%d%s %d%s %f%s&quot;, &amp;deDegPart, dummy, &amp;deMinPart, dummy, &amp;deSecPart, dummy);</span></div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160; </div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;<span class="comment">//     float deDeg;</span></div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;<span class="comment">//     int deFormatDeg = sscanf(deStr.c_str(), &quot;%f&quot;, &amp;deDeg);</span></div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160; </div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;<span class="comment">//     if (deFormatParts == 6) {</span></div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;<span class="comment">//         deRadians = DegToRad(deDegPart + (float)deMinPart/60 + (float)deSecPart/60/60);</span></div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;<span class="comment">//     } else if (deFormatDeg == 1) {</span></div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;<span class="comment">//         deRadians = DegToRad(deFormatDeg);</span></div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;<span class="comment">//     } else {</span></div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;<span class="comment">//         std::cerr &lt;&lt; &quot;Invalid declination format.&quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;<span class="comment">//         exit(1);</span></div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;<span class="comment">//     }</span></div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160; </div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;<span class="comment">//     // find the star</span></div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160; </div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;<span class="comment">//     float tolerance = 0.001;</span></div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;<span class="comment">//     Vec3 userSpatial = SphericalToSpatial(raRadians, deRadians);</span></div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;<span class="comment">//     int i = 0;</span></div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;<span class="comment">//     for (const CatalogStar &amp;curStar : catalog) {</span></div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;<span class="comment">//         if ((curStar.spatial - userSpatial).Magnitude() &lt; tolerance) {</span></div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;<span class="comment">//             std::cout &lt;&lt; &quot;found_star_&quot; &lt;&lt; i &lt;&lt; &quot; &quot;  &lt;&lt; curStar.name &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;<span class="comment">//             std::cout &lt;&lt; &quot;fonud_star_magnitude_&quot; &lt;&lt; i &lt;&lt; &quot; &quot; &lt;&lt; curStar.magnitude &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;<span class="comment">//             i++;</span></div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;<span class="comment">//         }</span></div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;<span class="comment">//     }</span></div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;<span class="comment">//     if (i == 0) {</span></div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;<span class="comment">//         std::cerr &lt;&lt; &quot;No stars found&quot; &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;<span class="comment">//     }</span></div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;<span class="comment">// }</span></div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160; </div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;<span class="comment">// void InspectPrintStar(const Catalog &amp;catalog) {</span></div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;<span class="comment">//     auto stars = PromptCatalogStars(catalog, 1);</span></div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;<span class="comment">//     float ra, de;</span></div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;<span class="comment">//     SpatialToSpherical(stars[0]-&gt;spatial, &amp;ra, &amp;de);</span></div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160; </div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;<span class="comment">//     std::cout &lt;&lt; &quot;star_ra &quot; &lt;&lt; RadToDeg(ra) &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;<span class="comment">//     std::cout &lt;&lt; &quot;star_de &quot; &lt;&lt; RadToDeg(de) &lt;&lt; std::endl;</span></div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;<span class="comment">// }</span></div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160; </div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;<span class="comment">// void InspectCatalog() {</span></div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;<span class="comment">//     InteractiveChoice&lt;CatalogInspector&gt; inspectorChoice;</span></div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;<span class="comment">//     inspectorChoice.Register(&quot;pair_distance&quot;, &quot;pair distance angle&quot;, InspectPairDistance);</span></div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;<span class="comment">//     inspectorChoice.Register(&quot;pyramid_distances&quot;, &quot;all pair distances in pyramid&quot;, InspectPyramidDistances);</span></div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;<span class="comment">//     inspectorChoice.Register(&quot;triple_angle&quot;, &quot;inner angle of a triangle&quot;, InspectTripleAngle);</span></div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;<span class="comment">//     inspectorChoice.Register(&quot;find_star&quot;, &quot;find a star name based on ra/de&quot;, InspectFindStar);</span></div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;<span class="comment">//     inspectorChoice.Register(&quot;print_star&quot;, &quot;print coordinates of a star&quot;, InspectPrintStar);</span></div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;<span class="comment">//     (*inspectorChoice.Prompt(&quot;Inspect the catalog&quot;))(CatalogRead());</span></div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;<span class="comment">// }</span></div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160; </div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;} <span class="comment">// namespace lost</span></div>
<div class="ttc" id="aattitude-estimators_8hpp_html"><div class="ttname"><a href="attitude-estimators_8hpp.html">attitude-estimators.hpp</a></div></div>
<div class="ttc" id="aattitude-utils_8hpp_html"><div class="ttname"><a href="attitude-utils_8hpp.html">attitude-utils.hpp</a></div></div>
<div class="ttc" id="aclasslost_1_1_attitude_estimation_algorithm_html"><div class="ttname"><a href="classlost_1_1_attitude_estimation_algorithm.html">lost::AttitudeEstimationAlgorithm</a></div><div class="ttdoc">An attitude estimation algorithm estimates the orientation of the camera based on identified stars.</div><div class="ttdef"><b>Definition:</b> <a href="attitude-estimators_8hpp_source.html#l00015">attitude-estimators.hpp:15</a></div></div>
<div class="ttc" id="aclasslost_1_1_attitude_html"><div class="ttname"><a href="classlost_1_1_attitude.html">lost::Attitude</a></div><div class="ttdoc">The attitude (orientation) of a spacecraft.</div><div class="ttdef"><b>Definition:</b> <a href="attitude-utils_8hpp_source.html#l00129">attitude-utils.hpp:129</a></div></div>
<div class="ttc" id="aclasslost_1_1_attitude_html_a1af3ee1daabfc256ec56554b260bdbee"><div class="ttname"><a href="classlost_1_1_attitude.html#a1af3ee1daabfc256ec56554b260bdbee">lost::Attitude::ToSpherical</a></div><div class="ttdeci">EulerAngles ToSpherical() const</div><div class="ttdoc">Get the euler angles from the attitude, converting from whatever format is stored.</div><div class="ttdef"><b>Definition:</b> <a href="attitude-utils_8cpp_source.html#l00422">attitude-utils.cpp:422</a></div></div>
<div class="ttc" id="aclasslost_1_1_attitude_html_a4c7ac3eb32e2e6dc8c576c9ad7134aaf"><div class="ttname"><a href="classlost_1_1_attitude.html#a4c7ac3eb32e2e6dc8c576c9ad7134aaf">lost::Attitude::Rotate</a></div><div class="ttdeci">Vec3 Rotate(const Vec3 &amp;) const</div><div class="ttdoc">Convert a vector from the reference frame to the body frame.</div><div class="ttdef"><b>Definition:</b> <a href="attitude-utils_8cpp_source.html#l00410">attitude-utils.cpp:410</a></div></div>
<div class="ttc" id="aclasslost_1_1_attitude_html_adc1b3ee1876cf2212603eaa902dce055"><div class="ttname"><a href="classlost_1_1_attitude.html#adc1b3ee1876cf2212603eaa902dce055">lost::Attitude::GetQuaternion</a></div><div class="ttdeci">Quaternion GetQuaternion() const</div><div class="ttdoc">Get the quaternion representing the attitude, converting from whatever format is stored.</div><div class="ttdef"><b>Definition:</b> <a href="attitude-utils_8cpp_source.html#l00386">attitude-utils.cpp:386</a></div></div>
<div class="ttc" id="aclasslost_1_1_camera_html"><div class="ttname"><a href="classlost_1_1_camera.html">lost::Camera</a></div><div class="ttdoc">A full description of a camera. Enough information to reconstruct the camera matrix and then some.</div><div class="ttdef"><b>Definition:</b> <a href="camera_8hpp_source.html#l00009">camera.hpp:9</a></div></div>
<div class="ttc" id="aclasslost_1_1_camera_html_a2282f819be792d84f3168032a9cf457b"><div class="ttname"><a href="classlost_1_1_camera.html#a2282f819be792d84f3168032a9cf457b">lost::Camera::SpatialToCamera</a></div><div class="ttdeci">Vec2 SpatialToCamera(const Vec3 &amp;) const</div><div class="ttdoc">Converts from a 3D point in space to a 2D point on the camera sensor.</div><div class="ttdef"><b>Definition:</b> <a href="camera_8cpp_source.html#l00014">camera.cpp:14</a></div></div>
<div class="ttc" id="aclasslost_1_1_camera_html_a3830d04bcd953e27cc133944fb434f64"><div class="ttname"><a href="classlost_1_1_camera.html#a3830d04bcd953e27cc133944fb434f64">lost::Camera::Fov</a></div><div class="ttdeci">float Fov() const</div><div class="ttdoc">Horizontal field of view in radians.</div><div class="ttdef"><b>Definition:</b> <a href="camera_8cpp_source.html#l00065">camera.cpp:65</a></div></div>
<div class="ttc" id="aclasslost_1_1_camera_html_a4d940919d1247edd431de7643473f538"><div class="ttname"><a href="classlost_1_1_camera.html#a4d940919d1247edd431de7643473f538">lost::Camera::InSensor</a></div><div class="ttdeci">bool InSensor(const Vec2 &amp;vector) const</div><div class="ttdoc">Returns whether a given pixel is actually in the camera's field of view.</div><div class="ttdef"><b>Definition:</b> <a href="camera_8cpp_source.html#l00050">camera.cpp:50</a></div></div>
<div class="ttc" id="aclasslost_1_1_camera_html_a6a6a4bd2d5daf114108e73126568369d"><div class="ttname"><a href="classlost_1_1_camera.html#a6a6a4bd2d5daf114108e73126568369d">lost::Camera::XResolution</a></div><div class="ttdeci">int XResolution() const</div><div class="ttdoc">Width of the sensor in pixels.</div><div class="ttdef"><b>Definition:</b> <a href="camera_8hpp_source.html#l00038">camera.hpp:38</a></div></div>
<div class="ttc" id="aclasslost_1_1_camera_html_a75f02f56900338580a9cacc2f9131d70"><div class="ttname"><a href="classlost_1_1_camera.html#a75f02f56900338580a9cacc2f9131d70">lost::Camera::YResolution</a></div><div class="ttdeci">int YResolution() const</div><div class="ttdoc">Height of the sensor in pixels.</div><div class="ttdef"><b>Definition:</b> <a href="camera_8hpp_source.html#l00040">camera.hpp:40</a></div></div>
<div class="ttc" id="aclasslost_1_1_camera_html_aa7df6f5d7ee2f6c26ecc34bd1e7f2e53"><div class="ttname"><a href="classlost_1_1_camera.html#aa7df6f5d7ee2f6c26ecc34bd1e7f2e53">lost::Camera::FocalLength</a></div><div class="ttdeci">float FocalLength() const</div><div class="ttdoc">Focal length in pixels.</div><div class="ttdef"><b>Definition:</b> <a href="camera_8hpp_source.html#l00042">camera.hpp:42</a></div></div>
<div class="ttc" id="aclasslost_1_1_catalog_star_html"><div class="ttname"><a href="classlost_1_1_catalog_star.html">lost::CatalogStar</a></div><div class="ttdoc">A star from the Bright Star Catalog.</div><div class="ttdef"><b>Definition:</b> <a href="star-utils_8hpp_source.html#l00011">star-utils.hpp:11</a></div></div>
<div class="ttc" id="aclasslost_1_1_catalog_star_html_aac362b166dd1a5cfe95e33a7e2d18e3a"><div class="ttname"><a href="classlost_1_1_catalog_star.html#aac362b166dd1a5cfe95e33a7e2d18e3a">lost::CatalogStar::magnitude</a></div><div class="ttdeci">int magnitude</div><div class="ttdoc">The magnitude of the star, with the decimal point shifted two places right.</div><div class="ttdef"><b>Definition:</b> <a href="star-utils_8hpp_source.html#l00036">star-utils.hpp:36</a></div></div>
<div class="ttc" id="aclasslost_1_1_center_of_gravity_algorithm_html"><div class="ttname"><a href="classlost_1_1_center_of_gravity_algorithm.html">lost::CenterOfGravityAlgorithm</a></div><div class="ttdoc">A simple, fast, and pretty decent centroid algorithm.</div><div class="ttdef"><b>Definition:</b> <a href="centroiders_8hpp_source.html#l00037">centroiders.hpp:37</a></div></div>
<div class="ttc" id="aclasslost_1_1_centroid_algorithm_html"><div class="ttname"><a href="classlost_1_1_centroid_algorithm.html">lost::CentroidAlgorithm</a></div><div class="ttdoc">An algorithm that detects the (x,y) coordinates of bright points in an image, called &quot;centroids&quot;.</div><div class="ttdef"><b>Definition:</b> <a href="centroiders_8hpp_source.html#l00012">centroiders.hpp:12</a></div></div>
<div class="ttc" id="aclasslost_1_1_centroid_comparison_html"><div class="ttname"><a href="classlost_1_1_centroid_comparison.html">lost::CentroidComparison</a></div><div class="ttdoc">The result of comparing actual and expected centroids Used for debugging and benchmarking.</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l01023">io.cpp:1023</a></div></div>
<div class="ttc" id="aclasslost_1_1_centroid_comparison_html_a4105577ec96bf66b9a5003dcde18d557"><div class="ttname"><a href="classlost_1_1_centroid_comparison.html#a4105577ec96bf66b9a5003dcde18d557">lost::CentroidComparison::numExtraCentroids</a></div><div class="ttdeci">float numExtraCentroids</div><div class="ttdoc">Stars in actual but not expected.</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l01041">io.cpp:1041</a></div></div>
<div class="ttc" id="aclasslost_1_1_centroid_comparison_html_a69b42b7776ce7d288d15bf0ab1fceb55"><div class="ttname"><a href="classlost_1_1_centroid_comparison.html#a69b42b7776ce7d288d15bf0ab1fceb55">lost::CentroidComparison::numCorrectCentroids</a></div><div class="ttdeci">float numCorrectCentroids</div><div class="ttdoc">Number of actual stars within the centroiding threshold of an expected star.</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l01035">io.cpp:1035</a></div></div>
<div class="ttc" id="aclasslost_1_1_centroid_comparison_html_ac1e005780ebb245a3baafde37654aafa"><div class="ttname"><a href="classlost_1_1_centroid_comparison.html#ac1e005780ebb245a3baafde37654aafa">lost::CentroidComparison::meanError</a></div><div class="ttdeci">float meanError</div><div class="ttdoc">Average distance from actual to expected centroids (in pixels) Only correct centroids are considered ...</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l01030">io.cpp:1030</a></div></div>
<div class="ttc" id="aclasslost_1_1_centroid_comparison_html_ad46cc5ba0521e788511aac2bbdc2569d"><div class="ttname"><a href="classlost_1_1_centroid_comparison.html#ad46cc5ba0521e788511aac2bbdc2569d">lost::CentroidComparison::CentroidComparison</a></div><div class="ttdeci">CentroidComparison()</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l01025">io.cpp:1025</a></div></div>
<div class="ttc" id="aclasslost_1_1_database_options_html"><div class="ttname"><a href="classlost_1_1_database_options.html">lost::DatabaseOptions</a></div><div class="ttdoc">Commannd line options when using the database command.</div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00285">io.hpp:285</a></div></div>
<div class="ttc" id="aclasslost_1_1_davenport_q_algorithm_html"><div class="ttname"><a href="classlost_1_1_davenport_q_algorithm.html">lost::DavenportQAlgorithm</a></div><div class="ttdoc">A slow but reliable attitude estimation algorithm.</div><div class="ttdef"><b>Definition:</b> <a href="attitude-estimators_8hpp_source.html#l00031">attitude-estimators.hpp:31</a></div></div>
<div class="ttc" id="aclasslost_1_1_dummy_centroid_algorithm_html"><div class="ttname"><a href="classlost_1_1_dummy_centroid_algorithm.html">lost::DummyCentroidAlgorithm</a></div><div class="ttdoc">A centroid algorithm for debugging that returns random centroids.</div><div class="ttdef"><b>Definition:</b> <a href="centroiders_8hpp_source.html#l00025">centroiders.hpp:25</a></div></div>
<div class="ttc" id="aclasslost_1_1_dummy_star_id_algorithm_html"><div class="ttname"><a href="classlost_1_1_dummy_star_id_algorithm.html">lost::DummyStarIdAlgorithm</a></div><div class="ttdoc">A star-id algorithm that returns random results. For debugging.</div><div class="ttdef"><b>Definition:</b> <a href="star-id_8hpp_source.html#l00026">star-id.hpp:26</a></div></div>
<div class="ttc" id="aclasslost_1_1_euler_angles_html"><div class="ttname"><a href="classlost_1_1_euler_angles.html">lost::EulerAngles</a></div><div class="ttdoc">A &quot;human-readable&quot; way to represent a 3d rotation or orientation.</div><div class="ttdef"><b>Definition:</b> <a href="attitude-utils_8hpp_source.html#l00081">attitude-utils.hpp:81</a></div></div>
<div class="ttc" id="aclasslost_1_1_euler_angles_html_a224cfa3989b86edc65d0e6e96bc7b3ca"><div class="ttname"><a href="classlost_1_1_euler_angles.html#a224cfa3989b86edc65d0e6e96bc7b3ca">lost::EulerAngles::roll</a></div><div class="ttdeci">float roll</div><div class="ttdoc">How far we roll counterclockwise. Roll is performed last (after yaw and pitch).</div><div class="ttdef"><b>Definition:</b> <a href="attitude-utils_8hpp_source.html#l00091">attitude-utils.hpp:91</a></div></div>
<div class="ttc" id="aclasslost_1_1_euler_angles_html_a86cffd1e68a380145e5b684c7d7c2406"><div class="ttname"><a href="classlost_1_1_euler_angles.html#a86cffd1e68a380145e5b684c7d7c2406">lost::EulerAngles::ra</a></div><div class="ttdeci">float ra</div><div class="ttdoc">Right ascension. How far we yaw left. Yaw is performed first.</div><div class="ttdef"><b>Definition:</b> <a href="attitude-utils_8hpp_source.html#l00087">attitude-utils.hpp:84</a></div></div>
<div class="ttc" id="aclasslost_1_1_euler_angles_html_acce7640ab1aa3431e04cc39037e538fe"><div class="ttname"><a href="classlost_1_1_euler_angles.html#acce7640ab1aa3431e04cc39037e538fe">lost::EulerAngles::de</a></div><div class="ttdeci">float de</div><div class="ttdoc">Declination. How far we pitch up (or down if negative). Pitch is performed second,...</div><div class="ttdef"><b>Definition:</b> <a href="attitude-utils_8hpp_source.html#l00089">attitude-utils.hpp:89</a></div></div>
<div class="ttc" id="aclasslost_1_1_generated_pipeline_input_html"><div class="ttname"><a href="classlost_1_1_generated_pipeline_input.html">lost::GeneratedPipelineInput</a></div><div class="ttdoc">A pipeline input which is generated (fake image).</div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00124">io.hpp:124</a></div></div>
<div class="ttc" id="aclasslost_1_1_generated_pipeline_input_html_a1b473186f7c725b5e59dcfe95be1f686"><div class="ttname"><a href="classlost_1_1_generated_pipeline_input.html#a1b473186f7c725b5e59dcfe95be1f686">lost::GeneratedPipelineInput::GeneratedPipelineInput</a></div><div class="ttdeci">GeneratedPipelineInput(const Catalog &amp;, Attitude, Camera, std::default_random_engine *, bool centroidsOnly, float observedReferenceBrightness, float starSpreadStdDev, float sensitivity, float darkCurrent, float readNoiseStdDev, Attitude motionBlurDirection, float exposureTime, float readoutTime, bool shotNoise, int oversampling, int numFalseStars, int falseMinMagnitude, int falseMaxMagnitude, int cutoffMag, float perturbationStddev)</div><div class="ttdoc">Create a generated pipeline input.</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00479">io.cpp:479</a></div></div>
<div class="ttc" id="aclasslost_1_1_generated_star_html"><div class="ttname"><a href="classlost_1_1_generated_star.html">lost::GeneratedStar</a></div><div class="ttdoc">A star used in simulated image generation. Contains extra data about how to simulate the star.</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00409">io.cpp:409</a></div></div>
<div class="ttc" id="aclasslost_1_1_generated_star_html_a75214eb4d1e17681b3e3a116a88af29a"><div class="ttname"><a href="classlost_1_1_generated_star.html#a75214eb4d1e17681b3e3a116a88af29a">lost::GeneratedStar::delta</a></div><div class="ttdeci">Vec2 delta</div><div class="ttdoc">(only meaningful with motion blur) Where the star will appear one time unit in the future.</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00418">io.cpp:418</a></div></div>
<div class="ttc" id="aclasslost_1_1_generated_star_html_aadcacbb1bf27616e20db9b86cde2e691"><div class="ttname"><a href="classlost_1_1_generated_star.html#aadcacbb1bf27616e20db9b86cde2e691">lost::GeneratedStar::peakBrightness</a></div><div class="ttdeci">float peakBrightness</div><div class="ttdoc">the brightness density per time unit at the center of the star. 0.0 is black, 1.0 is white.</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00415">io.cpp:412</a></div></div>
<div class="ttc" id="aclasslost_1_1_generated_star_html_ad8406a16bdfb31b731d923d67a5afe71"><div class="ttname"><a href="classlost_1_1_generated_star.html#ad8406a16bdfb31b731d923d67a5afe71">lost::GeneratedStar::GeneratedStar</a></div><div class="ttdeci">GeneratedStar(Star star, float peakBrightness, Vec2 motionBlurDelta)</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00411">io.cpp:411</a></div></div>
<div class="ttc" id="aclasslost_1_1_geometric_voting_star_id_algorithm_html"><div class="ttname"><a href="classlost_1_1_geometric_voting_star_id_algorithm.html">lost::GeometricVotingStarIdAlgorithm</a></div><div class="ttdoc">A star-id algorithm based on assigning votes for each centroid-catalog pair then choosing the highest...</div><div class="ttdef"><b>Definition:</b> <a href="star-id_8hpp_source.html#l00035">star-id.hpp:35</a></div></div>
<div class="ttc" id="aclasslost_1_1_image_html"><div class="ttname"><a href="classlost_1_1_image.html">lost::Image</a></div><div class="ttdoc">An 8-bit grayscale 2d image.</div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00063">io.hpp:63</a></div></div>
<div class="ttc" id="aclasslost_1_1_image_html_a1cf1464da2a2b11d9983ed1f022da26b"><div class="ttname"><a href="classlost_1_1_image.html#a1cf1464da2a2b11d9983ed1f022da26b">lost::Image::image</a></div><div class="ttdeci">unsigned char * image</div><div class="ttdoc">The raw pixel data in the image.</div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00069">io.hpp:69</a></div></div>
<div class="ttc" id="aclasslost_1_1_image_html_a705ef08de937ac85cf4a5c5e1084475e"><div class="ttname"><a href="classlost_1_1_image.html#a705ef08de937ac85cf4a5c5e1084475e">lost::Image::height</a></div><div class="ttdeci">int height</div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00072">io.hpp:72</a></div></div>
<div class="ttc" id="aclasslost_1_1_image_html_af450eb35614041beeb2bec120aac739e"><div class="ttname"><a href="classlost_1_1_image.html#af450eb35614041beeb2bec120aac739e">lost::Image::width</a></div><div class="ttdeci">int width</div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00071">io.hpp:71</a></div></div>
<div class="ttc" id="aclasslost_1_1_iterative_weighted_center_of_gravity_algorithm_html"><div class="ttname"><a href="classlost_1_1_iterative_weighted_center_of_gravity_algorithm.html">lost::IterativeWeightedCenterOfGravityAlgorithm</a></div><div class="ttdoc">A more complicated centroid algorithm which doesn't perform much better than CenterOfGravityAlgorithm...</div><div class="ttdef"><b>Definition:</b> <a href="centroiders_8hpp_source.html#l00047">centroiders.hpp:47</a></div></div>
<div class="ttc" id="aclasslost_1_1_multi_database_builder_html"><div class="ttname"><a href="classlost_1_1_multi_database_builder.html">lost::MultiDatabaseBuilder</a></div><div class="ttdoc">Class for easily creating a MultiDatabase.</div><div class="ttdef"><b>Definition:</b> <a href="databases_8hpp_source.html#l00112">databases.hpp:112</a></div></div>
<div class="ttc" id="aclasslost_1_1_multi_database_builder_html_ad0fd44e30041b65d3d2d61f905d8f63e"><div class="ttname"><a href="classlost_1_1_multi_database_builder.html#ad0fd44e30041b65d3d2d61f905d8f63e">lost::MultiDatabaseBuilder::AddSubDatabase</a></div><div class="ttdeci">unsigned char * AddSubDatabase(int32_t magicValue, long length)</div><div class="ttdoc">Add a database to a MultiDatabase.</div><div class="ttdef"><b>Definition:</b> <a href="databases_8cpp_source.html#l00370">databases.cpp:370</a></div></div>
<div class="ttc" id="aclasslost_1_1_multi_database_html"><div class="ttname"><a href="classlost_1_1_multi_database.html">lost::MultiDatabase</a></div><div class="ttdoc">A database that contains multiple databases This is almost always the database that is actually passe...</div><div class="ttdef"><b>Definition:</b> <a href="databases_8hpp_source.html#l00102">databases.hpp:102</a></div></div>
<div class="ttc" id="aclasslost_1_1_multi_database_html_ad013d7640b19cb78268c9be5f6c64544"><div class="ttname"><a href="classlost_1_1_multi_database.html#ad013d7640b19cb78268c9be5f6c64544">lost::MultiDatabase::SubDatabasePointer</a></div><div class="ttdeci">const unsigned char * SubDatabasePointer(int32_t magicValue) const</div><div class="ttdoc">MultiDatabase memory layout:</div><div class="ttdef"><b>Definition:</b> <a href="databases_8cpp_source.html#l00344">databases.cpp:344</a></div></div>
<div class="ttc" id="aclasslost_1_1_pair_distance_k_vector_database_html_a6d5d477e5e2d9557f0e284e917361a54"><div class="ttname"><a href="classlost_1_1_pair_distance_k_vector_database.html#a6d5d477e5e2d9557f0e284e917361a54">lost::PairDistanceKVectorDatabase::kMagicValue</a></div><div class="ttdeci">static const int32_t kMagicValue</div><div class="ttdoc">Magic value to use when storing inside a MultiDatabase.</div><div class="ttdef"><b>Definition:</b> <a href="databases_8hpp_source.html#l00068">databases.hpp:68</a></div></div>
<div class="ttc" id="aclasslost_1_1_pipeline_html"><div class="ttname"><a href="classlost_1_1_pipeline.html">lost::Pipeline</a></div><div class="ttdoc">A set of algorithms that describes all or part of the star-tracking &quot;pipeline&quot;.</div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00232">io.hpp:232</a></div></div>
<div class="ttc" id="aclasslost_1_1_pipeline_html_ab99f650efd24207ed56ae9d52399cff2"><div class="ttname"><a href="classlost_1_1_pipeline.html#ab99f650efd24207ed56ae9d52399cff2">lost::Pipeline::Pipeline</a></div><div class="ttdeci">Pipeline()=default</div></div>
<div class="ttc" id="aclasslost_1_1_pipeline_html_aea0fe125836ac0c6906886ad320f5210"><div class="ttname"><a href="classlost_1_1_pipeline.html#aea0fe125836ac0c6906886ad320f5210">lost::Pipeline::Go</a></div><div class="ttdeci">PipelineOutput Go(const PipelineInput &amp;)</div><div class="ttdoc">Run all stages of a pipeline.</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00903">io.cpp:903</a></div></div>
<div class="ttc" id="aclasslost_1_1_pipeline_input_html"><div class="ttname"><a href="classlost_1_1_pipeline_input.html">lost::PipelineInput</a></div><div class="ttdoc">Represents the input and expected outputs of a pipeline run.</div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00093">io.hpp:93</a></div></div>
<div class="ttc" id="aclasslost_1_1_pipeline_input_html_a31278ee2b910cf3e8af25f71aefcf295"><div class="ttname"><a href="classlost_1_1_pipeline_input.html#a31278ee2b910cf3e8af25f71aefcf295">lost::PipelineInput::GetCatalog</a></div><div class="ttdeci">virtual const Catalog &amp; GetCatalog() const =0</div><div class="ttdoc">The catalog to which catalog indexes returned from other methods refer.</div></div>
<div class="ttc" id="aclasslost_1_1_pipeline_input_html_a3942b6fcacd994b5d9f841a770d895bc"><div class="ttname"><a href="classlost_1_1_pipeline_input.html#a3942b6fcacd994b5d9f841a770d895bc">lost::PipelineInput::InputStarIds</a></div><div class="ttdeci">virtual const StarIdentifiers * InputStarIds() const</div><div class="ttdoc">The centroid indices in the StarIdentifiers returned from InputStarIds should be indices into InputSt...</div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00103">io.hpp:103</a></div></div>
<div class="ttc" id="aclasslost_1_1_pipeline_input_html_a4df52c585005abf1154699cb89570db8"><div class="ttname"><a href="classlost_1_1_pipeline_input.html#a4df52c585005abf1154699cb89570db8">lost::PipelineInput::InputImage</a></div><div class="ttdeci">virtual const Image * InputImage() const</div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00097">io.hpp:97</a></div></div>
<div class="ttc" id="aclasslost_1_1_pipeline_input_html_a8707ebe081ca65531341eeb2b9d4ff7b"><div class="ttname"><a href="classlost_1_1_pipeline_input.html#a8707ebe081ca65531341eeb2b9d4ff7b">lost::PipelineInput::InputImageSurface</a></div><div class="ttdeci">cairo_surface_t * InputImageSurface() const</div><div class="ttdoc">Convert the InputImage() output into a cairo surface.</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00334">io.cpp:334</a></div></div>
<div class="ttc" id="aclasslost_1_1_pipeline_input_html_aa6c9969bb4118ddf877a1000636f6486"><div class="ttname"><a href="classlost_1_1_pipeline_input.html#aa6c9969bb4118ddf877a1000636f6486">lost::PipelineInput::InputStars</a></div><div class="ttdeci">virtual const Stars * InputStars() const</div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00100">io.hpp:100</a></div></div>
<div class="ttc" id="aclasslost_1_1_pipeline_input_html_af88962a236353e511724a699dab7a785"><div class="ttname"><a href="classlost_1_1_pipeline_input.html#af88962a236353e511724a699dab7a785">lost::PipelineInput::InputCamera</a></div><div class="ttdeci">virtual const Camera * InputCamera() const</div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00106">io.hpp:106</a></div></div>
<div class="ttc" id="aclasslost_1_1_pipeline_options_html"><div class="ttname"><a href="classlost_1_1_pipeline_options.html">lost::PipelineOptions</a></div><div class="ttdoc">The command line options passed when running a pipeline.</div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00080">io.hpp:80</a></div></div>
<div class="ttc" id="aclasslost_1_1_png_pipeline_input_html"><div class="ttname"><a href="classlost_1_1_png_pipeline_input.html">lost::PngPipelineInput</a></div><div class="ttdoc">A pipeline input created by reading a PNG from a file on disk.</div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00166">io.hpp:166</a></div></div>
<div class="ttc" id="aclasslost_1_1_png_pipeline_input_html_a01b8ddf0471b41c2a3d306f49156a0ab"><div class="ttname"><a href="classlost_1_1_png_pipeline_input.html#a01b8ddf0471b41c2a3d306f49156a0ab">lost::PngPipelineInput::~PngPipelineInput</a></div><div class="ttdeci">~PngPipelineInput()</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00368">io.cpp:368</a></div></div>
<div class="ttc" id="aclasslost_1_1_png_pipeline_input_html_adee57652282fb256ea2deeb737b81afe"><div class="ttname"><a href="classlost_1_1_png_pipeline_input.html#adee57652282fb256ea2deeb737b81afe">lost::PngPipelineInput::PngPipelineInput</a></div><div class="ttdeci">PngPipelineInput(cairo_surface_t *, Camera, const Catalog &amp;)</div><div class="ttdoc">A pipeline input coming from an image with no extra metadata.</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00360">io.cpp:360</a></div></div>
<div class="ttc" id="aclasslost_1_1_pyramid_star_id_algorithm_html"><div class="ttname"><a href="classlost_1_1_pyramid_star_id_algorithm.html">lost::PyramidStarIdAlgorithm</a></div><div class="ttdoc">The &quot;de facto&quot; star-id algorithm used in many real-world missions.</div><div class="ttdef"><b>Definition:</b> <a href="star-id_8hpp_source.html#l00052">star-id.hpp:52</a></div></div>
<div class="ttc" id="aclasslost_1_1_quaternion_html"><div class="ttname"><a href="classlost_1_1_quaternion.html">lost::Quaternion</a></div><div class="ttdoc">A quaternion is a common way to represent a 3d rotation.</div><div class="ttdef"><b>Definition:</b> <a href="attitude-utils_8hpp_source.html#l00095">attitude-utils.hpp:95</a></div></div>
<div class="ttc" id="aclasslost_1_1_quaternion_html_a570198dc9f0669cb34d715fbf9e62578"><div class="ttname"><a href="classlost_1_1_quaternion.html#a570198dc9f0669cb34d715fbf9e62578">lost::Quaternion::Rotate</a></div><div class="ttdeci">Vec3 Rotate(const Vec3 &amp;) const</div><div class="ttdoc">Rotate a 3d vector according to the rotation represented by the quaternion.</div><div class="ttdef"><b>Definition:</b> <a href="attitude-utils_8cpp_source.html#l00051">attitude-utils.cpp:51</a></div></div>
<div class="ttc" id="aclasslost_1_1_quaternion_html_a819b0f409e60886138c0fae47c21e250"><div class="ttname"><a href="classlost_1_1_quaternion.html#a819b0f409e60886138c0fae47c21e250">lost::Quaternion::Angle</a></div><div class="ttdeci">float Angle() const</div><div class="ttdoc">How many radians the rotation represented by this quaternion has.</div><div class="ttdef"><b>Definition:</b> <a href="attitude-utils_8cpp_source.html#l00057">attitude-utils.cpp:57</a></div></div>
<div class="ttc" id="aclasslost_1_1_quest_algorithm_html"><div class="ttname"><a href="classlost_1_1_quest_algorithm.html">lost::QuestAlgorithm</a></div><div class="ttdoc">A faster and just as accurate attitude estimator as the Davenport Q algorithm.</div><div class="ttdef"><b>Definition:</b> <a href="attitude-estimators_8hpp_source.html#l00049">attitude-estimators.hpp:49</a></div></div>
<div class="ttc" id="aclasslost_1_1_star_html"><div class="ttname"><a href="classlost_1_1_star.html">lost::Star</a></div><div class="ttdoc">A &quot;centroid&quot; detected in an image.</div><div class="ttdef"><b>Definition:</b> <a href="star-utils_8hpp_source.html#l00048">star-utils.hpp:48</a></div></div>
<div class="ttc" id="aclasslost_1_1_star_html_a8e9b2320d742fb5324397ac406c859ea"><div class="ttname"><a href="classlost_1_1_star.html#a8e9b2320d742fb5324397ac406c859ea">lost::Star::position</a></div><div class="ttdeci">Vec2 position</div><div class="ttdoc">The (x,y) pixel coordinates in the image (top left is 0,0)</div><div class="ttdef"><b>Definition:</b> <a href="star-utils_8hpp_source.html#l00060">star-utils.hpp:57</a></div></div>
<div class="ttc" id="aclasslost_1_1_star_html_abb1ed64c90d4f6508fdd1e75923175d6"><div class="ttname"><a href="classlost_1_1_star.html#abb1ed64c90d4f6508fdd1e75923175d6">lost::Star::radiusY</a></div><div class="ttdeci">float radiusY</div><div class="ttdoc">Approximate vertical radius of the bright area in pixels.</div><div class="ttdef"><b>Definition:</b> <a href="star-utils_8hpp_source.html#l00064">star-utils.hpp:64</a></div></div>
<div class="ttc" id="aclasslost_1_1_star_html_ad7bcae53e6ad611b8fb436eeb159da98"><div class="ttname"><a href="classlost_1_1_star.html#ad7bcae53e6ad611b8fb436eeb159da98">lost::Star::radiusX</a></div><div class="ttdeci">float radiusX</div><div class="ttdoc">Approximate horizontal radius of the bright area in pixels.</div><div class="ttdef"><b>Definition:</b> <a href="star-utils_8hpp_source.html#l00062">star-utils.hpp:62</a></div></div>
<div class="ttc" id="aclasslost_1_1_star_id_algorithm_html"><div class="ttname"><a href="classlost_1_1_star_id_algorithm.html">lost::StarIdAlgorithm</a></div><div class="ttdoc">A star idenification algorithm.</div><div class="ttdef"><b>Definition:</b> <a href="star-id_8hpp_source.html#l00016">star-id.hpp:16</a></div></div>
<div class="ttc" id="aclasslost_1_1_star_identifier_html"><div class="ttname"><a href="classlost_1_1_star_identifier.html">lost::StarIdentifier</a></div><div class="ttdoc">Records that a certain Star (detected in the image) corresponds to a certain CatalogStar.</div><div class="ttdef"><b>Definition:</b> <a href="star-utils_8hpp_source.html#l00077">star-utils.hpp:77</a></div></div>
<div class="ttc" id="aclasslost_1_1_triad_algorithm_html"><div class="ttname"><a href="classlost_1_1_triad_algorithm.html">lost::TriadAlgorithm</a></div><div class="ttdoc">A fast attitude estimator which only takes into account information from two stars.</div><div class="ttdef"><b>Definition:</b> <a href="attitude-estimators_8hpp_source.html#l00040">attitude-estimators.hpp:40</a></div></div>
<div class="ttc" id="aclasslost_1_1_user_specified_output_stream_html_a2d2eae68275a53f1b83be250d09b6730"><div class="ttname"><a href="classlost_1_1_user_specified_output_stream.html#a2d2eae68275a53f1b83be250d09b6730">lost::UserSpecifiedOutputStream::~UserSpecifiedOutputStream</a></div><div class="ttdeci">~UserSpecifiedOutputStream()</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00050">io.cpp:50</a></div></div>
<div class="ttc" id="aclasslost_1_1_user_specified_output_stream_html_a4dcbbf27cfacdc73f038e06532a73301"><div class="ttname"><a href="classlost_1_1_user_specified_output_stream.html#a4dcbbf27cfacdc73f038e06532a73301">lost::UserSpecifiedOutputStream::UserSpecifiedOutputStream</a></div><div class="ttdeci">UserSpecifiedOutputStream(std::string filePath, bool isBinary)</div><div class="ttdoc">Create a PromptedOutputStream which will output to the given file.</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00033">io.cpp:33</a></div></div>
<div class="ttc" id="aclasslost_1_1_vec3_html"><div class="ttname"><a href="classlost_1_1_vec3.html">lost::Vec3</a></div><div class="ttdoc">Three dimensional vector with floating point components.</div><div class="ttdef"><b>Definition:</b> <a href="attitude-utils_8hpp_source.html#l00031">attitude-utils.hpp:31</a></div></div>
<div class="ttc" id="aclasslost_1_1_vec3_html_a97adb523973ae539a5d8963d78569618"><div class="ttname"><a href="classlost_1_1_vec3.html#a97adb523973ae539a5d8963d78569618">lost::Vec3::x</a></div><div class="ttdeci">float x</div><div class="ttdef"><b>Definition:</b> <a href="attitude-utils_8hpp_source.html#l00033">attitude-utils.hpp:33</a></div></div>
<div class="ttc" id="adatabases_8hpp_html"><div class="ttname"><a href="databases_8hpp.html">databases.hpp</a></div></div>
<div class="ttc" id="aio_8cpp_html_a1628471efc4a0d438d497c67d641c6c4"><div class="ttname"><a href="io_8cpp.html#a1628471efc4a0d438d497c67d641c6c4">DEFAULT_BSC_PATH</a></div><div class="ttdeci">#define DEFAULT_BSC_PATH</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00087">io.cpp:87</a></div></div>
<div class="ttc" id="aio_8cpp_html_aa20cea40f78380bdd173e9636fe1f442"><div class="ttname"><a href="io_8cpp.html#aa20cea40f78380bdd173e9636fe1f442">LOST_PIPELINE_COMPARE</a></div><div class="ttdeci">#define LOST_PIPELINE_COMPARE(precondition, errmsg, comparator, path, isBinary)</div></div>
<div class="ttc" id="aio_8hpp_html"><div class="ttname"><a href="io_8hpp.html">io.hpp</a></div></div>
<div class="ttc" id="anamespacelost_html"><div class="ttname"><a href="namespacelost.html">lost</a></div><div class="ttdoc">LOST starting point.</div><div class="ttdef"><b>Definition:</b> <a href="attitude-estimators_8cpp_source.html#l00005">attitude-estimators.cpp:5</a></div></div>
<div class="ttc" id="anamespacelost_html_a0fe01051c958fa8ced02e772aefdc991"><div class="ttname"><a href="namespacelost.html#a0fe01051c958fa8ced02e772aefdc991">lost::CentroidComparisonsCombine</a></div><div class="ttdeci">CentroidComparison CentroidComparisonsCombine(std::vector&lt; CentroidComparison &gt; comparisons)</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l01103">io.cpp:1103</a></div></div>
<div class="ttc" id="anamespacelost_html_a1187da9a83232a720a84bef1b99c5b58"><div class="ttname"><a href="namespacelost.html#a1187da9a83232a720a84bef1b99c5b58">lost::FocalLengthFromOptions</a></div><div class="ttdeci">float FocalLengthFromOptions(const PipelineOptions &amp;values)</div><div class="ttdoc">Calculate the focal length, in pixels, based on the given command line options.</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00313">io.cpp:313</a></div></div>
<div class="ttc" id="anamespacelost_html_a1c3caf3f02508df448ec6c761a2d764e"><div class="ttname"><a href="namespacelost.html#a1c3caf3f02508df448ec6c761a2d764e">lost::SurfaceToGrayscaleImage</a></div><div class="ttdeci">unsigned char * SurfaceToGrayscaleImage(cairo_surface_t *cairoSurface)</div><div class="ttdoc">Convert a colored Cairo image surface into a row-major array of grayscale pixels.</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00119">io.cpp:119</a></div></div>
<div class="ttc" id="anamespacelost_html_a280b11c878f729f878b2968037ccbc3d"><div class="ttname"><a href="namespacelost.html#a280b11c878f729f878b2968037ccbc3d">lost::kCatalogMagicValue</a></div><div class="ttdeci">const int32_t kCatalogMagicValue</div><div class="ttdef"><b>Definition:</b> <a href="databases_8hpp_source.html#l00012">databases.hpp:12</a></div></div>
<div class="ttc" id="anamespacelost_html_a288b872531de219e9cfc87beb8d8bada"><div class="ttname"><a href="namespacelost.html#a288b872531de219e9cfc87beb8d8bada">lost::StarIdentifiers</a></div><div class="ttdeci">std::vector&lt; StarIdentifier &gt; StarIdentifiers</div><div class="ttdef"><b>Definition:</b> <a href="star-utils_8hpp_source.html#l00101">star-utils.hpp:101</a></div></div>
<div class="ttc" id="anamespacelost_html_a2de388cdf7e0c6b9c572903605480568"><div class="ttname"><a href="namespacelost.html#a2de388cdf7e0c6b9c572903605480568">lost::BscParse</a></div><div class="ttdeci">std::vector&lt; CatalogStar &gt; BscParse(std::string tsvPath)</div><div class="ttdoc">Parse the bright star catalog from the TSV file on disk.</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00057">io.cpp:57</a></div></div>
<div class="ttc" id="anamespacelost_html_a41f5bb669129790c12bd70e1d641441f"><div class="ttname"><a href="namespacelost.html#a41f5bb669129790c12bd70e1d641441f">lost::CatalogRead</a></div><div class="ttdeci">const Catalog &amp; CatalogRead()</div><div class="ttdoc">Read and parse the full catalog from disk. If called multiple times, will re-use the first result.</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00091">io.cpp:91</a></div></div>
<div class="ttc" id="anamespacelost_html_a4bd359d9c09dbecb81c3a3e536f0b5c5"><div class="ttname"><a href="namespacelost.html#a4bd359d9c09dbecb81c3a3e536f0b5c5">lost::Stars</a></div><div class="ttdeci">std::vector&lt; Star &gt; Stars</div><div class="ttdef"><b>Definition:</b> <a href="star-utils_8hpp_source.html#l00100">star-utils.hpp:100</a></div></div>
<div class="ttc" id="anamespacelost_html_a5552f98af725481dee70b9b39e12e064"><div class="ttname"><a href="namespacelost.html#a5552f98af725481dee70b9b39e12e064">lost::PipelineInputFactory</a></div><div class="ttdeci">PipelineInputList(* PipelineInputFactory)()</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00800">io.cpp:800</a></div></div>
<div class="ttc" id="anamespacelost_html_a5e7d67bec758d4922935c84b8a0f8526"><div class="ttname"><a href="namespacelost.html#a5e7d67bec758d4922935c84b8a0f8526">lost::FovToFocalLength</a></div><div class="ttdeci">float FovToFocalLength(float xFov, float xResolution)</div><div class="ttdef"><b>Definition:</b> <a href="camera_8cpp_source.html#l00057">camera.cpp:57</a></div></div>
<div class="ttc" id="anamespacelost_html_a69cfc1189a8f18fb6e6a6d400a8a1311"><div class="ttname"><a href="namespacelost.html#a69cfc1189a8f18fb6e6a6d400a8a1311">lost::PipelineComparatorPlotCentroidIndices</a></div><div class="ttdeci">void PipelineComparatorPlotCentroidIndices(std::ostream &amp;os, const PipelineInputList &amp;expected, const std::vector&lt; PipelineOutput &gt; &amp;actual, const PipelineOptions &amp;)</div><div class="ttdoc">Plot an annotated image where centroids are annotated with their centroid index.</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l01373">io.cpp:1373</a></div></div>
<div class="ttc" id="anamespacelost_html_a6b951e30f05e0a748e6c906697002093"><div class="ttname"><a href="namespacelost.html#a6b951e30f05e0a748e6c906697002093">lost::Angle</a></div><div class="ttdeci">float Angle(const Vec3 &amp;vec1, const Vec3 &amp;vec2)</div><div class="ttdoc">Calculate the inner angle, in radians, between two vectors.</div><div class="ttdef"><b>Definition:</b> <a href="attitude-utils_8cpp_source.html#l00456">attitude-utils.cpp:456</a></div></div>
<div class="ttc" id="anamespacelost_html_a7057fa740aebe1cbd43f3bafafff4ac1"><div class="ttname"><a href="namespacelost.html#a7057fa740aebe1cbd43f3bafafff4ac1">lost::SphericalToQuaternion</a></div><div class="ttdeci">Quaternion SphericalToQuaternion(float ra, float dec, float roll)</div><div class="ttdef"><b>Definition:</b> <a href="attitude-utils_8cpp_source.html#l00090">attitude-utils.cpp:90</a></div></div>
<div class="ttc" id="anamespacelost_html_a72e465adc8dcb532e46b956261bf93fe"><div class="ttname"><a href="namespacelost.html#a72e465adc8dcb532e46b956261bf93fe">lost::GetPngPipelineInput</a></div><div class="ttdeci">PipelineInputList GetPngPipelineInput(const PipelineOptions &amp;values)</div><div class="ttdoc">Create a PngPipelineInput using command line options.</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00373">io.cpp:373</a></div></div>
<div class="ttc" id="anamespacelost_html_a7affa1b0e82efc2065dbd3b1e83326e7"><div class="ttname"><a href="namespacelost.html#a7affa1b0e82efc2065dbd3b1e83326e7">lost::BuildPairDistanceKVectorDatabase</a></div><div class="ttdeci">void BuildPairDistanceKVectorDatabase(MultiDatabaseBuilder *builder, const Catalog &amp;catalog, float minDistance, float maxDistance, long numBins)</div><div class="ttdoc">Add a pair-distance KVector database to the given builder.</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00269">io.cpp:269</a></div></div>
<div class="ttc" id="anamespacelost_html_a8298f03c0d1b408401e4200d17305018"><div class="ttname"><a href="namespacelost.html#a8298f03c0d1b408401e4200d17305018">lost::SurfacePlot</a></div><div class="ttdeci">void SurfacePlot(std::string description, cairo_surface_t *cairoSurface, const Stars &amp;stars, const StarIdentifiers *starIds, const Catalog *catalog, const Attitude *attitude, double red, double green, double blue, double alpha, bool rawStarIndexes=false)</div><div class="ttdoc">Plot information about an image onto the image using Cairo.</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00170">io.cpp:170</a></div></div>
<div class="ttc" id="anamespacelost_html_a8f6c4f99ab47d2c48676901452fb8634"><div class="ttname"><a href="namespacelost.html#a8f6c4f99ab47d2c48676901452fb8634">lost::SerializePairDistanceKVector</a></div><div class="ttdeci">void SerializePairDistanceKVector(const Catalog &amp;catalog, float minDistance, float maxDistance, long numBins, unsigned char *buffer)</div><div class="ttdoc">Serialize a pair-distance KVector into buffer.</div><div class="ttdef"><b>Definition:</b> <a href="databases_8cpp_source.html#l00219">databases.cpp:219</a></div></div>
<div class="ttc" id="anamespacelost_html_a90ef8f69cd7b77ba05701f833fdaa320"><div class="ttname"><a href="namespacelost.html#a90ef8f69cd7b77ba05701f833fdaa320">lost::MagToBrightness</a></div><div class="ttdeci">float MagToBrightness(int mag)</div><div class="ttdoc">returns some relative brightness measure, which is proportional to the total number of photons receiv...</div><div class="ttdef"><b>Definition:</b> <a href="star-utils_8cpp_source.html#l00183">star-utils.cpp:183</a></div></div>
<div class="ttc" id="anamespacelost_html_a9b3311f3ebda1282ad7bf650de30cf45"><div class="ttname"><a href="namespacelost.html#a9b3311f3ebda1282ad7bf650de30cf45">lost::kMaxBrightness</a></div><div class="ttdeci">const int kMaxBrightness</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00473">io.cpp:473</a></div></div>
<div class="ttc" id="anamespacelost_html_aa309f1534940391b0d903f17a4c9be5c"><div class="ttname"><a href="namespacelost.html#aa309f1534940391b0d903f17a4c9be5c">lost::GenerateDatabases</a></div><div class="ttdeci">void GenerateDatabases(MultiDatabaseBuilder *builder, const Catalog &amp;catalog, const DatabaseOptions &amp;values)</div><div class="ttdoc">Generate and add databases to the given multidatabase builder according to the command line options i...</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00283">io.cpp:283</a></div></div>
<div class="ttc" id="anamespacelost_html_ab001adf3b7887c7b7a72d308893c48b2"><div class="ttname"><a href="namespacelost.html#ab001adf3b7887c7b7a72d308893c48b2">lost::PipelineComparator</a></div><div class="ttdeci">void(* PipelineComparator)(std::ostream &amp;os, const PipelineInputList &amp;, const std::vector&lt; PipelineOutput &gt; &amp;, const PipelineOptions &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l01203">io.cpp:1203</a></div></div>
<div class="ttc" id="anamespacelost_html_ab6f75e99dbde3eede31e0b3a7c56878e"><div class="ttname"><a href="namespacelost.html#ab6f75e99dbde3eede31e0b3a7c56878e">lost::StarIdsCompare</a></div><div class="ttdeci">StarIdComparison StarIdsCompare(const StarIdentifiers &amp;expected, const StarIdentifiers &amp;actual, const Catalog &amp;expectedCatalog, const Catalog &amp;actualCatalog, float centroidThreshold, const Stars &amp;expectedStars, const Stars &amp;inputStars)</div><div class="ttdoc">Compare expected and actual star identifications.</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l01122">io.cpp:1122</a></div></div>
<div class="ttc" id="anamespacelost_html_abf3a90819d379c9a4d0c48f385f52613"><div class="ttname"><a href="namespacelost.html#abf3a90819d379c9a4d0c48f385f52613">lost::DegToRad</a></div><div class="ttdeci">float DegToRad(float deg)</div><div class="ttdef"><b>Definition:</b> <a href="attitude-utils_8cpp_source.html#l00146">attitude-utils.cpp:146</a></div></div>
<div class="ttc" id="anamespacelost_html_acbd12c57a0797b6b786ebfc87aae0c84"><div class="ttname"><a href="namespacelost.html#acbd12c57a0797b6b786ebfc87aae0c84">lost::PipelineInputList</a></div><div class="ttdeci">std::vector&lt; std::unique_ptr&lt; PipelineInput &gt; &gt; PipelineInputList</div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00161">io.hpp:161</a></div></div>
<div class="ttc" id="anamespacelost_html_ad01d904e4a6bf5aed4a1b8f97f1416c5"><div class="ttname"><a href="namespacelost.html#ad01d904e4a6bf5aed4a1b8f97f1416c5">lost::GetPipelineInput</a></div><div class="ttdeci">PipelineInputList GetPipelineInput(const PipelineOptions &amp;values)</div><div class="ttdoc">Come up with a list of pipeline inputs based on command line options.</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00803">io.cpp:803</a></div></div>
<div class="ttc" id="anamespacelost_html_ad2caa7f022ed5c5dba03ab479414dafc"><div class="ttname"><a href="namespacelost.html#ad2caa7f022ed5c5dba03ab479414dafc">lost::PipelineComparison</a></div><div class="ttdeci">void PipelineComparison(const PipelineInputList &amp;expected, const std::vector&lt; PipelineOutput &gt; &amp;actual, const PipelineOptions &amp;values)</div><div class="ttdoc">Print or otherwise analyze the results of (perhaps multiple) runs of a star tracking pipeline.</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l01636">io.cpp:1636</a></div></div>
<div class="ttc" id="anamespacelost_html_ad4bb00e632a9200a8e42f620e460dd60"><div class="ttname"><a href="namespacelost.html#ad4bb00e632a9200a8e42f620e460dd60">lost::SetPipeline</a></div><div class="ttdeci">Pipeline SetPipeline(const PipelineOptions &amp;values)</div><div class="ttdoc">Create a pipeline from command line options.</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00837">io.cpp:837</a></div></div>
<div class="ttc" id="anamespacelost_html_adc5108f643b7657a835838c7f6411aa7"><div class="ttname"><a href="namespacelost.html#adc5108f643b7657a835838c7f6411aa7">lost::RadToDeg</a></div><div class="ttdeci">float RadToDeg(float rad)</div><div class="ttdef"><b>Definition:</b> <a href="attitude-utils_8cpp_source.html#l00142">attitude-utils.cpp:142</a></div></div>
<div class="ttc" id="anamespacelost_html_aec3a2012bf028c749ba53a46a50ad172"><div class="ttname"><a href="namespacelost.html#aec3a2012bf028c749ba53a46a50ad172">lost::GetGeneratedPipelineInput</a></div><div class="ttdeci">PipelineInputList GetGeneratedPipelineInput(const PipelineOptions &amp;values)</div><div class="ttdoc">Create a GeneratedPipelineInput based on the command line options in values</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00728">io.cpp:728</a></div></div>
<div class="ttc" id="anamespacelost_html_aef1a1d4dd4620ebdc2197877569a44f6"><div class="ttname"><a href="namespacelost.html#aef1a1d4dd4620ebdc2197877569a44f6">lost::Catalog</a></div><div class="ttdeci">std::vector&lt; CatalogStar &gt; Catalog</div><div class="ttdef"><b>Definition:</b> <a href="star-utils_8hpp_source.html#l00099">star-utils.hpp:99</a></div></div>
<div class="ttc" id="anamespacelost_html_af0b05482238f0a180d5906f0e43ac3e2"><div class="ttname"><a href="namespacelost.html#af0b05482238f0a180d5906f0e43ac3e2">lost::GrayscaleImageToSurface</a></div><div class="ttdeci">cairo_surface_t * GrayscaleImageToSurface(const unsigned char *image, const int width, const int height)</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00148">io.cpp:148</a></div></div>
<div class="ttc" id="anamespacelost_html_af4b650ecb61d27c188477fc9fbf4c886"><div class="ttname"><a href="namespacelost.html#af4b650ecb61d27c188477fc9fbf4c886">lost::DeserializeCatalog</a></div><div class="ttdeci">Catalog DeserializeCatalog(const unsigned char *buffer, bool *inclMagnitudeReturn, bool *inclNameReturn)</div><div class="ttdoc">Deserialize a catalog.</div><div class="ttdef"><b>Definition:</b> <a href="star-utils_8cpp_source.html#l00156">star-utils.cpp:156</a></div></div>
<div class="ttc" id="anamespacelost_html_afaa7020ad6a01645b45d4da236d4dfcb"><div class="ttname"><a href="namespacelost.html#afaa7020ad6a01645b45d4da236d4dfcb">lost::SerializeLengthPairDistanceKVector</a></div><div class="ttdeci">long SerializeLengthPairDistanceKVector(long numPairs, long numBins)</div><div class="ttdef"><b>Definition:</b> <a href="databases_8cpp_source.html#l00206">databases.cpp:206</a></div></div>
<div class="ttc" id="anamespacelost_html_afd017fba4090829c28c431509c4cfc1c"><div class="ttname"><a href="namespacelost.html#afd017fba4090829c28c431509c4cfc1c">lost::CentroidsCompare</a></div><div class="ttdeci">CentroidComparison CentroidsCompare(float threshold, const Stars &amp;expected, const Stars &amp;actual)</div><div class="ttdoc">Compare expected and actual centroids.</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l01077">io.cpp:1077</a></div></div>
<div class="ttc" id="anamespacelost_html_afd0ad3291fda13bb1bf50fb13906769c"><div class="ttname"><a href="namespacelost.html#afd0ad3291fda13bb1bf50fb13906769c">lost::operator&lt;&lt;</a></div><div class="ttdeci">std::ostream &amp; operator&lt;&lt;(std::ostream &amp;os, const Camera &amp;camera)</div><div class="ttdoc">Print information about the camera in machine and human-readable form.</div><div class="ttdef"><b>Definition:</b> <a href="io_8cpp_source.html#l00298">io.cpp:298</a></div></div>
<div class="ttc" id="astar-id_8hpp_html"><div class="ttname"><a href="star-id_8hpp.html">star-id.hpp</a></div></div>
<div class="ttc" id="astar-utils_8hpp_html"><div class="ttname"><a href="star-utils_8hpp.html">star-utils.hpp</a></div></div>
<div class="ttc" id="astructlost_1_1_pipeline_output_html"><div class="ttname"><a href="structlost_1_1_pipeline_output.html">lost::PipelineOutput</a></div><div class="ttdoc">The result of running a pipeline.</div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00189">io.hpp:189</a></div></div>
<div class="ttc" id="astructlost_1_1_pipeline_output_html_a18bcd3f7aa001bd26cbc67a2ae3ffcca"><div class="ttname"><a href="structlost_1_1_pipeline_output.html#a18bcd3f7aa001bd26cbc67a2ae3ffcca">lost::PipelineOutput::catalog</a></div><div class="ttdeci">Catalog catalog</div><div class="ttdoc">The catalog that the indices in starIds refer to.</div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00204">io.hpp:204</a></div></div>
<div class="ttc" id="astructlost_1_1_pipeline_output_html_a49482206ef9a4c6baacb708433168010"><div class="ttname"><a href="structlost_1_1_pipeline_output.html#a49482206ef9a4c6baacb708433168010">lost::PipelineOutput::attitudeEstimationTimeNs</a></div><div class="ttdeci">long attitudeEstimationTimeNs</div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00198">io.hpp:198</a></div></div>
<div class="ttc" id="astructlost_1_1_pipeline_output_html_a7743f8496f64299c8af36ac0ec080699"><div class="ttname"><a href="structlost_1_1_pipeline_output.html#a7743f8496f64299c8af36ac0ec080699">lost::PipelineOutput::stars</a></div><div class="ttdeci">std::unique_ptr&lt; Stars &gt; stars</div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00190">io.hpp:190</a></div></div>
<div class="ttc" id="astructlost_1_1_pipeline_output_html_ab299485c94c8d2f5c4094869fadd8a62"><div class="ttname"><a href="structlost_1_1_pipeline_output.html#ab299485c94c8d2f5c4094869fadd8a62">lost::PipelineOutput::centroidingTimeNs</a></div><div class="ttdeci">long centroidingTimeNs</div><div class="ttdoc">How many nanoseconds the centroiding stage of the pipeline took.</div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00196">io.hpp:196</a></div></div>
<div class="ttc" id="astructlost_1_1_pipeline_output_html_ab56fb6e6eafedf6134659395be542305"><div class="ttname"><a href="structlost_1_1_pipeline_output.html#ab56fb6e6eafedf6134659395be542305">lost::PipelineOutput::starIdTimeNs</a></div><div class="ttdeci">long starIdTimeNs</div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00197">io.hpp:197</a></div></div>
<div class="ttc" id="astructlost_1_1_pipeline_output_html_ad2be75247ab893fb920ece9f2eb800f8"><div class="ttname"><a href="structlost_1_1_pipeline_output.html#ad2be75247ab893fb920ece9f2eb800f8">lost::PipelineOutput::attitude</a></div><div class="ttdeci">std::unique_ptr&lt; Attitude &gt; attitude</div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00192">io.hpp:192</a></div></div>
<div class="ttc" id="astructlost_1_1_pipeline_output_html_af5fb349aaee63e4e932069bc01743042"><div class="ttname"><a href="structlost_1_1_pipeline_output.html#af5fb349aaee63e4e932069bc01743042">lost::PipelineOutput::starIds</a></div><div class="ttdeci">std::unique_ptr&lt; StarIdentifiers &gt; starIds</div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00191">io.hpp:191</a></div></div>
<div class="ttc" id="astructlost_1_1_star_id_comparison_html"><div class="ttname"><a href="structlost_1_1_star_id_comparison.html">lost::StarIdComparison</a></div><div class="ttdoc">The result of comparing an actual star identification with the true star idenification,...</div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00208">io.hpp:208</a></div></div>
<div class="ttc" id="astructlost_1_1_star_id_comparison_html_a188f3594728b5cf2ebf8a74c2e6ba01d"><div class="ttname"><a href="structlost_1_1_star_id_comparison.html#a188f3594728b5cf2ebf8a74c2e6ba01d">lost::StarIdComparison::numCorrect</a></div><div class="ttdeci">int numCorrect</div><div class="ttdoc">The number of centroids in the image which are close to an expected centroid that had an expected ide...</div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00211">io.hpp:211</a></div></div>
<div class="ttc" id="astructlost_1_1_star_id_comparison_html_a8534ab9d04bf422ea323c1e65008dc10"><div class="ttname"><a href="structlost_1_1_star_id_comparison.html#a8534ab9d04bf422ea323c1e65008dc10">lost::StarIdComparison::numTotal</a></div><div class="ttdeci">int numTotal</div><div class="ttdoc">The number of centroids sufficiently close to a true expected star.</div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00219">io.hpp:219</a></div></div>
<div class="ttc" id="astructlost_1_1_star_id_comparison_html_aba82ab6b00ac56a4536f9ac204639567"><div class="ttname"><a href="structlost_1_1_star_id_comparison.html#aba82ab6b00ac56a4536f9ac204639567">lost::StarIdComparison::numIncorrect</a></div><div class="ttdeci">int numIncorrect</div><div class="ttdoc">The number of centroids which were either:</div><div class="ttdef"><b>Definition:</b> <a href="io_8hpp_source.html#l00216">io.hpp:216</a></div></div>
<div class="ttc" id="astructlost_1_1_vec2_html"><div class="ttname"><a href="structlost_1_1_vec2.html">lost::Vec2</a></div><div class="ttdoc">A two dimensional vector with floating point components.</div><div class="ttdef"><b>Definition:</b> <a href="attitude-utils_8hpp_source.html#l00013">attitude-utils.hpp:13</a></div></div>
<div class="ttc" id="astructlost_1_1_vec2_html_a358e9b88c20e79e262eaa413b41a446e"><div class="ttname"><a href="structlost_1_1_vec2.html#a358e9b88c20e79e262eaa413b41a446e">lost::Vec2::Magnitude</a></div><div class="ttdeci">float Magnitude() const</div><div class="ttdef"><b>Definition:</b> <a href="attitude-utils_8cpp_source.html#l00178">attitude-utils.cpp:178</a></div></div>
<div class="ttc" id="astructlost_1_1_vec2_html_a3a23d5b38c5873b4b870ace85fd30d05"><div class="ttname"><a href="structlost_1_1_vec2.html#a3a23d5b38c5873b4b870ace85fd30d05">lost::Vec2::y</a></div><div class="ttdeci">float y</div><div class="ttdef"><b>Definition:</b> <a href="attitude-utils_8hpp_source.html#l00015">attitude-utils.hpp:15</a></div></div>
<div class="ttc" id="astructlost_1_1_vec2_html_a9a9c151101dbb57060873e8af18927af"><div class="ttname"><a href="structlost_1_1_vec2.html#a9a9c151101dbb57060873e8af18927af">lost::Vec2::x</a></div><div class="ttdeci">float x</div><div class="ttdef"><b>Definition:</b> <a href="attitude-utils_8hpp_source.html#l00014">attitude-utils.hpp:14</a></div></div>
<div class="ttc" id="astructlost_1_1_vec2_html_aff160839bdf98a18db114a9bd7baab72"><div class="ttname"><a href="structlost_1_1_vec2.html#aff160839bdf98a18db114a9bd7baab72">lost::Vec2::MagnitudeSq</a></div><div class="ttdeci">float MagnitudeSq() const</div><div class="ttdoc">The square of the magnitude.</div><div class="ttdef"><b>Definition:</b> <a href="attitude-utils_8cpp_source.html#l00170">attitude-utils.cpp:170</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="io_8cpp.html">io.cpp</a></li>
    <li class="footer">Generated on Sat Apr 8 2023 16:23:13 for LOST by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
